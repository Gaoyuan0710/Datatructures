_.Module.define({path:"postor/widget/MeizhiPostor",requires:["common/component/LoginDialog","common/component/EditorPicMeizhi"],sub:{containerHTML:["<div>",'<div id="mz_post_wrapper">','<div id="#{meizhi_tip}" class="meizhi_tip">\u6e29\u99a8\u63d0\u793a\uff1a\u83b7\u5f9710\u4e2a\u59b9\u7eb8\u6295\u7968\uff0c\u4f60\u5c06\u88ab\u8ba4\u8bc1\u4e3a\u59b9\u7eb8\uff01\u7537\u6027\u7528\u6237\u65e0\u6cd5\u8fdb\u884c\u59b9\u7eb8\u8ba4\u8bc1\u3002<a class="tip_close" onclick="return false;" href="#"></a></div>','<form id="#{meizhi_post}"  method="post"  autocomplete="off">','<table  width="100%" border="0" cellspacing="0" cellpadding="3">','<tr id="#{title_tr}"> <td class = "label_wrapper" valign="top"  nowrap style="line-height:32px;">\u6807\u9898:</td> <td> <div id = "#{title_div}" class="input_wrapper"><span class ="input_prefix">\u3010\u59b9\u7eb8\u6c42\u8ba4\u8bc1\u3011</span> <input type="text" id="#{title}" class="title_input" name="title" value="" autocomplete="off"  /> </div> <div id="#{titleError}" class="postErrorTitle"></div> </td> </tr>','<tr id="#{content_tr}"> <td class = "label_wrapper" valign="top"  nowrap >\u5185\u5bb9:</td> <td> <textarea class="content_input"></textarea> <div id="#{contentError}" class="postErrorContent"></div> </td> </tr>','<tr id="pic_tr"> <td class = "label_wrapper" valign="top"  nowrap >\u7167\u7247:</td> <td> <div id="#{pic_wrapper}" class="pic_wrapper clearfix"> <div id="#{pic_editor}" class="pic_add"> <div class="pic_remain_back"> <div class="pic_remain">\u8fd8\u53ef\u6dfb\u52a0<span class="pic_remain_num">30</span>\u5f20</div></div></div></div></td></tr>','<tr id="#{vcode_tr}" style="display:none;"> <td nowrap="nowrap" valign="top"  class="pt_valid"> <label for="captcha" style="line-height:24px;">\u9a8c\u8bc1\u7801:</label> </td> <td valign="middle" align="left" nowrap="nowrap"> <div id="#{vcode_div}" class="vcode"></div> </td> </tr>','<tr id="#{like_tr}" ><td class = "label_wrapper like_label" valign="top" nowrap >\u53d1\u8868\u5230:</td><td><select class="like_wrapper"></select></td></tr>','<tr id="#{submit_tr}"><td>&nbsp;</td><td class="submit"> <input type="submit" id="#{submit}" alog-alias="richpostor" class="subbtn_bg" value=" \u53d1 \u8868 "/> <span class="pt_posting_status j_posting_status"></span><span id="#{postError}" class="post_error"></span> </td> </tr>',"</tbody> </table> </form></div>","</div>"].join(""),successHTML:['<div class="mz_post_success">','<p class="success_title">\u5df2\u6210\u529f\u53d1\u8d77\u8ba4\u8bc1\uff01</p>','<p class="success_tip">\u83b7\u5f9710\u4e2a\u59b9\u7eb8\u6295\u7968\uff0c\u4f60\u5c06\u88ab\u8ba4\u8bc1\u4e3a\u59b9\u7eb8\uff01</p>','<p class="success_relocation"><span class="success_relocation_timeout"></span>\u540e\u5c06\u81ea\u52a8\u8df3\u8f6c\u5230\u59b9\u7eb8\u8ba4\u8bc1\u5e16</p>',"</div>"].join(""),config:{imageLimite:30},initial:function(){var b=this;this._data_postor={};this._option={forum:PageData.forum,tbs:PageData.tbs,user:PageData.user};this._event={};var c=this.containerHTML;this._generi_dom_id();c=$.tb.format(c,this._dom_id);this.container=$(c);var a=this._option.user.is_login;this._statInit(a)},_statInit:function(a){if(!a){this._cannotPost();return}else{this._canPost();return}},_cannotPost:function(){this.use("common/component/LoginDialog","","userBar")},_canPost:function(){this._dialogInit();this._initTitleAndContent();this._editorInitPic(this.picWrapper);this._postBtnInit();this._hasTip()},_dialogInit:function(){var a={html:this.container.html(),title:"\u53d1\u8d77\u59b9\u7eb8\u8ba4\u8bc1\u5e16",width:680,height:500};this.overlay=new $.dialog(a);this.title=$("#"+this._dom_id.title_div).find(".title_input");this.content=$("#"+this._dom_id.content_tr).find(".content_input");this.picEditor=$("#"+this._dom_id.pic_editor);this.picWrapper=$("#"+this._dom_id.pic_wrapper);this.submit_tr=$("#"+this._dom_id.submit_tr);this._likeInit()},_pic_wrapper_toggle:function(){var a=this;var b=$("#meizhi_img_layer");var c=this.picEditor.find(".pic_remain_back");c.bind("click",function(d){if(a.getImageNum()!=0){if(b.hasClass("hide")){b.removeClass("hide");$(document).one("click",function(f){b.addClass("hide")})}else{b.addClass("hide")}}else{b.addClass("hide")}});c.bind("click",function(d){d.stopPropagation()})},_initTitleAndContent:function(){var b="\u6211\u662f\u771f\u5fc3\u59b9\u7eb8\uff0c\u6c42\u5927\u5bb6\u4e0d\u8981\u624b\u6296...",a="\u4e0a\u4f20\u4e09\u5f20\u9753\u7167\uff0c\u7acb\u5373\u8fdb\u5165\u672c\u5427\u59b9\u7eb8\u8ba4\u8bc1\u4e13\u533a~";_.Module.use("common/component/Placeholder",[this.title,b,{left:95,"font-size":14}],function(){});_.Module.use("common/component/Placeholder",[this.content,a,{"font-size":14}],function(){})},_likeInit:function(){var c,b,a,e=this.sel=$("#"+this._dom_id.like_tr).find("select"),d=this._option.forum.name;e.append('<option value="'+d+'">'+d+"</option>");e.tbattr("disabled","disabled")},_editorInitPic:function(b){var a=this;if(this.imageLayer){this.imageLayer.init(b,this)}else{this.imageLayer=this.use("common/component/EditorPicMeizhi");this.imageLayer.init(b,this)}this._pic_wrapper_toggle();this._picBoxEvents();return false},_postBtnInit:function(c){var b=this,d=this._dom_id,a=$("#"+d.submit);a.tbattr("disabled",false);a.className="subbtn_bg";b._postBtnEvent()},_postBtnEvent:function(){var b=this,d=this._dom_id,a=$("#"+d.submit),c=$("#"+d.meizhi_post);if(!a.hasClass("bubbtn_bg_banned")){a.mouseover(function(){$(this).tbattr("class","subbtn_bg_hover")});a.mouseout(function(){$(this).tbattr("class","subbtn_bg")});a.mousedown(function(){$(this).tbattr("class","subbtn_bg_active")})}c.submit(function(){b._submit();return false});c.keydown(function(f){var g=f||window.event;if((g.ctrlKey&&g.keyCode==13)||(g.altKey&&g.keyCode==83)){if(g.preventDefault){g.preventDefault()}else{g.returnValue=false}}})},_generi_dom_id:function(){var a=new Date().valueOf();this._dom_id={meizhi_tip:"mt"+a,meizhi_post:"mp"+a,title_tr:"tt"+a,title_div:"td"+a,titleError:"te"+a,content_tr:"ct"+a,contentError:"ce"+a,pic_wrapper:"pw"+a,pic_editor:"pe"+a,like_tr:"lt"+a,vcode_tr:"vt"+a,vcode_div:"vd"+a,submit_tr:"st"+a,submit:"sm"+a,postError:"pr"+a}},getImageNum:function(){return this.config.imageLimite-this.picWrapper.find(".pic_box").length},setStatsRequest:function(b){var a=new Image();window["bd_pv_"+(new Date).getTime()]=a;a.src="http://static.tieba.baidu.com/tb/img/pv.gif?fr=tb0_forum&st_mod=frspb&st_type=editor&st_value="+b+"&t="+(new Date).getTime();a=null},insertImage:function(c){var d=this;for(var e=0,b=c.length;e<b;e++){var a=$('<div class = "pic_box" ><div class = "pic_box_close"><a href="#" onclick="return false"></a></div><img unselectable="on" style="display:none;" data-id = "'+c[e].pic_id_encode+'" class="tmp_image" src="'+c[e].url+'"/></div>');a.insertAfter(this.picEditor).find("img").one("load",function(){d.resizePicSize($(this));d.cutPic($(this),100);$(this).show();d._resizePos()})}},resizePicSize:function(a){var c=560,d=a.width(),b=a.height();if(d>560){var e=c/d;d=560;b*=e}a.tbattr({width:d,height:Math.floor(b)})},cutPic:function(c,b){var a=c.width();var e=c.height();if(a>e&&e>=b){a=a/e*b;e=b;var f=Math.round((a-e)/2);var d=Math.round(a-e-f);c.css({width:a,height:e,marginLeft:-1*f,marginRight:-1*d})}else{if(e>a&&a>=b){e=e/a*b;a=b;c.css({width:a,height:e})}}},_resizePos:function(){var a=$("#"+this._dom_id.pic_wrapper+">div");a.each(function(b){if($(this).hasClass("pic_add")){this.className="pic_add"}else{this.className="pic_box"}if((b+1)%5==0){$(this).addClass("right_end")}if(b>4){$(this).addClass("bottom_end")}});this.picWrapper.find(".pic_remain_num").text(this.getImageNum())},_picBoxEvents:function(){var a=this;this.picWrapper.find(".pic_box").live("mouseenter",function(b){$(this).find(".pic_box_close").show()}).live("mouseleave",function(b){$(this).find(".pic_box_close").hide()});this.picWrapper.find(".pic_box_close").live("click",function(){$(this).parent(".pic_box").remove();a._resizePos()})},successDialog:function(c){var a=this;var b={html:this.successHTML,width:500,height:150,title:"\u53d1\u8d77\u59b9\u5b50\u8ba4\u8bc1\u5e16"};if(this.overlay){this.overlay.close()}this.overlay=new $.dialog(b);this._setRelocationTime(c);this.overlay.bind("onclose",function(){clearInterval(a._time);a._time=null})},_setRelocationTime:function(c){var a=this,b=$(".mz_post_success .success_relocation_timeout").text("3s");i=3;this._time=setInterval(function(){if(i==0){clearInterval(this._time);$.tb.location.setHref("http://tieba.baidu.com/p/"+c.thread_id);return false}i-=1;b.text(i+"s")},1000)},_hasTip:function(){var b=this;var a=$.cookie("meizhiTipIsClosed")=="1";var d=$("#"+this._dom_id.meizhi_tip);var c=d.find(".tip_close");if(a){d.hide()}c.click(function(f){$.cookie("meizhiTipIsClosed","1",{empires:365,path:"/"});d.hide();f.stopPropagation()})},bind:function(b,a,c){var d={stat:c?true:false,fun:a};if(this._event[b]){this._event[b].push(d)}else{this._event[b]=[];this._event[b].push(d)}},triggerEvent:function(b){var a=Array.prototype.slice.call(arguments,0);a.shift();if(this._event[b]){var d=this._event[b];for(var c=0;c<d.length;c++){if(d[c].fun){d[c].fun.apply(this,a)}if(!d[c].stat){return false}}}return true},setPostorData:function(a,c){var b=this._data_postor;b[a]=c},getPostorData:function(a){var b=this._data_postor;return b[a]},removePostorData:function(a){var b=this._data_postor;delete b[a]},setPostingStatus:function(b){var a=this.submit_tr.find(".j_posting_status");if(b){a.addClass("pt_posting_loading")}else{a.removeClass("pt_posting_loading")}},_getData:function(){var c=this._data_postor;var d=this._dom_id;var b=this._option;var e=this.picWrapper.find(".tmp_image"),a=[];e.each(function(h){var f=this,k=$(this),g={},j=k.tbattr("data-id");v_url=k.tbattr("src");if(j){g.pid=j;g.url=v_url;g.width=k.tbattr("width");g.height=k.tbattr("height");a.push(g)}});c.pic_info=a;c.like=this.sel.find("option:selected").val();c.title="\u3010\u59b9\u7eb8\u6c42\u8ba4\u8bc1\u3011"+this.title.val();c.content=this.content.val();c.tbs=this._option.tbs;c.forum_id=PageData.forum.id||PageData.forum.forum_id;c.user_id=this._option.user.id;if(!c.vcode){c.vcode=""}return c},_validator:function(){if(!this._validFrsPostTitle()){return false}if(!this._validRichEditorContent()){return false}if(!this._validPicEditor()){return false}return true},_validFrsPostTitle:function(){var c=this.title,e=c.val().trim();if(e==""){this._errorTipShow("\u6807\u9898\u4e0d\u80fd\u4e3a\u7a7a");c.focus();return false}else{var a=e.getByteLength();var b=60;if(a>b){var d="\u62b1\u6b49\uff0c\u60a8\u7684\u6807\u9898\u8d85\u8fc7"+(b/2)+"\u5b57\uff0c\u5efa\u8bae\u60a8\u7cbe\u7b80\u540e\u518d\u63d0\u4ea4";this._errorTipShow(d);c.focus();return false}}return true},_validRichEditorContent:function(){var f=this._dom_id,e=this.content,g=this.content.val(),c=this;if((g.trim()==""||g.replace(/<[^>]*>|(&nbsp;)|[\s\u3000]*/g,"")=="")){this._errorTipShow("\u53d1\u8d34\u5185\u5bb9\u9700\u5305\u542b\u6587\u5b57");e.focus();return false}var a=g.getByteLength();var b=10000;if(a>b){var d="\u62b1\u6b49\uff0c\u60a8\u7684\u8d34\u5b50\u8d85\u8fc7"+(b/2)+"\u5b57\uff0c\u5efa\u8bae\u60a8\u7cbe\u7b80\u6216\u5206\u6bb5\u540e\u518d\u63d0\u4ea4";c._errorTipShow(d);return false}return true},_validPicEditor:function(){var a=this.picWrapper.find(".pic_box").length;if(a===0){this._errorTipShow("\u8bf7\u9009\u62e9\u81f3\u5c11\u4e00\u5f20\u7167\u7247");return false}return true},_errorTipShow:function(b){var c=this._dom_id,a=this;var d=$("#"+this._dom_id.postError);d.css("display","");d.get(0).innerHTML=b},_errorTipHide:function(){var a=$("#"+this._dom_id.postError);a.css("display","none")},_submit:function(){var b=this;if(this._validator()){this.setPostingStatus(true);var d=$("#"+this._dom_id.submit);d.tbattr("disabled",true);d.removeClass("subbtn_bg").addClass("subbtn_bg_banned");var e=this._getData();var a={anonymous:0,content:e,fid:PageData.forum.id||PageData.forum.forum_id,ie:"utf-8",kw:PageData.forum.name,rich_text:1,tbs:PageData.tbs};var f=$.extend(a,e||{});var c="/encourage/post/meizhi/thread?ie=utf-8";_.Module.use("common/component/PostorServiceMeizhi",[],function(g){g.postHandler({data:f,url:c,type:"thread",success:function(h){b.successDialog(h)}});d.tbattr("disabled",false);d.removeClass("subbtn_bg_banned").addClass("subbtn_bg");b.setPostingStatus(false)});return false}}}});var Sign_rank={sign_url:"/sign/add",sign_forum:"/sign/info",get_url:"/sign/loadmonth",month_url:"/sign/month",sign_card:null,sign_year:null,sign_month:null,orign_year:null,orign_month:null,rights_tips:[null,null,null,null,null],mouseEventTimer:null,rightsTipsTimer:null,_client_html:['<div class="sign_card">','<h2 class="sign_card_title">\u5ba2\u6237\u7aef\u7b7e\u5230\u6709\u5956</h2>','<div class="sign_card_detail">\u5ba2\u6237\u7aef\u7b7e\u5230\u6700\u591a<span class="sign_client_strong">4\u500d</span>\u7ecf\u9a8c\uff0c</br>\u8fd8\u80fd\u514d\u8d39\u53c2\u4e0e\u62bd\u5956\u6d3b\u52a8\u3002</br>\u5feb\u53bb\u5ba2\u6237\u7aef\u5427\u3002</div>','<a href="http://c.tieba.baidu.com/c/s/download/pc?src=webtb&t=2&tab=1#img1" target="_blank" class="sign_card_positive_btn">\u6211\u89814\u500d\u7ecf\u9a8c\u548c\u5956\u54c1</a>','<a href="#" class="sign_card_negative_btn">\u4e0d\u8981\u5956\u54c1</a>',"</div>"].join(""),options:{modVersion:"common"},sign_init:function(k){(typeof PDC!="undefined")&&PDC.mark("c_sa");var j=this;var c=$("#sign_mod");this.options=$.extend(this.options,k);if($.cookie("add_sign")=="sign_rank"){if(!PageData.is_sign_in){j.showCardBeforeSign()}$.cookie("add_sign",null)}if($.cookie("sign_not_now")=="true"){if(PageData.forum.version=="1"){$("#sign_mod").find(".j_signbtn").removeClass("j_cansign").addClass("sign_ing")}else{$("#sign_mod").find(".j_signbtn").removeClass("j_cansign").addClass("signstar_ing")}setTimeout(function(){if(PageData.forum.version=="1"){$("#sign_mod").find(".j_signbtn").removeClass("sign_ing").addClass("j_cansign")}else{$("#sign_mod").find(".j_signbtn").removeClass("signstar_ing").addClass("j_cansign")}},10000)}j.mobile_sign_tip();if(PageData.is_sign_in){j.sign_resetdate();j.sign_load_month(0);j.cal_mouseEnterOut();setInterval(j.refresh_sign_rank,300000)}else{var f=new Date(Env.server_time);var g=f.getDay();if(PageData.forum.version=="1"){c.find(".j_signbtn").addClass("j_cansign sign"+g)}else{c.find(".j_signbtn").addClass("j_cansign")}}c.find(".fdir_rank a").click(function(){Stats.sendRequest("fr=tb0_forum&st_mod=frs&st_type=sign_fdir_entr")});c.on("click",".j_cansign",function(){$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:"frs",st_type:"sign_btn_click"});if(PageData.user.is_login){if(PageData.user.is_black){j.show_block_sign_dialog()}else{j.showCardBeforeSign()}}else{$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:PageData.product,st_type:"sign_login_display"});_.Module.use("common/component/LoginDialog",["","",function(){$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:PageData.product,st_type:"sign_login_succ",bduid:PageData.user.bduid});$.cookie("add_sign","sign_rank",{expires:14});$.tb.location.reload()}])}});c.find(".j_calendar_month_prev").click(function(){var m=new Date(j.sign_year,j.sign_month-1,1);var l=new Date(j.orign_year-2,j.orign_month-1,1);var n=new Date(2012,6,1);if(m.getTime()<=l.getTime()||m.getTime()<=n.getTime()){return}else{j.set_sign_calendar("",j.sign_year,j.sign_month,-1)}});c.find(".j_calendar_month_next").click(function(l){if(j.sign_year>j.orign_year||j.sign_year==j.orign_year&&j.sign_month>=j.orign_month){return}else{j.set_sign_calendar("",j.sign_year,j.sign_month,1)}});if(PageData.user.is_login){$(".sign_rights").show();$(".j_sign_rights_icon").each(function(l,m){$(m).mouseover(function(){j.rightsTipsTimer=setTimeout(function(){j.sign_right_tips(l)},400)}).mouseout(function(){window.clearInterval(j.rightsTipsTimer);j.rightsTipsTimer=window.setTimeout(function(){if(j.rights_tips[l]!=null){j.rights_tips[l].hideBubble()}},10)})})}else{}if(PageData.forum.version=="2"){var i=$("#signstar_wrapper");i.hover(function(){$(this).addClass("signstar_wrapper_hover")},function(){$(this).removeClass("signstar_wrapper_hover")});var d=$("#sign_dir_tip");var b=d.html();d.html("");var a={content:b,arrow_dir:"up",bubble_css:{top:-5,right:30,width:180,"text-align":"left"},arrow_pos:{left:30},attr:" id='tb_message_tip_n' ",wrap:$("#sign_dir_tip"),closeBtn:false};var e=new UiBubbleTipBase(a);var h=i.find(".j_signdir");h.bind("mouseover",function(){d.show();e.showBubble()}).bind("mouseout",function(){e.hideBubble()})}},showCardBeforeSign:function(){var a=this;if($.cookie("showCardBeforeSign")=="1"||a.sign_card){a.sign_add()}else{_.Module.use("common/component/Card",[{content:a._client_html,arrow_dir:"up",card_css:{width:190,top:$(".j_signbtn").offset().top+$(".j_signbtn").height()+11,left:$(".j_signbtn").offset().left-63},card_leave_hide:true}],function(b){a.sign_card=b;a.bindCardEvent();b.showCard();$.cookie("showCardBeforeSign","1",{expires:1})})}},bindCardEvent:function(){var a=this;$(".sign_card_negative_btn").on("click",function(b){b.preventDefault();a.sign_card&&a.sign_card._j_card.hide();a.sign_add()})},sign_resetdate:function(){var a=new Date(Env.server_time);this.sign_year=this.orign_year=a.getFullYear();this.sign_month=this.orign_month=a.getMonth()+1},cal_mouseEnterOut:function(){var b=this;var c=$("#sign_mod");var a;c.find(".j_signbtn,.j_succ_info").die().live({mouseout:function(){window.clearInterval(b.mouseEventTimer);b.mouseEventTimer=window.setTimeout(function(){$(".j_succ_info").fadeOut("slow");if(c.find(".j_succ_info").css("display")=="none"){$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:"frs",st_type:"sign_pop_dialog"})}},10)},mouseover:function(){if(c.find(".j_succ_info").css("display")=="none"){if(b.orign_year!=b.sign_year||b.orign_month!=b.sign_month){b.sign_resetdate();b.sign_load_month(0)}}window.clearInterval(b.mouseEventTimer);b.mouseEventTimer=setTimeout(function(){$(".j_succ_info").stop(true,true).show()},400)}})},cal_mouseEventRemove:function(){window.clearInterval(self.mouseEventTimer);$("#sign_mod").find(".j_signbtn,.j_succ_info").die()},sign_add:function(){if(PageData.forum.version=="1"){$("#sign_mod").find(".j_signbtn").removeClass("j_cansign").addClass("sign_ing")}else{$("#sign_mod").find(".j_signbtn").removeClass("j_cansign").addClass("signstar_ing")}var a={kw:PageData.forum.name,tbs:PageData.tbs,ie:"utf-8"};$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:PageData.product,st_type:"sign_in_num"});$.tb.post(Sign_rank.sign_url,a,function(e){if(e&&(e.no==0||e.no==1104)){$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:"frs",st_type:"sign_in_succ"});$(".j_today_signnum").html(e.data.finfo.current_rank_info.sign_count);var g=PageData.forum.version>=2?2:1;var f=e.data.uinfo.sign_time;var b=new Date(f);Sign_rank.sign_year=Sign_rank.orign_year=b.getFullYear();Sign_rank.sign_month=Sign_rank.orign_month=b.getMonth()+1;Sign_rank.sign_load_month(1)}else{setTimeout(function(){if(PageData.forum.version=="1"){$("#sign_mod").find(".j_signbtn").removeClass("sign_ing").addClass("j_cansign")}else{$("#sign_mod").find(".j_signbtn").removeClass("signstar_ing").addClass("j_cansign")}},10000);var d=new Date();d.setTime(d.getTime()+(10*1000));$.cookie("sign_not_now",true,{expires:d});if(e.no==1007){var g=PageData.forum.version>=2?2:1;var c=$(".j_signbtn");if(PageData.forum.version=="1"){c.removeClass().addClass("j_signbtn sign_btn"+g+" sign_full")}else{c.removeClass().addClass("j_signbtn signstar_full")}}else{new $.dialog({html:"<div class='signmod_likeandsign_dialog'>"+e.error+"</div>",holderClassName:"passportDialog",title:"\u7b7e\u5230\u5931\u8d25",draggable:false,width:338,height:87})}}},"json")},sign_load_month:function(c){var a=this;var b=PageData.forum.version>=2?2:1;$.tb.get(Sign_rank.get_url,{kw:PageData.forum.name,ie:"utf-8"},function(q){if(q&&q.no==0){$(".j_signin_index").html(q.data.sign_user_info.rank);$(".j_succ_text").html(Sign_rank.succ_text(PageData.forum.sign_in_info.forum_info.current_rank_info.sign_rank,q.data.sign_user_info.rank,PageData.forum.sign_in_info.forum_info.forum_info.level_1_dir_name,q.data.sign_user_info.sign_keep));$(".j_sign_succ_keep").html(q.data.sign_user_info.sign_keep);$(".j_sign_succ_count").html(q.data.sign_user_info.sign_total);var d=q.data.sign_user_info.sign_month;var l=(new Date()).getDate();for(var h=d.length-1;h>=0;h--){var j=d[h];if(j.d==l){if(j.sign_type=="mobile_client"){$(".j_sign_succ_txt").html('\u5df2\u901a\u8fc7\u5ba2\u6237\u7aef\u7b7e\u5230\uff0c\u8d5a\u4e86<span class="sign_client_strong">4\u500d</span>\u7ecf\u9a8c\uff0c\u660e\u5929\u7ee7\u7eed\u518d\u63a5\u518d\u52b1~')}break}}Sign_rank.sign_resetdate();Sign_rank.set_sign_calendar(q);a.signShai(q);a.check_rights_status(q.data.sign_user_info.sign_keep);var g=$(".j_signbtn");if(PageData.forum.version=="1"){g.removeClass().addClass("j_signbtn sign_btn"+b+" sign"+g.tbattr("data-dw")+"_signed")}else{$("#signstar_wrapper .j_signstar_order").html(q.data.sign_user_info.rank);var n=$("#signstar_wrapper");if(n[0]){n.addClass("signstar_wrapper_signed")}g.removeClass().addClass("j_signbtn signstar_signed")}if(c){if(q.data.sign_user_info.sign_keep==30||q.data.sign_user_info.sign_keep==100){var p={username:PageData.user.name,forumname:PageData.forum.name,continueSign:q.data.sign_user_info.sign_keep,memberCount:PageData.memberNumber,memberTitle:PageData.memberTitle};Sign_rank.sign_100(p)}$(".j_succ_info").show();var f='<span class="sign_keep_span">\u8fde\u7eed\u7b7e\u5230 '+q.data.sign_user_info.sign_keep+" \u5929</span>";var o=q.data.sign_user_info.sign_keep>1?"4":"2";var m;try{m="baidubrowser.tieba"==window.external.GetVersion("version")?true:false}catch(k){m=null}if(m){o=q.data.sign_user_info.sign_keep>1?"5":"3"}g.append(f);if(PageData.user.is_like&&!PageData.user.is_block){$(".signed_day:last").append('<div style="position:absolute;"><div class="sign_plus_two">+'+o+" \u7ecf\u9a8c</div></div>");setTimeout(function(){$(".sign_plus_two").show().animate({opacity:0,top:"-=20"},2500)},1000)}$(".signed_day:last").removeClass("signed_day").addClass("signed_anime_day")}else{$("#sign_btn_keep").text(q.data.sign_user_info.sign_keep)}a.cal_mouseEnterOut()}else{}},"json")},sign_like_and_sign:function(c){$("#j_sign_tip_holder .tip_v_2 img").click();var b=new $.dialog({html:"<div class='signmod_likeandsign_dialog'>\u5728\u672c\u5427\u7b7e\u5230\u9700\u8981\u5148\u6210\u4e3a\u4f1a\u5458\u54e6~\u52a0\u5165\u6211\u4eec\u5427\uff01</div><div class='signmod_likeandsign_btnzone'><input class='signmod_like_and_sign_btn j_sign_like' type='button' value='\u6210\u4e3a\u4f1a\u5458\u5e76\u7b7e\u5230'><input class='signmod_cancel_btn j_sign_cancel' type='button' value='\u518d\u8003\u8651\u4e00\u4e0b'></div>",holderClassName:"passportDialog",title:c,draggable:false,width:338,height:87});Stats.sendRequest("fr=tb0_forum&st_mod=frs&st_type=sign_like_show");var a=$(b.element[0]);a.find(".j_sign_like").click(function(){var d={fid:PageData.forum.id,fname:PageData.forum.name,uid:PageData.user.name_url,ie:"utf-8",tbs:PageData.tbs};$.tb.post(Balv.config.url.dolike,d,function(j){var e=false;try{var f=j}catch(g){e=true}if(e){return}if(f&&f.no==0){Stats.sendRequest("fr=tb0_forum&st_mod=frs&st_type=sign_like_succ&bduid="+PageData.user.bduid);var h={kw:PageData.forum.name,tbs:PageData.tbs,ie:"utf-8"};$.tb.post(Sign_rank.sign_url,h,function(n){var k=false;try{var l=n}catch(m){k=true}if(k){return}if(l&&l.no==0){Stats.sendRequest("fr=tb0_forum&st_mod=frs&st_type=sign_in_succ");if(PageData.forum.first_class=="\u4f53\u80b2"){Stats.sendRequest("fr=tb0_forum&st_mod=frs&st_type=pe_sign_in_succ")}$.tb.location.reload()}else{$.tb.location.reload()}},"json")}else{var i="";if(f.no==8||f.no==9){i="\u4f60\u5728\u672c\u5427\u88ab\u5c01\u7981\uff0c\u6682\u65f6\u4e0d\u80fd\u8fdb\u884c\u64cd\u4f5c"}else{if(f.no==220){i="\u4f60\u88ab\u5427\u4e3b\u52a0\u5165\u9ed1\u540d\u5355\uff0c\u6682\u65f6\u4e0d\u80fd\u8fdb\u884c\u64cd\u4f5c"}else{if(f.no==221){i="\u4f60\u5df2like\u4e86\u672c\u5427,\u8bf7\u4e0d\u8981\u91cd\u590d\u64cd\u4f5c"}else{i="\u62b1\u6b49\uff0c\u5f02\u5e38\u9519\u8bef\uff0c\u5efa\u8bae\u5237\u65b0\u9875\u9762\u91cd\u8bd5\u4e00\u4e0b"}}}new $.dialog({html:i,holderClassName:"passportDialog",title:c,draggable:false,width:338,height:87})}})});a.find(".j_sign_cancel").click(function(){b.close()})},refresh_sign_rank:function(){var a={kw:PageData.forum.name,ie:"utf-8",tbs:PageData.tbs};$.tb.get(Sign_rank.sign_forum,a,function(e){var b=false;try{var c=e}catch(d){b=true}if(b){return}if(c&&c.no==0){$(".j_today_signnum").html(c.data.forum_info.current_rank_info.sign_count);$(".j_signrank_index").html(c.data.forum_info.current_rank_info.sign_rank)}else{}})},show_block_sign_dialog:function(){var a=new $.dialog({html:"<div class='signmod_likeandsign_dialog'>\u5728\u672c\u5427\u7b7e\u5230\u9700\u8981\u5148\u6210\u4e3a\u4f1a\u5458\u54e6~\u52a0\u5165\u6211\u4eec\u5427\uff01</div><div class='signmod_likeandsign_btnzone'><input class='signmod_confirm_btn j_sign_confirm' type='button' value='\u77e5\u9053\u4e86' /></div>",holderClassName:"passportDialog",title:"\u672c\u5427\u7b7e\u5230",draggable:false,width:338,height:87});$(a.element[0]).find(".j_sign_confirm").click(function(){a.close()})},succ_text:function(c,b,d,a){if(a){if(a==9){return"\u4fdd\u6301\u8fde\u7eed\u7b7e\u5230\u5373\u53ef\u83b7\u5f97\u53d1\u8d34\u5b57\u4f53\u52a0\u7c97\u529f\u80fd\uff0c\u660e\u5929\u4e0d\u8981\u5fd8\u4e86\u6765\u7b7e\u5230\u54e6\u3002"}else{if(a==10){return"\u606d\u559c\u83b7\u5f97\u53d1\u8d34\u5b57\u4f53\u52a0\u7c97\u529f\u80fd\uff0c\u53d1\u8d34\u70ab\u8000\u5427\uff01\u4fdd\u6301\u8fde\u7eed\u7b7e\u5230\u54e6~"}else{if(a==19){return"\u4fdd\u6301\u8fde\u7eed\u7b7e\u5230\u5373\u53ef\u83b7\u5f97\u53d1\u8d34\u5b57\u4f53\u53d8\u7ea2\u529f\u80fd\uff0c\u660e\u5929\u4e0d\u8981\u5fd8\u4e86\u6765\u7b7e\u5230\u54e6\u3002"}else{if(a==20){return"\u606d\u559c\u83b7\u5f97\u53d1\u8d34\u5b57\u4f53\u53d8\u7ea2\u529f\u80fd\uff0c\u53d1\u8d34\u70ab\u8000\u5427\uff01\u4fdd\u6301\u8fde\u7eed\u7b7e\u5230\u54e6~"}else{if(a==29){return"\u5df2\u8fde\u7eed\u7b7e\u523029\u5929\uff0c\u660e\u65e5\u7b7e\u5230\u5373\u53ef\u83b7\u5f97ID\u7ea2\u8272\u9ad8\u4eae\u6548\u679c\uff0c\u4e0d\u8981\u5fd8\u4e86\u54e6~"}else{if(a==30){return"\u606d\u559c\u4f60\u83b7\u5f97ID\u7ea2\u8272\u9ad8\u4eae\u6548\u679c\uff0c\u8d76\u7d27\u53d1\u8d34\u70ab\u8000\u5427\u3002\u4fdd\u6301\u8fde\u7eed\u7b7e\u5230\u54e6~"}}}}}}}var e;if(b<=10){switch(parseInt(b)){case 1:e="\u606d\u559c\u4f60\u62a2\u5f97\u672c\u5427\u4eca\u65e5\u7b7e\u5230\u7b2c1\u540d\uff0c\u8d76\u7d27\u622a\u56fe\u7559\u5ff5\u5427~~";break;case 2:e="\u672c\u5427\u4eca\u65e5\u7b7e\u5230\u7b2c1\u4eba\u88ab\u62a2\u8d70\u4e86\u2026\u2026\u660e\u5929\u518d\u6765\u65e9\u4e00\u70b9\u5427~";break;default:e="\u606d\u559c\u4f60\u540d\u5217\u672c\u5427\u4eca\u65e5\u7b7e\u5230\u524d10\uff0c\u83b7\u5f97\u201c\u672c\u5427\u5fe0\u8bda\u5427\u53cb\u201d\u79f0\u53f7~";break}}else{if(b==100){e="\u54a6\uff0c\u4e00\u4e0d\u5c0f\u5fc3\u5c31\u8e29\u5230100\u4e86\uff0c\u4eca\u5929\u4f1a\u6709\u597d\u8fd0\u6c14\u5594~"}else{if(b==250){e="\u8bf7\u5728\u5fc3\u4e2d\u9ed8\u5ff53\u904d\uff1a\u6211\u4e0d\u662f250\u6211\u4e0d\u662f250\u6211\u4e0d\u662f250\u2026\u2026"}else{if(b==1000){e="\u524d\u9762999\u4eba\u7684\u7ecf\u8fc7\uff0c\u53ea\u4e3a\u4e86\u6210\u5168\u4f60\u7684\u5706\u6ee1\u2026\u2026"}else{if(b==10000){e="\u80fd\u8e29\u5230\u5982\u6b64\u5927\u6574\u5b9e\u5728\u662f\u4eba\u54c1\u7206\u68da\u554a\uff01\u53ef\u4ee5\u51fa\u95e8\u4e70\u5f69\u7968\u4e86~"}else{if(c<=100){switch(parseInt(c)){case 1:e="\u672c\u5427\u7b2c\u4e00\u7684\u5730\u4f4d\uff0c\u53c8\u7a33\u5b9a\u4e86\u7a33\u5b9a\u4e86\u7a33\u5b9a\u4e86\u2026\u2026";break;case 2:e="\u672c\u5427\u79bb\u7b2c\u4e00\u540d\u53c8\u8fd1\u4e86\u4e00\u70b9\u70b9\u70b9\u70b9\uff0c\u52a0\u6cb9\uff01";break;case 3:e="\u4fdd\u6301\u524d\u4e09\u540d\u4e0d\u5bb9\u6613\uff0c\u8bb0\u5f97\u660e\u5929\u8981\u6765\u7b7e\u5230\u54e6~~";break;default:if(c<=10){e="\u524d\u5341\u540d\u7ade\u4e89\u6fc0\u70c8\uff0c\u8bb0\u5f97\u6bcf\u5929\u90fd\u6765\u7b7e\u5230\u54e6~"}else{if(c<=30){e="\u79bb\u524d\u5341\u540d\u8fd8\u6709\u4e9b\u8ddd\u79bb\uff0c\u5927\u5bb6\u6765\u5f97\u66f4\u52e4\u5feb\u4e9b\u5427~"}else{e="\u4e00\u767e\u5f3a\u7684\u5730\u4f4d\u9700\u8981\u5927\u5bb6\u7684\u5171\u540c\u52aa\u529b\uff0c\u52a0\u6cb9\uff01"}}break}}else{e="\u8bb0\u5f97\u660e\u5929\u8981\u6765\u7b7e\u5230\u54e6\uff0c\u5e2e\u672c\u5427\u63d0\u5347\u6392\u540d~"}}}}}}return e},set_sign_calendar:function(a,q,d,s){var g=$("#sign_mod");if(q==""||typeof(q)=="undefined"){q=this.sign_year}if(d==""||typeof(d)=="undefined"){d=this.sign_month}if(typeof(s)!="undefined"){s=parseInt(s);if(s<0){d=d-1;if(d==0){q=q-1;d=12}}else{if(s>0){d=d+1;if(d==13){q=q+1;d=1}}else{}}if(s!=0){var o=PageData.user.id;$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:"frs",st_type:"sign_month_pager",uid:o})}}var c,u,k,r;c=new Date(q,d-1,1);u=new Date(q,d,0);k=c.getDay();r=u.getDate();g.find(".j_5, .j_6").css({display:"none"});for(var f=0;f<7;f++){g.find(".j_1_"+f+", .j_5_"+f+", .j_6_"+f).html("&nbsp;").addClass("emptyDate")}for(var b=1;b<32;b++){g.find(".j_d_"+b).removeClass("signed_day signed_mob_day signed_anime_day j_d_"+b).tbattr({title:""})}for(var h=1,f=k,b=1;r>0;f++,r--,b++){if(f==7){f=0;h++}if(h==5){g.find(".j_5").css({display:""})}if(h==6){g.find(".j_6").css({display:""})}g.find(".j_"+h+"_"+f).addClass("j_d_"+b).html(b).removeClass("emptyDate")}if(typeof(a)!="undefined"&&a!=""){p(a)}else{$.tb.get(this.month_url,{kw:PageData.forum.name,ie:"utf-8",sign_y:q,sign_m:d},function(i){if(i&&i.no==0){p(i)}else{alert(i.no);return}},"json")}this.sign_year=q;this.sign_month=d;if(String(d).length<2){d=d+"";d="0"+d}var l=q+"\u5e74"+d+"\u6708";g.find(".j_calendar_month").html(l);function p(z){var x=z.data.sign_user_info.sign_month;var m=["\uff0c\u7b7e\u5230\u7ecf\u9a8c+2\uff0c\u8fde\u7eed\u7b7e\u5230+4","\uff0c\u624b\u673a\u7b7e\u5230\u7ecf\u9a8c+3\uff0c\u8fde\u7eed\u7b7e\u5230+5","\uff0c\u767e\u5ea6\u6d4f\u89c8\u5668\u7b7e\u5230\u7ecf\u9a8c+3\uff0c\u8fde\u7eed\u7b7e\u5230+5","\uff0c\u767e\u5ea6\u624b\u673a\u6d4f\u89c8\u5668\u7b7e\u5230\u7ecf\u9a8c+4\uff0c\u8fde\u7eed\u7b7e\u5230+6","\uff0c\u624b\u673a\u5ba2\u6237\u7aef\u7b7e\u5230\u7ecf\u9a8c+4\uff0c\u8fde\u7eed\u7b7e\u5230+6",""];for(var v=0;v<x.length;v++){var w=x[v].t;var j=w.substr(0,w.indexOf(":"));var y=w.substr(w.indexOf(":")+1);var n="\u4e8e"+j+"\u70b9"+y+"\u5206\uff0c\u7b2c"+x[v].rank+"\u4e2a\u7b7e\u5230";if(j=="00"&&y=="00"&&x[v].rank==""){n="\u989d\uff0c\u670d\u52a1\u5668\u8fd9\u5929\u6253\u76f9\u4e86\uff0c\u6ca1\u8bb0\u4f4f\u4f60\u662f\u51e0\u70b9\u7b7e\u5230\u7684\uff0c\u62b1\u6b49..."}switch(x[v].sign_type){case"brs":g.find(".j_d_"+x[v].d).addClass("signed_day").tbattr({title:n+m[2]}).die().live("mouseenter",function(){$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:"frs",st_type:"sign_mouseover_title"})});break;case"mobile_brs":g.find(".j_d_"+x[v].d).addClass("signed_mob_day").tbattr({title:n+m[3]}).die().live("mouseenter",function(){$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:"frs",st_type:"sign_mouseover_title"})});break;case"mobile_client":g.find(".j_d_"+x[v].d).addClass("signed_mob_day").tbattr({title:n+m[4]}).die().live("mouseenter",function(){$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:"frs",st_type:"sign_mouseover_title"})});break;case"mobile":var t="\u4e8e"+j+"\u70b9"+y+"\u5206\uff0c\u7b2c"+x[v].rank+"\u4e2a\u7b7e\u5230\uff0c\u624b\u673a\u7b7e\u5230\u7ecf\u9a8c+3,\u8fde\u7eed\u7b7e\u5230\u7ecf\u9a8c+5";g.find(".j_d_"+x[v].d).addClass("signed_mob_day").tbattr({title:n+m[1]}).die().live("mouseenter",function(){$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:"frs",st_type:"sign_mouseover_title"})});break;case"pc":g.find(".j_d_"+x[v].d).addClass("signed_day").tbattr({title:n+m[0]}).die().live("mouseenter",function(){$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:"frs",st_type:"sign_mouseover_title"})});break;default:g.find(".j_d_"+x[v].d).addClass("signed_day").tbattr({title:n+m[5]}).die().live("mouseenter",function(){$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:"frs",st_type:"sign_mouseover_title"})});break}}}if((this.sign_month==this.orign_month)&&(this.sign_year==this.orign_year)){if(g.find(".j_d_"+(new Date(Env.server_time)).getDate()).hasClass("signed_day")||g.find(".j_d_"+(new Date(Env.server_time)).getDate()).hasClass("signed_mob_day")){}else{var e=$(".j_signin_index").html();g.find(".j_d_"+(new Date(Env.server_time)).getDate()).addClass("signed_day").tbattr({title:"\u4e8e"+(new Date(Env.server_time)).getHours()+"\u70b9"+(new Date(Env.server_time)).getMinutes()+"\u5206\uff0c\u7b2c"+e+"\u4e2a\u7b7e\u5230\uff0c\u7b7e\u5230\u7ecf\u9a8c+2\uff0c\u8fde\u7eed\u7b7e\u5230+4"})}}},pvLog:function(){$("#sign_promotionlink").click(function(){$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:"frs",st_type:"sign_promotionlink_click"})})},signShai:function(c){var b=this;var a=navigator.userAgent.match(/iPad/i)!=null;if(document.createElement("canvas").getContext!=undefined&&!$.browser.mozilla&&PageData.product=="frs"&&!a){_.Module.use("frs/component/SignShai",["sign_mod",c.data.sign_user_info],function(d){d.bind("startRender",function(){b.cal_mouseEventRemove()});d.bind("completeRender",function(){b.cal_mouseEnterOut()})})}},sign_100:function(c){if(!c){return}var d=new Date();var a=d.getFullYear()+"\u5e74"+(d.getMonth()+1)+"\u6708"+d.getDate()+"\u65e5";var f="";f="<div class='sign_100_dlg'><div class='sign_100_"+c.continueSign+"'></div><div class='sign_100_text'><div class='sign_100_close'></div><div class='sign_100_title'>\u4eb2\u7231\u7684"+c.username+"</div>";if(c.continueSign==100){f=f+"<div class='sign_100_content'>\u4eca\u5929\u662f\u4f60\u5728\u54b1\u4eec<span class='sign_baname_highlight'>"+c.forumname+"</span>\u5427\u7b7e\u5230\u7684<span class='rank_number'>\u7b2c"+c.continueSign+"\u5929</span>\uff0c\u503c\u5f97\u7eaa\u5ff5\u7684\u65e5\u5b50\uff0c\u6709\u6728\u6709\uff01<br/>\u65f6\u95f4\u8fc7\u5f97\u771f\u5feb\u54c8\uff0c\u4ece\u7b2c\u4e00\u6b21\u7b7e\u5230\u5230\u73b0\u5728\uff0c\u5df2\u6709"+c.continueSign+"\u4e2a\u503c\u5f97\u56de\u5473\u7684\u65e5\u65e5\u591c\u591c\u5728\u8fd9\u91cc\u7559\u5b58\u3002<br/>\u8ba9\u6211\u4eec\u611f\u5230\u5f00\u5fc3\u7684\u662f\uff0c\u4f60\u4ecd\u7136\u662f\u54b1\u4eec<span class='sign_baname_highlight'>"+c.forumname+"</span>\u5427\u7684"+c.memberCount+"\u4e2a<span class='sign_baname_highlight'>"+c.memberTitle+"</span>\u4e2d\u575a\u5b9e\u7684\u4e00\u4efd\u5b50\u3002<br/>\u4eca\u5929\uff0c\u7b7e\u5230"+c.continueSign+"\u5929\uff1b\u6b64\u540e\uff0c\u8ba9\u6211\u4eec\u4f9d\u7136\u5171\u540c\u6210\u957f\uff0c\u5e76\u5feb\u4e50\u3002<br/></div>"}else{f=f+"<div class='sign_100_content'>\u77e5\u9053\u5417\uff0c\u4eca\u5929\u662f\u4f60\u5728\u54b1\u4eec<span class='sign_baname_highlight'>"+c.forumname+"</span>\u5427\u7b7e\u5230\u7684<span class='rank_number'>\u7b2c"+c.continueSign+"\u5929</span>\uff0c\u6574\u6574\u4e00\u4e2a\u6708\u5566\uff01<br/>\u65f6\u95f4\u8fc7\u5f97\u633a\u5feb\u7684\u54c8\uff0c\u4ece\u4f60\u7b2c\u4e00\u6b21\u5230\u672c\u5427\u7b7e\u5230\uff0c\u70b9\u4e0e\u4e0d\u70b9\u95f4\uff0c\u5728\u8d34\u5427\u5ea6\u8fc7\u4e86"+c.continueSign+"\u4e2a\u7f8e\u597d\u7684\u65e5\u5b50\u3002<br/>\u4eca\u540e\u7684\u8def\u8fd8\u957f\u7740\u5462\uff0c\u8877\u5fc3\u5e0c\u671b\u4f60\u5728<span class='sign_baname_highlight'>"+c.forumname+"</span>\u5427\u7684\u6bcf\u4e00\u5929\u90fd\u80fd\u5f00\u5fc3\uff0c\u4e0e\u5168\u4f53\u5427\u53cb\u4eec\u76f8\u77e5\u76f8\u7231\u3002<br/>\u4eca\u5929\uff0c\u7b7e\u5230\u6ee1\u6708\uff1b\u6b64\u540e\uff0c\u8ba9\u6211\u4eec\u4f9d\u7136\u5171\u540c\u6210\u957f\u3002<br/></div>"}f=f+"<div class='sign_100_message'><a href='/i/sys/jump?un=%CC%F9%B0%C9%C7%A9%B5%BD%D0%A1%C3%D8%CA%E9' target='_blank'>\u8d34\u5427\u7b7e\u5230\u5c0f\u79d8\u4e66</a><img src='http://tb2.bdstatic.com/tb/img/itieba_vip.gif' title='\u8d34\u5427\u5b9e\u540d\u8ba4\u8bc1' class='verified_icon'>&nbsp;&nbsp;&nbsp;&nbsp;"+a+"&nbsp;&nbsp;&nbsp;&nbsp;<button class='j_sign_100_shai sign_100_shai_btn'>&nbsp;</button></div></div></div>";$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:"ucenter",st_type:"sign_100_display"+c.continueSign});var e=new $.dialog({html:f,holderClassName:"sign_100_wapper",width:"681",showTitle:false});$(e.element[0]).find(".sign_100_close").click(function(){e.close()});var b=navigator.userAgent.match(/iPad/i)!=null;if(document.createElement("canvas").getContext!=undefined&&!$.browser.mozilla&&PageData.product=="frs"&&!b){$(".j_sign_100_shai").show();_.Module.use("ucenter/component/sign100",["dialogJbody",c.continueSign],function(g){g.bind("completeRender",function(){e.close()})})}},sign_right_tips:function(b){var d=[PageUnit.load("sign_mod_tiptitle1"),PageUnit.load("sign_mod_tiptitle2"),PageUnit.load("sign_mod_tiptitle3"),PageUnit.load("sign_mod_tiptitle4"),PageUnit.load("sign_mod_tiptitle5")];var j=[PageUnit.load("sign_mod_tiptext1"),PageUnit.load("sign_mod_tiptext2"),PageUnit.load("sign_mod_tiptext3"),PageUnit.load("sign_mod_tiptext4"),PageUnit.load("sign_mod_tiptext5")];var g=[PageUnit.load("sign_mod_tipcondition1"),PageUnit.load("sign_mod_tipcondition2"),PageUnit.load("sign_mod_tipcondition3"),PageUnit.load("sign_mod_tipcondition4"),PageUnit.load("sign_mod_tipcondition5")];$(".sign_rights").css("position","relative").css("z-index","1");var a=[81,110,142,173,203];var h=b+1;var f={icon:"sign_big_icon_"+h,title:d[b],text:j[b],condition:g[b],position_right:13,arr_right:a[b]};if(this.options.modVersion=="bright"){var c={content:"<div class='sign_rights_tip'><div class='sign_rights_top clearfix'><div class='sign_rights_big_icon "+f.icon+"'></div><div class='sign_rights_text_wapper'><div class='sign_rights_title'>"+f.title+"</div><div class='sign_rights_title_text'>"+f.text+"</div></div></div><div class='sign_rights_popline'></div><div class='sign_rights_condition'>"+f.condition+"</div></div>",arrow_dir:"up",bubble_css:{top:25,right:17,width:250,"z-index":9999},arrow_pos:{left:f.arr_right},attr:" ",wrap:$(".sign_rights"),closeBtn:false}}else{var c={content:"<div class='sign_rights_tip'><div class='sign_rights_top clearfix'><div class='sign_rights_big_icon "+f.icon+"'></div><div class='sign_rights_text_wapper'><div class='sign_rights_title'>"+f.title+"</div><div class='sign_rights_title_text'>"+f.text+"</div></div></div><div class='sign_rights_popline'></div><div class='sign_rights_condition'>"+f.condition+"</div></div>",arrow_dir:"up",bubble_css:{top:35,right:f.position_right,width:250,"z-index":9999},arrow_pos:{left:f.arr_right},attr:" ",wrap:$(".sign_rights"),closeBtn:false}}if(Sign_rank.rights_tips[b]===null){var e=new UiBubbleTipBase(c);e.showBubble();Sign_rank.rights_tips[b]=e}else{Sign_rank.rights_tips[b].showBubble()}$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:"ucenter",st_type:"sign_rights_display_"+b})},check_rights_status:function(a){$(".j_sign_rights_icon:eq(0)").addClass("rights_get");$.stats.hive("sign_rights_exp1");if(a>=2){$(".j_sign_rights_icon:eq(1)").addClass("rights_get");$.stats.hive("sign_rights_exp2")}if(a>=10){$(".j_sign_rights_icon:eq(2)").addClass("rights_get");$.stats.hive("sign_rights_exp3")}if(a>=20){$(".j_sign_rights_icon:eq(3)").addClass("rights_get");$.stats.hive("sign_rights_exp4")}if(a>=30){$(".j_sign_rights_icon:eq(4)").addClass("rights_get");$.stats.hive("sign_rights_exp5")}},mobile_sign_tip:function(){var a=(new Date()-new Date("2012/11/20"))/86400000;if(a>=30||a<=0){return}if($.cookie("close_mobile_tip")=="true"){return}$("#j_sign_tip_holder").css("position","relative").css("z-index","1");var c={content:"<div class='sign_mob_tip clearfix'><div class='sign_mob_tip_icon'></div><div class='sign_mob_tip_text'>\u624b\u673a\u7b7e\u5230\u7ecf\u9a8c\u66f4\u591a\uff0c<br/>\u4f55\u4e0d\u8bd5\u8bd5\u624b\u673a\u8d34\u5427\u5ba2\u6237\u7aef\u3002<br/><a href='http://c.tieba.baidu.com/c/s/download/pc?src=webtbnotsign' target='_blank'>\u9a6c\u4e0a\u53bb\u4e0b\u8f7d>></a></div></div>",arrow_dir:"up",bubble_css:{top:0,right:15,width:230,"z-index":9999},arrow_pos:{left:140},attr:" ",wrap:$("#j_sign_tip_holder"),closeBtn:true};var b=new UiBubbleTipBase(c);b.showBubble();b.bind("onclose",function(){$.cookie("close_mobile_tip",true,{expires:3,path:"/"})},true)}};;_.Module.define({path:"ucenter/widget/sign_mod",sub:{_jq_wrap:null,_options:{},initial:function(b,a){this._jq_wrap=b;this._options=$.extend(this._options,a);this.signRank.options=a;this.signRank.sign_init(b,this._options);this.signRank.pvLog()},signRank:{sign_url:"/sign/add",sign_forum:"/sign/info",get_url:"/sign/loadmonth",month_url:"/sign/month",sign_card:null,sign_year:null,sign_month:null,orign_year:null,orign_month:null,rights_tips:[null,null,null,null,null],mouseEventTimer:null,rightsTipsTimer:null,jq_wrap:null,_client_html:['<div class="sign_card">','<h2 class="sign_card_title">\u5ba2\u6237\u7aef\u7b7e\u5230\u6709\u5956</h2>','<div class="sign_card_detail">\u5ba2\u6237\u7aef\u7b7e\u5230\u6700\u591a<span class="sign_client_strong">4\u500d</span>\u7ecf\u9a8c\uff0c</br>\u8fd8\u80fd\u514d\u8d39\u53c2\u4e0e\u62bd\u5956\u6d3b\u52a8\u3002</br>\u5feb\u53bb\u5ba2\u6237\u7aef\u5427\u3002</div>','<a href="http://c.tieba.baidu.com/c/s/download/pc?src=webtb&t=2&tab=1#img1" target="_blank" class="sign_card_positive_btn">\u6211\u89814\u500d\u7ecf\u9a8c\u548c\u5956\u54c1</a>','<a href="#" class="sign_card_negative_btn">\u4e0d\u8981\u5956\u54c1</a>',"</div>"].join(""),sign_init:function(a,l){var k=this;var d=this.jq_wrap=a;if($.cookie("add_sign")=="sign_rank"){if(!PageData.is_sign_in){k.showCardBeforeSign()}$.cookie("add_sign",null)}if($.cookie("sign_not_now")=="true"){if(PageData.forum.version=="1"){d.find(".j_signbtn").removeClass("j_cansign").addClass("sign_ing")}else{d.find(".j_signbtn").removeClass("j_cansign").addClass("signstar_ing")}setTimeout(function(){if(PageData.forum.version=="1"){d.find(".j_signbtn").removeClass("sign_ing").addClass("j_cansign")}else{d.find(".j_signbtn").removeClass("signstar_ing").addClass("j_cansign")}},10000)}k.mobile_sign_tip();if(PageData.is_sign_in){k.sign_resetdate();k.sign_load_month(0);k.cal_mouseEnterOut();setInterval(function(){k.refresh_sign_rank()},300000)}else{var g=new Date(Env.server_time);var h=g.getDay();if(PageData.forum.version=="1"){d.find(".j_signbtn").addClass("j_cansign sign"+h)}else{d.find(".j_signbtn").addClass("j_cansign")}}d.find(".fdir_rank a").click(function(){Stats.sendRequest("fr=tb0_forum&st_mod=frs&st_type=sign_fdir_entr")});d.on("click",".j_cansign",function(){$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:"frs",st_type:"sign_btn_click"});if(PageData.user.is_login){if(PageData.user.is_black){k.show_block_sign_dialog()}else{k.showCardBeforeSign()}}else{$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:PageData.product,st_type:"sign_login_display"});_.Module.use("common/component/LoginDialog",["","",function(){$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:PageData.product,st_type:"sign_login_succ",bduid:PageData.user.bduid});$.cookie("add_sign","sign_rank",{expires:14});$.tb.location.reload()}])}});d.find(".j_calendar_month_prev").click(function(){var n=new Date(k.sign_year,k.sign_month-1,1);var m=new Date(k.orign_year-2,k.orign_month-1,1);var o=new Date(2012,6,1);if(n.getTime()<=m.getTime()||n.getTime()<=o.getTime()){return}else{k.set_sign_calendar("",k.sign_year,k.sign_month,-1)}});d.find(".j_calendar_month_next").click(function(m){if(k.sign_year>k.orign_year||k.sign_year==k.orign_year&&k.sign_month>=k.orign_month){return}else{k.set_sign_calendar("",k.sign_year,k.sign_month,1)}});if(PageData.user.is_login){d.find(".j_sign_rights").show();d.find(".j_sign_rights_icon").each(function(m,n){$(n).mouseover(function(){k.rightsTipsTimer=setTimeout(function(){k.sign_right_tips(m)},400)}).mouseout(function(){window.clearInterval(k.rightsTipsTimer);k.rightsTipsTimer=window.setTimeout(function(){if(k.rights_tips[m]!=null){k.rights_tips[m].hideBubble()}},10)})})}var j=d.find(".j_sign_box");j.hover(function(){$(this).addClass(l.hasClass?"sign_box_bright_hover":"sign_box_bright_noclass_hover")},function(){$(this).removeClass(l.hasClass?"sign_box_bright_hover":"sign_box_bright_noclass_hover")});var e=d.find(".j_sign_dir_tip");var c=e.html();e.html("");var b={content:c,arrow_dir:"up",bubble_css:{top:-12,left:l.hasClass?4:50,width:l.hasClass?(l.page=="pb"?192:200):120,"text-align":"left"},arrow_pos:{right:l.hasClass?30:-9},attr:" id='tb_message_tip_n' ",wrap:e,closeBtn:false};var f=new UiBubbleTipBase(b);var i=j.find(".j_signdir");i.bind("mouseenter",function(){e.show();f.showBubble()}).bind("mouseleave",function(){f.hideBubble()})},showCardBeforeSign:function(){var a=this;if($.cookie("showCardBeforeSign")=="1"||a.sign_card){a.sign_add()}else{_.Module.use("common/component/Card",[{content:a._client_html,arrow_dir:"up",card_css:{width:197,top:$(".j_signbtn").offset().top+$(".j_signbtn").height()+11,left:$(".j_signbtn").offset().left},card_leave_hide:true}],function(b){a.sign_card=b;a.bindCardEvent();b.showCard();$.cookie("showCardBeforeSign","1",{expires:1})})}},bindCardEvent:function(){var a=this;$(".sign_card_negative_btn").on("click",function(b){b.preventDefault();a.sign_card&&a.sign_card._j_card.hide();a.sign_add()})},sign_resetdate:function(){var a=new Date(Env.server_time);this.sign_year=this.orign_year=a.getFullYear();this.sign_month=this.orign_month=a.getMonth()+1},cal_mouseEnterOut:function(){var b=this;var c=this.jq_wrap;var a;c.find(".j_signbtn,.j_succ_info").die().live({mouseout:function(){window.clearInterval(b.mouseEventTimer);b.mouseEventTimer=window.setTimeout(function(){c.find(".j_succ_info").fadeOut("slow");if(c.find(".j_succ_info").css("display")=="none"){$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:"frs",st_type:"sign_pop_dialog"})}},10)},mouseover:function(){if(c.find(".j_succ_info").css("display")=="none"){if(b.orign_year!=b.sign_year||b.orign_month!=b.sign_month){b.sign_resetdate();b.sign_load_month(0)}}window.clearInterval(b.mouseEventTimer);b.mouseEventTimer=setTimeout(function(){c.find(".j_succ_info").stop(true,true).show()},400)}})},cal_mouseEventRemove:function(){window.clearInterval(self.mouseEventTimer);this.jq_wrap.find(".j_signbtn,.j_succ_info").die()},sign_add:function(){var a=this;if(PageData.forum.version=="1"){this.jq_wrap.find(".j_signbtn").removeClass("j_cansign").addClass("sign_ing")}else{this.jq_wrap.find(".j_signbtn").removeClass("j_cansign").addClass("signstar_ing")}var b={kw:PageData.forum.name,tbs:PageData.tbs,ie:"utf-8"};$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:PageData.product,st_type:"sign_in_num"});$.tb.post(a.sign_url,b,function(f){if(f&&(f.no==0||f.no==1104)){$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:"frs",st_type:"sign_in_succ"});a.jq_wrap.find(".j_today_signnum").html(f.data.finfo.current_rank_info.sign_count);var h=PageData.forum.version>=2?2:1;var g=f.data.uinfo.sign_time;var c=new Date(g);a.sign_year=a.orign_year=c.getFullYear();a.sign_month=a.orign_month=c.getMonth()+1;a.sign_load_month(1)}else{setTimeout(function(){if(PageData.forum.version=="1"){a.jq_wrap.find(".j_signbtn").removeClass("sign_ing").addClass("j_cansign")}else{a.jq_wrap.find(".j_signbtn").removeClass("signstar_ing").addClass("j_cansign")}},10000);var e=new Date();e.setTime(e.getTime()+(10*1000));$.cookie("sign_not_now",true,{expires:e});if(f.no==1007){var h=PageData.forum.version>=2?2:1;var d=a.jq_wrap.find(".j_signbtn");if(PageData.forum.version=="1"){d.removeClass().addClass("j_signbtn sign_btn"+h+" sign_full")}else{d.removeClass().addClass("j_signbtn signstar_full")}}else{new $.dialog({html:"<div class='signmod_likeandsign_dialog'>"+f.error+"</div>",holderClassName:"passportDialog",title:"\u7b7e\u5230\u5931\u8d25",draggable:false,width:338,height:87})}}},"json")},sign_load_month:function(b){var a=this;$.tb.get(a.get_url,{kw:PageData.forum.name,ie:"utf-8"},function(p){if(p&&p.no==0){a.jq_wrap.find(".j_signin_index").html(p.data.sign_user_info.rank);a.jq_wrap.find(".j_succ_text").html(a.succ_text(PageData.forum.sign_in_info.forum_info.current_rank_info.sign_rank,p.data.sign_user_info.rank,PageData.forum.sign_in_info.forum_info.forum_info&&PageData.forum.sign_in_info.forum_info.forum_info.level_1_dir_name,p.data.sign_user_info.sign_keep));a.jq_wrap.find(".j_sign_succ_keep").html(p.data.sign_user_info.sign_keep);a.jq_wrap.find(".j_sign_succ_count").html(p.data.sign_user_info.sign_total);var c=p.data.sign_user_info.sign_month;var k=(new Date()).getDate();for(var g=c.length-1;g>=0;g--){var h=c[g];if(h.d==k){if(h.sign_type=="mobile_client"){$(".j_sign_succ_txt").html('\u5df2\u901a\u8fc7\u5ba2\u6237\u7aef\u7b7e\u5230\uff0c\u8d5a\u4e86<span class="sign_client_strong">4\u500d</span>\u7ecf\u9a8c\uff0c\u660e\u5929\u7ee7\u7eed\u518d\u63a5\u518d\u52b1~')}break}}a.sign_resetdate();a.set_sign_calendar(p);a.signShai(p);a.check_rights_status(p.data.sign_user_info.sign_keep);var f=a.jq_wrap.find(".j_signbtn");if(PageData.forum.version=="1"){f.removeClass().addClass("j_signbtn sign_btn"+frsversion+" sign"+f.tbattr("data-dw")+"_signed")}else{var m=a.jq_wrap.find(".j_sign_box");if(m[0]){m.addClass(a.options.hasClass?"sign_box_bright_signed":"sign_box_bright_noclass_signed")}f.removeClass().addClass("j_signbtn signstar_signed")}if(b){if(p.data.sign_user_info.sign_keep==30||p.data.sign_user_info.sign_keep==100){var o={username:PageData.user.name,forumname:PageData.forum.name,continueSign:p.data.sign_user_info.sign_keep,memberCount:PageData.memberNumber,memberTitle:PageData.memberTitle};a.sign_100(o)}a.jq_wrap.find(".j_succ_info").show();var d='<span class="sign_keep_span">\u8fde\u7eed '+p.data.sign_user_info.sign_keep+" \u5929</span>";var n=p.data.sign_user_info.sign_keep>1?"4":"2";var l;try{l="baidubrowser.tieba"==window.external.GetVersion("version")?true:false}catch(j){l=null}if(l){n=p.data.sign_user_info.sign_keep>1?"5":"3"}f.append(d);if(PageData.user.is_like&&!PageData.user.is_block){a.jq_wrap.find(".signed_day:last").append('<div style="position:absolute;"><div class="sign_plus_two">+'+n+" \u7ecf\u9a8c</div></div>");setTimeout(function(){$(".sign_plus_two").show().animate({opacity:0,top:"-=20"},2500)},1000)}a.jq_wrap.find(".signed_day:last").removeClass("signed_day").addClass("signed_anime_day")}else{a.jq_wrap.find(".j_sign_btn_keep").text(p.data.sign_user_info.sign_keep)}a.cal_mouseEnterOut()}else{}},"json")},sign_like_and_sign:function(d){var a=this;$("#j_sign_tip_holder .tip_v_2 img").click();var c=new $.dialog({html:"<div class='signmod_likeandsign_dialog'>\u5728\u672c\u5427\u7b7e\u5230\u9700\u8981\u5148\u6210\u4e3a\u4f1a\u5458\u54e6~\u52a0\u5165\u6211\u4eec\u5427\uff01</div><div class='signmod_likeandsign_btnzone'><input class='signmod_like_and_sign_btn j_sign_like' type='button' value='\u6210\u4e3a\u4f1a\u5458\u5e76\u7b7e\u5230'><input class='signmod_cancel_btn j_sign_cancel' type='button' value='\u518d\u8003\u8651\u4e00\u4e0b'></div>",holderClassName:"passportDialog",title:d,draggable:false,width:338,height:87});Stats.sendRequest("fr=tb0_forum&st_mod=frs&st_type=sign_like_show");var b=$(c.element[0]);b.find(".j_sign_like").click(function(){var e={fid:PageData.forum.id,fname:PageData.forum.name,uid:PageData.user.name_url,ie:"utf-8",tbs:PageData.tbs};$.tb.post(Balv.config.url.dolike,e,function(k){var f=false;try{var g=k}catch(h){f=true}if(f){return}if(g&&g.no==0){Stats.sendRequest("fr=tb0_forum&st_mod=frs&st_type=sign_like_succ&bduid="+PageData.user.bduid);var i={kw:PageData.forum.name,tbs:PageData.tbs,ie:"utf-8"};$.tb.post(a.sign_url,i,function(o){var l=false;try{var m=o}catch(n){l=true}if(l){return}if(m&&m.no==0){Stats.sendRequest("fr=tb0_forum&st_mod=frs&st_type=sign_in_succ");if(PageData.forum.first_class=="\u4f53\u80b2"){Stats.sendRequest("fr=tb0_forum&st_mod=frs&st_type=pe_sign_in_succ")}$.tb.location.reload()}else{$.tb.location.reload()}},"json")}else{var j="";if(g.no==8||g.no==9){j="\u4f60\u5728\u672c\u5427\u88ab\u5c01\u7981\uff0c\u6682\u65f6\u4e0d\u80fd\u8fdb\u884c\u64cd\u4f5c"}else{if(g.no==220){j="\u4f60\u88ab\u5427\u4e3b\u52a0\u5165\u9ed1\u540d\u5355\uff0c\u6682\u65f6\u4e0d\u80fd\u8fdb\u884c\u64cd\u4f5c"}else{if(g.no==221){j="\u4f60\u5df2like\u4e86\u672c\u5427,\u8bf7\u4e0d\u8981\u91cd\u590d\u64cd\u4f5c"}else{j="\u62b1\u6b49\uff0c\u5f02\u5e38\u9519\u8bef\uff0c\u5efa\u8bae\u5237\u65b0\u9875\u9762\u91cd\u8bd5\u4e00\u4e0b"}}}new $.dialog({html:j,holderClassName:"passportDialog",title:d,draggable:false,width:338,height:87})}})});b.find(".j_sign_cancel").click(function(){c.close()})},refresh_sign_rank:function(){var a={kw:PageData.forum.name,ie:"utf-8",tbs:PageData.tbs};$.tb.get(this.sign_forum,a,function(e){var b=false;try{var c=e}catch(d){b=true}if(b){return}if(c&&c.no==0){$(".j_today_signnum").html(c.data.forum_info.current_rank_info.sign_count);$(".j_signrank_index").html(c.data.forum_info.current_rank_info.sign_rank)}else{}})},show_block_sign_dialog:function(){var a=new $.dialog({html:"<div class='signmod_likeandsign_dialog'>\u5728\u672c\u5427\u7b7e\u5230\u9700\u8981\u5148\u6210\u4e3a\u4f1a\u5458\u54e6~\u52a0\u5165\u6211\u4eec\u5427\uff01</div><div class='signmod_likeandsign_btnzone'><input class='signmod_confirm_btn j_sign_confirm' type='button' value='\u77e5\u9053\u4e86' /></div>",holderClassName:"passportDialog",title:"\u672c\u5427\u7b7e\u5230",draggable:false,width:338,height:87});$(a.element[0]).find(".j_sign_confirm").click(function(){a.close()})},succ_text:function(c,b,d,a){if(a){if(a==9){return"\u4fdd\u6301\u8fde\u7eed\u7b7e\u5230\u5373\u53ef\u83b7\u5f97\u53d1\u8d34\u5b57\u4f53\u52a0\u7c97\u529f\u80fd\uff0c\u660e\u5929\u4e0d\u8981\u5fd8\u4e86\u6765\u7b7e\u5230\u54e6\u3002"}else{if(a==10){return"\u606d\u559c\u83b7\u5f97\u53d1\u8d34\u5b57\u4f53\u52a0\u7c97\u529f\u80fd\uff0c\u53d1\u8d34\u70ab\u8000\u5427\uff01\u4fdd\u6301\u8fde\u7eed\u7b7e\u5230\u54e6~"}else{if(a==19){return"\u4fdd\u6301\u8fde\u7eed\u7b7e\u5230\u5373\u53ef\u83b7\u5f97\u53d1\u8d34\u5b57\u4f53\u53d8\u7ea2\u529f\u80fd\uff0c\u660e\u5929\u4e0d\u8981\u5fd8\u4e86\u6765\u7b7e\u5230\u54e6\u3002"}else{if(a==20){return"\u606d\u559c\u83b7\u5f97\u53d1\u8d34\u5b57\u4f53\u53d8\u7ea2\u529f\u80fd\uff0c\u53d1\u8d34\u70ab\u8000\u5427\uff01\u4fdd\u6301\u8fde\u7eed\u7b7e\u5230\u54e6~"}else{if(a==29){return"\u5df2\u8fde\u7eed\u7b7e\u523029\u5929\uff0c\u660e\u65e5\u7b7e\u5230\u5373\u53ef\u83b7\u5f97ID\u7ea2\u8272\u9ad8\u4eae\u6548\u679c\uff0c\u4e0d\u8981\u5fd8\u4e86\u54e6~"}else{if(a==30){return"\u606d\u559c\u4f60\u83b7\u5f97ID\u7ea2\u8272\u9ad8\u4eae\u6548\u679c\uff0c\u8d76\u7d27\u53d1\u8d34\u70ab\u8000\u5427\u3002\u4fdd\u6301\u8fde\u7eed\u7b7e\u5230\u54e6~"}}}}}}}var e;if(b<=10){switch(parseInt(b)){case 1:e="\u606d\u559c\u4f60\u62a2\u5f97\u672c\u5427\u4eca\u65e5\u7b7e\u5230\u7b2c1\u540d\uff0c\u8d76\u7d27\u622a\u56fe\u7559\u5ff5\u5427~~";break;case 2:e="\u672c\u5427\u4eca\u65e5\u7b7e\u5230\u7b2c1\u4eba\u88ab\u62a2\u8d70\u4e86\u2026\u2026\u660e\u5929\u518d\u6765\u65e9\u4e00\u70b9\u5427~";break;default:e="\u606d\u559c\u4f60\u540d\u5217\u672c\u5427\u4eca\u65e5\u7b7e\u5230\u524d10\uff0c\u83b7\u5f97\u201c\u672c\u5427\u5fe0\u8bda\u5427\u53cb\u201d\u79f0\u53f7~";break}}else{if(b==100){e="\u54a6\uff0c\u4e00\u4e0d\u5c0f\u5fc3\u5c31\u8e29\u5230100\u4e86\uff0c\u4eca\u5929\u4f1a\u6709\u597d\u8fd0\u6c14\u5594~"}else{if(b==250){e="\u8bf7\u5728\u5fc3\u4e2d\u9ed8\u5ff53\u904d\uff1a\u6211\u4e0d\u662f250\u6211\u4e0d\u662f250\u6211\u4e0d\u662f250\u2026\u2026"}else{if(b==1000){e="\u524d\u9762999\u4eba\u7684\u7ecf\u8fc7\uff0c\u53ea\u4e3a\u4e86\u6210\u5168\u4f60\u7684\u5706\u6ee1\u2026\u2026"}else{if(b==10000){e="\u80fd\u8e29\u5230\u5982\u6b64\u5927\u6574\u5b9e\u5728\u662f\u4eba\u54c1\u7206\u68da\u554a\uff01\u53ef\u4ee5\u51fa\u95e8\u4e70\u5f69\u7968\u4e86~"}else{if(c<=100){switch(parseInt(c)){case 1:e="\u672c\u5427\u7b2c\u4e00\u7684\u5730\u4f4d\uff0c\u53c8\u7a33\u5b9a\u4e86\u7a33\u5b9a\u4e86\u7a33\u5b9a\u4e86\u2026\u2026";break;case 2:e="\u672c\u5427\u79bb\u7b2c\u4e00\u540d\u53c8\u8fd1\u4e86\u4e00\u70b9\u70b9\u70b9\u70b9\uff0c\u52a0\u6cb9\uff01";break;case 3:e="\u4fdd\u6301\u524d\u4e09\u540d\u4e0d\u5bb9\u6613\uff0c\u8bb0\u5f97\u660e\u5929\u8981\u6765\u7b7e\u5230\u54e6~~";break;default:if(c<=10){e="\u524d\u5341\u540d\u7ade\u4e89\u6fc0\u70c8\uff0c\u8bb0\u5f97\u6bcf\u5929\u90fd\u6765\u7b7e\u5230\u54e6~"}else{if(c<=30){e="\u79bb\u524d\u5341\u540d\u8fd8\u6709\u4e9b\u8ddd\u79bb\uff0c\u5927\u5bb6\u6765\u5f97\u66f4\u52e4\u5feb\u4e9b\u5427~"}else{e="\u4e00\u767e\u5f3a\u7684\u5730\u4f4d\u9700\u8981\u5927\u5bb6\u7684\u5171\u540c\u52aa\u529b\uff0c\u52a0\u6cb9\uff01"}}break}}else{e="\u8bb0\u5f97\u660e\u5929\u8981\u6765\u7b7e\u5230\u54e6\uff0c\u5e2e\u672c\u5427\u63d0\u5347\u6392\u540d~"}}}}}}return e},set_sign_calendar:function(a,q,d,s){var g=this.jq_wrap;if(q==""||typeof(q)=="undefined"){q=this.sign_year}if(d==""||typeof(d)=="undefined"){d=this.sign_month}if(typeof(s)!="undefined"){s=parseInt(s);if(s<0){d=d-1;if(d==0){q=q-1;d=12}}else{if(s>0){d=d+1;if(d==13){q=q+1;d=1}}else{}}if(s!=0){var o=PageData.user.id;$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:"frs",st_type:"sign_month_pager",uid:o})}}var c,u,k,r;c=new Date(q,d-1,1);u=new Date(q,d,0);k=c.getDay();r=u.getDate();g.find(".j_5, .j_6").css({display:"none"});for(var f=0;f<7;f++){g.find(".j_1_"+f+", .j_5_"+f+", .j_6_"+f).html("&nbsp;").addClass("emptyDate")}for(var b=1;b<32;b++){g.find(".j_d_"+b).removeClass("signed_day signed_mob_day signed_anime_day j_d_"+b).tbattr({title:""})}for(var h=1,f=k,b=1;r>0;f++,r--,b++){if(f==7){f=0;h++}if(h==5){g.find(".j_5").css({display:""})}if(h==6){g.find(".j_6").css({display:""})}g.find(".j_"+h+"_"+f).addClass("j_d_"+b).html(b).removeClass("emptyDate")}if(typeof(a)!="undefined"&&a!=""){p(a)}else{$.tb.get(this.month_url,{kw:PageData.forum.name,ie:"utf-8",sign_y:q,sign_m:d},function(i){if(i&&i.no==0){p(i)}else{alert(i.no);return}},"json")}this.sign_year=q;this.sign_month=d;if(String(d).length<2){d=d+"";d="0"+d}var l=q+"\u5e74"+d+"\u6708";g.find(".j_calendar_month").html(l);function p(z){var x=z.data.sign_user_info.sign_month;var m=["\uff0c\u7b7e\u5230\u7ecf\u9a8c+2\uff0c\u8fde\u7eed\u7b7e\u5230+4","\uff0c\u624b\u673a\u7b7e\u5230\u7ecf\u9a8c+3\uff0c\u8fde\u7eed\u7b7e\u5230+5","\uff0c\u767e\u5ea6\u6d4f\u89c8\u5668\u7b7e\u5230\u7ecf\u9a8c+3\uff0c\u8fde\u7eed\u7b7e\u5230+5","\uff0c\u767e\u5ea6\u624b\u673a\u6d4f\u89c8\u5668\u7b7e\u5230\u7ecf\u9a8c+4\uff0c\u8fde\u7eed\u7b7e\u5230+6","\uff0c\u624b\u673a\u5ba2\u6237\u7aef\u7b7e\u5230\u7ecf\u9a8c+4\uff0c\u8fde\u7eed\u7b7e\u5230+6",""];for(var v=0;v<x.length;v++){var w=x[v].t;var j=w.substr(0,w.indexOf(":"));var y=w.substr(w.indexOf(":")+1);var n="\u4e8e"+j+"\u70b9"+y+"\u5206\uff0c\u7b2c"+x[v].rank+"\u4e2a\u7b7e\u5230";if(j=="00"&&y=="00"&&x[v].rank==""){n="\u989d\uff0c\u670d\u52a1\u5668\u8fd9\u5929\u6253\u76f9\u4e86\uff0c\u6ca1\u8bb0\u4f4f\u4f60\u662f\u51e0\u70b9\u7b7e\u5230\u7684\uff0c\u62b1\u6b49..."}switch(x[v].sign_type){case"brs":g.find(".j_d_"+x[v].d).addClass("signed_day").tbattr({title:n+m[2]}).die().live("mouseenter",function(){$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:"frs",st_type:"sign_mouseover_title"})});break;case"mobile_brs":g.find(".j_d_"+x[v].d).addClass("signed_mob_day").tbattr({title:n+m[3]}).die().live("mouseenter",function(){$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:"frs",st_type:"sign_mouseover_title"})});break;case"mobile_client":g.find(".j_d_"+x[v].d).addClass("signed_mob_day").tbattr({title:n+m[4]}).die().live("mouseenter",function(){$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:"frs",st_type:"sign_mouseover_title"})});break;case"mobile":var t="\u4e8e"+j+"\u70b9"+y+"\u5206\uff0c\u7b2c"+x[v].rank+"\u4e2a\u7b7e\u5230\uff0c\u624b\u673a\u7b7e\u5230\u7ecf\u9a8c+3,\u8fde\u7eed\u7b7e\u5230\u7ecf\u9a8c+5";g.find(".j_d_"+x[v].d).addClass("signed_mob_day").tbattr({title:n+m[1]}).die().live("mouseenter",function(){$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:"frs",st_type:"sign_mouseover_title"})});break;case"pc":g.find(".j_d_"+x[v].d).addClass("signed_day").tbattr({title:n+m[0]}).die().live("mouseenter",function(){$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:"frs",st_type:"sign_mouseover_title"})});break;default:g.find(".j_d_"+x[v].d).addClass("signed_day").tbattr({title:n+m[5]}).die().live("mouseenter",function(){$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:"frs",st_type:"sign_mouseover_title"})});break}}}if((this.sign_month==this.orign_month)&&(this.sign_year==this.orign_year)){if(g.find(".j_d_"+(new Date(Env.server_time)).getDate()).hasClass("signed_day")||g.find(".j_d_"+(new Date(Env.server_time)).getDate()).hasClass("signed_mob_day")){}else{var e=$(".j_signin_index").html();g.find(".j_d_"+(new Date(Env.server_time)).getDate()).addClass("signed_day").tbattr({title:"\u4e8e"+(new Date(Env.server_time)).getHours()+"\u70b9"+(new Date(Env.server_time)).getMinutes()+"\u5206\uff0c\u7b2c"+e+"\u4e2a\u7b7e\u5230\uff0c\u7b7e\u5230\u7ecf\u9a8c+2\uff0c\u8fde\u7eed\u7b7e\u5230+4"})}}},pvLog:function(){$("#sign_promotionlink").click(function(){$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:"frs",st_type:"sign_promotionlink_click"})})},signShai:function(c){var b=this;var a=navigator.userAgent.match(/iPad/i)!=null;if(document.createElement("canvas").getContext!=undefined&&!$.browser.mozilla&&PageData.product=="frs"&&!a){_.Module.use("frs/component/SignShai",["sign_mod",c.data.sign_user_info],function(d){d.bind("startRender",function(){b.cal_mouseEventRemove()});d.bind("completeRender",function(){b.cal_mouseEnterOut()})})}},sign_100:function(c){if(!c){return}var d=new Date();var a=d.getFullYear()+"\u5e74"+(d.getMonth()+1)+"\u6708"+d.getDate()+"\u65e5";var f="";f="<div class='sign_100_dlg'><div class='sign_100_"+c.continueSign+"'></div><div class='sign_100_text'><div class='sign_100_close'></div><div class='sign_100_title'>\u4eb2\u7231\u7684"+c.username+"</div>";if(c.continueSign==100){f=f+"<div class='sign_100_content'>\u4eca\u5929\u662f\u4f60\u5728\u54b1\u4eec<span class='sign_baname_highlight'>"+c.forumname+"</span>\u5427\u7b7e\u5230\u7684<span class='rank_number'>\u7b2c"+c.continueSign+"\u5929</span>\uff0c\u503c\u5f97\u7eaa\u5ff5\u7684\u65e5\u5b50\uff0c\u6709\u6728\u6709\uff01<br/>\u65f6\u95f4\u8fc7\u5f97\u771f\u5feb\u54c8\uff0c\u4ece\u7b2c\u4e00\u6b21\u7b7e\u5230\u5230\u73b0\u5728\uff0c\u5df2\u6709"+c.continueSign+"\u4e2a\u503c\u5f97\u56de\u5473\u7684\u65e5\u65e5\u591c\u591c\u5728\u8fd9\u91cc\u7559\u5b58\u3002<br/>\u8ba9\u6211\u4eec\u611f\u5230\u5f00\u5fc3\u7684\u662f\uff0c\u4f60\u4ecd\u7136\u662f\u54b1\u4eec<span class='sign_baname_highlight'>"+c.forumname+"</span>\u5427\u7684"+c.memberCount+"\u4e2a<span class='sign_baname_highlight'>"+c.memberTitle+"</span>\u4e2d\u575a\u5b9e\u7684\u4e00\u4efd\u5b50\u3002<br/>\u4eca\u5929\uff0c\u7b7e\u5230"+c.continueSign+"\u5929\uff1b\u6b64\u540e\uff0c\u8ba9\u6211\u4eec\u4f9d\u7136\u5171\u540c\u6210\u957f\uff0c\u5e76\u5feb\u4e50\u3002<br/></div>"}else{f=f+"<div class='sign_100_content'>\u77e5\u9053\u5417\uff0c\u4eca\u5929\u662f\u4f60\u5728\u54b1\u4eec<span class='sign_baname_highlight'>"+c.forumname+"</span>\u5427\u7b7e\u5230\u7684<span class='rank_number'>\u7b2c"+c.continueSign+"\u5929</span>\uff0c\u6574\u6574\u4e00\u4e2a\u6708\u5566\uff01<br/>\u65f6\u95f4\u8fc7\u5f97\u633a\u5feb\u7684\u54c8\uff0c\u4ece\u4f60\u7b2c\u4e00\u6b21\u5230\u672c\u5427\u7b7e\u5230\uff0c\u70b9\u4e0e\u4e0d\u70b9\u95f4\uff0c\u5728\u8d34\u5427\u5ea6\u8fc7\u4e86"+c.continueSign+"\u4e2a\u7f8e\u597d\u7684\u65e5\u5b50\u3002<br/>\u4eca\u540e\u7684\u8def\u8fd8\u957f\u7740\u5462\uff0c\u8877\u5fc3\u5e0c\u671b\u4f60\u5728<span class='sign_baname_highlight'>"+c.forumname+"</span>\u5427\u7684\u6bcf\u4e00\u5929\u90fd\u80fd\u5f00\u5fc3\uff0c\u4e0e\u5168\u4f53\u5427\u53cb\u4eec\u76f8\u77e5\u76f8\u7231\u3002<br/>\u4eca\u5929\uff0c\u7b7e\u5230\u6ee1\u6708\uff1b\u6b64\u540e\uff0c\u8ba9\u6211\u4eec\u4f9d\u7136\u5171\u540c\u6210\u957f\u3002<br/></div>"}f=f+"<div class='sign_100_message'><a href='/i/sys/jump?un=%CC%F9%B0%C9%C7%A9%B5%BD%D0%A1%C3%D8%CA%E9' target='_blank'>\u8d34\u5427\u7b7e\u5230\u5c0f\u79d8\u4e66</a><img src='http://tb2.bdstatic.com/tb/img/itieba_vip.gif' title='\u8d34\u5427\u5b9e\u540d\u8ba4\u8bc1' class='verified_icon'>&nbsp;&nbsp;&nbsp;&nbsp;"+a+"&nbsp;&nbsp;&nbsp;&nbsp;<button class='j_sign_100_shai sign_100_shai_btn'>&nbsp;</button></div></div></div>";$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:"ucenter",st_type:"sign_100_display"+c.continueSign});var e=new $.dialog({html:f,holderClassName:"sign_100_wapper",width:"681",showTitle:false});$(e.element[0]).find(".sign_100_close").click(function(){e.close()});var b=navigator.userAgent.match(/iPad/i)!=null;if(document.createElement("canvas").getContext!=undefined&&!$.browser.mozilla&&PageData.product=="frs"&&!b){$(".j_sign_100_shai").show();_.Module.use("ucenter/component/sign100",["dialogJbody",c.continueSign],function(g){g.bind("completeRender",function(){e.close()})})}},sign_right_tips:function(b){var d=[PageUnit.load("sign_mod_tiptitle1"),PageUnit.load("sign_mod_tiptitle2"),PageUnit.load("sign_mod_tiptitle3"),PageUnit.load("sign_mod_tiptitle4"),PageUnit.load("sign_mod_tiptitle5")];var j=[PageUnit.load("sign_mod_tiptext1"),PageUnit.load("sign_mod_tiptext2"),PageUnit.load("sign_mod_tiptext3"),PageUnit.load("sign_mod_tiptext4"),PageUnit.load("sign_mod_tiptext5")];var g=[PageUnit.load("sign_mod_tipcondition1"),PageUnit.load("sign_mod_tipcondition2"),PageUnit.load("sign_mod_tipcondition3"),PageUnit.load("sign_mod_tipcondition4"),PageUnit.load("sign_mod_tipcondition5")];$(".sign_rights").css("position","relative").css("z-index","1");var a=[81,110,142,173,203];var h=b+1;var f={icon:"sign_big_icon_"+h,title:d[b],text:j[b],condition:g[b],position_right:13,arr_right:a[b]};var c={content:"<div class='sign_rights_tip'><div class='sign_rights_top clearfix'><div class='sign_rights_big_icon "+f.icon+"'></div><div class='sign_rights_text_wapper'><div class='sign_rights_title'>"+f.title+"</div><div class='sign_rights_title_text'>"+f.text+"</div></div></div><div class='sign_rights_popline'></div><div class='sign_rights_condition'>"+f.condition+"</div></div>",arrow_dir:"up",bubble_css:{top:35,right:f.position_right,width:250,"z-index":9999},arrow_pos:{left:f.arr_right},attr:" ",wrap:$(".sign_rights"),closeBtn:false};if(this.rights_tips[b]===null){var e=new UiBubbleTipBase(c);e.showBubble();this.rights_tips[b]=e}else{this.rights_tips[b].showBubble()}$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:"ucenter",st_type:"sign_rights_display_"+b})},check_rights_status:function(a){$(".j_sign_rights_icon:eq(0)").addClass("rights_get");$.stats.hive("sign_rights_exp1");if(a>=2){$(".j_sign_rights_icon:eq(1)").addClass("rights_get");$.stats.hive("sign_rights_exp2")}if(a>=10){$(".j_sign_rights_icon:eq(2)").addClass("rights_get");$.stats.hive("sign_rights_exp3")}if(a>=20){$(".j_sign_rights_icon:eq(3)").addClass("rights_get");$.stats.hive("sign_rights_exp4")}if(a>=30){$(".j_sign_rights_icon:eq(4)").addClass("rights_get");$.stats.hive("sign_rights_exp5")}},mobile_sign_tip:function(){var a=(new Date()-new Date("2012/11/20"))/86400000;if(a>=30||a<=0){return}if($.cookie("close_mobile_tip")=="true"){return}$("#j_sign_tip_holder").css("position","relative").css("z-index","1");var c={content:"<div class='sign_mob_tip clearfix'><div class='sign_mob_tip_icon'></div><div class='sign_mob_tip_text'>\u624b\u673a\u7b7e\u5230\u7ecf\u9a8c\u66f4\u591a\uff0c<br/>\u4f55\u4e0d\u8bd5\u8bd5\u624b\u673a\u8d34\u5427\u5ba2\u6237\u7aef\u3002<br/><a href='http://c.tieba.baidu.com/c/s/download/pc?src=webtbnotsign' target='_blank'>\u9a6c\u4e0a\u53bb\u4e0b\u8f7d>></a></div></div>",arrow_dir:"up",bubble_css:{top:0,right:15,width:230,"z-index":9999},arrow_pos:{left:140},attr:" ",wrap:$("#j_sign_tip_holder"),closeBtn:true};var b=new UiBubbleTipBase(c);b.showBubble();b.bind("onclose",function(){$.cookie("close_mobile_tip",true,{expires:3,path:"/"})},true)}}}});;_.Module.define({path:"common/component/LoginForm",sub:{_formKey:"",_formType:0,_jq_wrapper:null,_loginInstance:null,_pageLoginIndex:0,_userInputTip:{_jq_input:null,_jq_tip:null,_jq_newtip:null,type:"normal",init:function(b){var a=this;this._jq_input=b;this._jq_tip=$('<span class="user_input_tip" title="\u90ae\u7bb1\u5730\u5740/\u7528\u6237\u540d" style="">\u90ae\u7bb1\u5730\u5740/\u7528\u6237\u540d</span>');this._jq_newtip=$('<div class="ui_bubble_wrap j_wrap" style="display: none;width: 150px; top: 0px; left: 40px;"><div class="j_content ui_bubble_content ui_bubble_down"><div class="ui_bubble_body j_body">\u90ae\u7bb1\u4e5f\u53ef\u4ee5\u767b\u5f55\u54e6</div></div><div class="j_ui_triangle ui_triangle ui_triangle_down" style="left: 30px;"><div class="ui_triangle_outter ui_arrow_o_down"><em>\u25c6</em></div><div class="ui_triangle_inner ui_arrow_i_down"><em>\u25c6</em></div></div></div>');b.after(this._jq_newtip).after(this._jq_tip).focus(function(){a.hide()});this._jq_tip.click(function(){b.focus()});b.focus(function(){if(a.type=="normal"){a._jq_newtip.show()}}).blur(function(){a._jq_newtip.hide()})},show:function(){if($.trim(this._jq_input.val())==""){this._jq_tip.show();this._hideByCondition()}},hide:function(){this._jq_tip.hide()},_hideByCondition:function(){var a=this,c=1500;var b=setInterval(function(){if($.trim(a._jq_input.val())!=""){a.hide();clearInterval(b);return}if(c==0){clearInterval(b);return}c-=20},20)}},initial:function(c,e,b){this._formKey=e;this._formType=b?b:this._formType;this._jq_wrapper=c;this._loginManager=this._initLoginManager();var a=this;var d=(typeof Env!="undefined"&&Env.server_time)?Env.server_time:new Date().getTime();$.JsLoadManager.use("http://passport.bdimg.com/passApi/js/wrapper.js?cdnversion="+Math.floor(d/60000),function(){a._initLoginApi()})},_initLoginApi:function(){var a=this;passport.use("login",{tangram:true},function(b){a._loginInstance=new b.passport.login({product:"tb",loginType:1,u:window.location.href,isPhone:false,safeFlag:0,memberPass:true,staticPage:"http://tieba.baidu.com/tb/static-common/html/pass/v3Jump.html"});a._pageLoginIndex=a._loginManager.addLoginForm(a._loginInstance);var c=a._jq_wrapper.find(".login_form")[0];a._loginInstance.render(c);c=null;var d=$(a._loginInstance.getElement("userName"));a._userInputTip.init(d);a._userInputTip.show();a._loginInstance.on("loginError",function(e){var f=e.rsp.errInfo;if(f.no==110024){f.msg="";a._loginManager.errIndex=a._pageLoginIndex;if(a._formType==0){a._showPopErrorTip()}else{if(a._formType==1){a._showTextErrorTip(f.msg)}}}});a._loginInstance.on("loginSuccess",function(e){Stats.sendRequest("fr=tb0_forum&st_mod="+a._formKey+"&st_type=login_succeed");window.location.reload();e.returnValue=false});a._loginInstance.on("beforeSubmit",function(e){Stats.sendRequest("fr=tb0_forum&st_mod="+a._formKey+"&st_type=login_click")});a._initTab();a._jq_wrapper.removeClass("login_wrapper_beforeshow")})},_clearInputTips:function(a,e){var b=this,d=1500;var c=setInterval(function(){if($.trim(a.val())!=""){e.hide();clearInterval(c);return}if(d==0){clearInterval(c);return}d-=20},20)},_initLoginManager:function(){window.LoginManager=window.LoginManager||{loginForms:[],errIndex:0,validateEmail:function(b){var a=$(this.loginForms[this.errIndex].getElement("error"));if(b.errno==0){a.html('<img class="email_validate_ok" src="'+PageData.staticDomain+'tb/static-pb/img/right.png" alt="\u56fe\u7247"/>\u91cd\u53d1\u9a8c\u8bc1\u4fe1\u6210\u529f');a.css("color","#000000");setTimeout(function(){a.html("")},5000)}else{a.html("\u91cd\u53d1\u9a8c\u8bc1\u4fe1\u5931\u8d25");a.css("color","#FF0000")}},addLoginForm:function(a){this.loginForms.push(a);return this.loginForms.length-1}};return window.LoginManager},_initTab:function(){var a=this;var b=["normal","phone"];a._jq_wrapper.find(".login_tab_main>li").each(function(c){$(this).click(function(d){d.preventDefault();if(a._loginInstance){a._jq_wrapper.find(".login_tab_main>li>a").removeClass("focus");$(this).children("a").addClass("focus");a._loginInstance.switchTo(b[c]);if(b[c]=="phone"){a._userInputTip.hide();a._userInputTip.type="phone"}if(b[c]=="normal"){a._userInputTip.show();a._userInputTip.type="normal"}}})})},_showPopErrorTip:function(){var c=this;var a=new Array();a.push('<p class="active_email">\u8d26\u6237\u5c1a\u672a\u6fc0\u6d3b</p>');a.push("<p>\u8bf7\u5230\u6ce8\u518c\u9a8c\u8bc1\u90ae\u7bb1\u4e2d\u6fc0\u6d3b\uff0c\u6216</p>");a.push('<p>\u8005<a class="validate_email_link" href="#" target="_blank">\u91cd\u53d1\u9a8c\u8bc1\u90ae\u4ef6</a></p>');var b={content:"<div style='width:170px'>"+a.join("")+"</div>",arrow_dir:"down",bubble_css:{top:65,left:15,width:186},arrow_pos:{left:40},wrap:c._jq_wrapper.find(".j_login_tip_wrapper"),closeBtn:true};var d=new UiBubbleTipBase(b);d.showBubble();$(c).bind("validateEmailSent",function(){if(d!=null){d.closeBubble()}d=null});c._sendValidateEmail()},_showTextErrorTip:function(c){var b=this;var a=new Array();a.push("\u8d26\u6237\u5c1a\u672a\u6fc0\u6d3b\uff0c\u8bf7\u5230\u6ce8\u518c\u9a8c\u8bc1\u90ae\u7bb1\u4e2d\u6fc0\u6d3b\uff0c\u6216\u8005");a.push('<a class="validate_email_link" href="#" target="_blank">\u91cd\u53d1\u9a8c\u8bc1\u90ae\u4ef6</a>');c=a.join("");b._sendValidateEmail()},_sendValidateEmail:function(){var b=this;var a=b._jq_wrapper.find("a.validate_email_link");a.bind("click",function(){var c="https://passport.baidu.com/v2/?regmailsend&callback=LoginManager.validateEmail&tpl=tb&user="+$(b._loginInstance.getElement("userName")).val()+"&t="+Math.floor((new Date().getTime())/60000);$.JsLoadManager.use(c,function(){$(b).trigger("validateEmailSent")});return false})}}});var Tinytip={closeTip:function(d,b){var c=document.getElementById(d);var a=document.getElementById(b);if(c&&a){c.removeChild(a)}},doClose:function(a,e,d,b,c){Tinytip.closeTip(e,d);if(b){c()}if(a){if(a.stopPropagation){a.stopPropagation()}else{a.cancelBubble=true}}},render:function(j,i,l,a,m,g,b,e,n){a=a?a:false;m=m?m:false;g=g?g:1;b=b?b:false;n=n?n:false;var h=document.getElementById(j);var c="tinytip_"+new Date().getTime().toString()+parseInt(Math.random()*10,10).toString();var k=null;if(h){k=document.createElement("div");k.id=c;k.className="tinytip_root";h.appendChild(k);if(n){k.innerHTML=Tinytip._render_left(j,c,l,b,e,i);var f;var d;if($(h).css("position")=="relative"){f=0;d=0}else{f=$(h).offset().left;d=$(h).offset().top}k.style.left=f-15+"px";k.style.top=d+h.offsetHeight+"px"}else{k.innerHTML=Tinytip._render_right(j,c,l,b,e,i);var f;var d;if($(h).css("position")=="relative"){f=0;d=0}else{f=$(h).offset().left;d=$(h).offset().top}k.style.left=h.offsetWidth+f-k.offsetWidth+"px";if(n){k.style.top=d+h.offsetHeight+"px"}else{k.style.top=d+h.offsetHeight+6+"px"}}if(a){h.onmouseout=function(o){Tinytip.doClose(o,j,c,b,e)}}if(m){setTimeout(function(){Tinytip.doClose(null,j,c,b,e)},parseInt(g,10)*1000)}}},_render_left:function(g,e,a,f,b,d){var c=new Array();c.push("<table cellspacing='0' cellpadding='0' class=''>");c.push("<tr>");c.push("<td class='tip_i'></td>");c.push("<td class='tip_ii'></td>");c.push("<td class='tip_ii'><div class='tip_trg2'></div></td>");c.push("<td class='tip_ii'></td>");c.push("<td class='tip_iii'></td>");c.push("</tr>");c.push("<tr>");c.push("<td class='tip_iv'>&nbsp;</td>");c.push("<td class='tip_v_0'>&nbsp;</td>");c.push("<td class='tip_v_1' valign='middle'>");c.push(d);c.push("</td>");c.push("<td class='tip_v_2' align='right' valign='top'>");if(a){c.push("<img src='"+PageData.staticDomain+"tb/img/tinytip/tip_close.png' onclick='Tinytip.doClose(event,\""+g+'","'+e+'",'+f+","+b+");' />")}else{c.push("<div style='width:10px;'>&nbsp;</div>")}c.push("</td>");c.push("<td class='tip_vi'>&nbsp;</td>");c.push("</tr>");c.push("<tr>");c.push("<td class='tip_vii'></td>");c.push("<td class='tip_viii' colspan='3'></td>");c.push("<td class='tip_ix'></td>");c.push("</tr>");c.push("</table>");return c.join("")},_render_right:function(g,e,a,f,b,d){var c=new Array();c.push("<table cellspacing='0' cellpadding='0' class=''>");c.push("<tr>");c.push("<td class='tip_i'></td>");c.push("<td class='tip_ii'></td>");c.push("<td class='tip_trg'></td>");c.push("<td class='tip_iii'></td>");c.push("</tr>");c.push("<tr>");c.push("<td class='tip_iv'>&nbsp;</td>");c.push("<td class='tip_v_1' valign='middle'>");c.push(d);c.push("</td>");c.push("<td class='tip_v_2' align='right' valign='top'>");if(a){c.push("<img src='"+PageData.staticDomain+"tb/img/tinytip/tip_close.png' onclick='Tinytip.doClose(event,\""+g+'","'+e+'",'+f+","+b+");' />")}else{c.push("<div style='width:10px;'>&nbsp;</div>")}c.push("</td>");c.push("<td class='tip_vi'>&nbsp;</td>");c.push("</tr>");c.push("<tr>");c.push("<td class='tip_vii'></td>");c.push("<td class='tip_viii' colspan='2'></td>");c.push("<td class='tip_ix'></td>");c.push("</tr>");c.push("</table>");return c.join("")}};var Balv={config:{url:{dolike:"/f/like/commit/add",undolike:"/f/like/commit/delete",closetip:"/f/like/commit/notice/delete"}},__body:function(){var a=0,i=0,g=0,c=0,b=0,j=0;var h=window,e=document,f=e.documentElement;a=f.clientWidth||e.body.clientWidth;i=h.innerHeight||f.clientHeight||e.body.clientHeight;c=e.body.scrollTop||f.scrollTop;g=e.body.scrollLeft||f.scrollLeft;b=Math.max(e.body.scrollWidth,f.scrollWidth||0);j=Math.max(e.body.scrollHeight,f.scrollHeight||0,i);return{scrollTop:c,scrollLeft:g,documentWidth:b,documentHeight:j,viewWidth:a,viewHeight:i}},showFloatTip:function(c){var a=document.getElementById("userlike_tip");var b=null;if(c=="join"){return}else{if(c=="lvup"){b=document.getElementById("userlike_tip_lvup")}}if(a){var d=Balv.__body();a.style.width=d.documentWidth+"px";a.style.height=d.documentHeight+"px";a.style.display="block";if(b){b.style.display="block";b.style.left=Math.max(parseInt((d.viewWidth-b.offsetWidth)/2,10),0)+d.scrollLeft+"px";b.style.top=Math.max(parseInt((d.viewHeight-b.offsetHeight)/2,10),0)+d.scrollTop+"px"}}if(c=="lvup"){setTimeout(function(){Balv.closeFloatTip("lvup")},5000)}},closeFloatTip:function(c){var a=document.getElementById("userlike_tip");var b=null;if(c=="join"){b=document.getElementById("userlike_tip_join")}else{if(c=="lvup"){b=document.getElementById("userlike_tip_lvup")}}if(a){a.style.display="none"}if(b){b.style.display="none"}if(c=="lvup"){Balv._close_tip("lvup")}},showAlert:function(b){var a='<div style="padding:20px 20px; text-align:cente; line-height:20px;font-size:13px;">'+b+"</div>";$.dialog.open(a,{title:"\u64cd\u4f5c\u5931\u8d25",width:380})},howtojoin:function(){$.dialog.alert("<div style='padding:20px;line-height:30px;padding-bottom:0px;'>\u70b9\u51fb\u53f3\u4fa7\u4e0a\u65b9\u201c<img align='absmiddle' src='"+PageData.staticDomain+"tb/static-member/img/whatlevel.png'></img>\u201d<br/>\u5373\u53ef\u52a0\u5165\u672c\u5427\uff0c\u70b9\u4eae\u5934\u8854\uff0c\u4ece\u521d\u7ea7\u7c89\u4e1d\u5f00\u59cb\u6210\u957f\uff01</div>",{title:"\u5982\u4f55\u52a0\u5165",width:325})},dolike:function(){if(PageData.user.is_login&&PageData.user.no_un){TbCom.process("User","buildUnameFrame","\u586b\u5199\u7528\u6237\u540d","\u6709\u7528\u6237\u540d\u624d\u80fd\u70b9\u4eae\u201c\u6211\u5173\u6ce8\u201d\uff0c\u8d76\u5feb\u7ed9\u81ea\u5df1\u8d77\u4e00\u4e2a\u5427~");return false}var a={fid:PageData.forum.id,fname:PageData.forum.name,uid:PageData.user.name_url,ie:"gbk",tbs:PageData.tbs};$.post(Balv.config.url.dolike,a,function(f){var b=false;try{var c=f}catch(d){b=true}if(b){return}if(c&&c.no==0){Stats.sendRequest("fr=tb0_foruStatm&st_mod=frs&st_type=balvlikesucc&bduid="+PageData.user.bduid);_.Module.use("ucenter/component/LikeTip",["",false,{index:c.data.ret.index,like_no:c.like_no}]);$.stats.sendRequest("fr=tb0_forum&st_page=frs&st_mod=like&st_type=auto")}else{Stats.sendRequest("fr=tb0_foruStatm&st_mod=frs&st_type=balvlikefail&errorno="+c.no);var e="";if(c.no==8||c.no==9){e="\u4f60\u5728\u672c\u5427\u88ab\u5c01\u7981\uff0c\u6682\u65f6\u4e0d\u80fd\u8fdb\u884c\u64cd\u4f5c"}else{if(c.no==220){e="\u4f60\u88ab\u5427\u4e3b\u52a0\u5165\u9ed1\u540d\u5355\uff0c\u6682\u65f6\u4e0d\u80fd\u8fdb\u884c\u64cd\u4f5c"}else{if(c.no==221){e="\u4f60\u5df2like\u4e86\u672c\u5427,\u8bf7\u4e0d\u8981\u91cd\u590d\u64cd\u4f5c"}else{e="\u62b1\u6b49\uff0c\u5f02\u5e38\u9519\u8bef\uff0c\u5efa\u8bae\u5237\u65b0\u9875\u9762\u91cd\u8bd5\u4e00\u4e0b"}}}Balv.showAlert(e)}},"json")},undolike:function(){var a={fid:PageData.forum.id,fname:PageData.forum.name_url,uid:PageData.user.name_url,ie:"utf-8",tbs:PageData.tbs};$.tb.post(Balv.config.url.undolike,a,function(e){var b=false;try{var c=e}catch(d){b=true}if(b){return}if(c&&c.no==0){$.tb.location.reload(true)}else{}})},showexpbar:function(){var d=document.getElementById("userlike_expbar");var c=document.getElementById("userlike_expnum_cur");var e=document.getElementById("userlike_expnum_max");var f=0;var a=0;if(c&&e){f=parseInt(c.innerHTML,10);a=parseInt(e.innerHTML,10)}var b=parseInt(document.getElementById("userlike_expborder").offsetWidth,10);if(f==0){d.style.display="none"}else{d.style.display="block"}if(a!=0){d.style.width=parseInt(b*f/a,10)+"px"}},show_titleset_tip:function(){var a=(new Date()-new Date("2011/11/18"))/86400000;if(a>=14||a<=0){return}if($.cookie("close_titleset_tip")=="false"){return}$.cookie("close_titleset_tip",true,{expires:14});var b=new Array();b.push("<div style='width:220px;padding:3px 0'>");b.push("\u53ef\u5bf9\u4f1a\u5458\u8fdb\u884c\u7ba1\u7406\uff0c\u5305\u62ec\u5934\u8854\u540d\u8bbe\u7f6e\u3002");b.push("</div>");Tinytip.render("titleManageLink",b.join(""),true,false,false,1,true,function(){$.cookie("close_titleset_tip",false,{expires:14})})},show_tcbox_tip:function(){var a=(new Date()-new Date("2012/04/01"))/86400000;if(a>=1||a<=0){return}if($.cookie("close_tcbox_tip")=="false"){return}$.cookie("close_tcbox_tip",true,{expires:14});var b=new Array();b.push("<div style='width:145px;padding:4px;text-align:left;'>");b.push("\u611a\u4eba\u8282\uff0c\u5934\u50cf\u76f8\u6846\u5927\u53d8\u8eab\uff01\u8bb0\u5f97\u8981\u9884\u89c8\u5594~");b.push("</div>");Tinytip.render("my_entrance_tcbox",b.join(""),true,false,false,1,true,function(){Balv.clean_tcbox_session()},true)},clean_tcbox_session:function(){$.cookie("close_tcbox_tip",false,{expires:14})},show_firstlike_tip:function(){var a=new Array();a.push("<div style='width:200px;'>");a.push("<img style='vertical-align: middle; margin-bottom: 5px;width:16px;height:16px;' src='"+PageData.staticDomain+"/tb/img/icon_tip1.png?v=1.0' />");a.push("<a href='' onclick='BalvInfo.render();return false;' target='_blank'>\u5982\u4f55\u83b7\u5f97\u7ecf\u9a8c\uff0c\u63d0\u5347\u5934\u8854\uff1f</a>");a.push("</div>");Tinytip.render("userlike_info_tip",a.join(""),true,false,false,1,true,Balv.close_firstlike_tip)},close_firstlike_tip:function(){Balv._close_tip("first")},show_shortblock_tip:function(c,a){var b=new Array();b.push("<div style='width:205px;text-align:left;margin:6px 0px 6px 10px;'>");b.push("<div style='width:205px;'><span>\u4f60\u5df2\u88ab"+a+"\u5c01\u7981\uff0c\u8fd8\u5269</span><span style='color:#ff7f40;font-weight:bold;'>"+c+"</span><span>\u5929\u89e3\u5c01,<span></br><span>\u5c01\u7981\u671f\u95f4\u4e0d\u52a0\u7ecf\u9a8c\uff0c\u5934\u8854\u548c\u6743\u9650\u6536\u56de\u3002</span></div><div style='text-align:right;margin-right:5px;'><a href='http://tieba.baidu.com/pmc/main?fid="+PageData.forum.id+"' target='_blank'>\u67e5\u770b\u8be6\u7ec6\u4fe1\u606f</a></div>");b.push("</div>");Tinytip.render("userliked_ban_content",b.join(""),false,false,true,2,false)},show_block_tip:function(){var a=new Array();a.push("<div style='width:205px;text-align:left;margin:6px 0px 6px 10px;'>");a.push("<div><span>\u4f60\u5df2\u88ab\u7cfb\u7edf\u6c38\u4e45\u5c01\u7981\uff0c<br/>\u5c01\u7981\u671f\u95f4\u4e0d\u52a0\u7ecf\u9a8c\uff0c\u5934\u8854\u548c\u6743\u9650\u6536\u56de\u3002</span></div><div style='text-align:right;margin-right:5px;'><a href='http://tieba.baidu.com/pmc/main' target='_blank'>\u67e5\u770b\u8be6\u7ec6\u4fe1\u606f</a></div>");a.push("</div>");Tinytip.render("userliked_ban_content",a.join(""),false,false,true,2,false)},show_black_tip:function(){var a=new Array();a.push("<div style='width:180px;text-align:left;margin:6px 0px 6px 10px;'>");a.push("<span>\u4f60\u5df2\u88ab\u5427\u4e3b\u62c9\u5165\u9ed1\u540d\u5355\uff0c</span></br><span>\u4f60\u5728\u672c\u5427\u7684\u5934\u8854\u548c\u6743\u9650\u4e5f\u88ab\u6536\u56de\u3002</span>");a.push("</div>");Tinytip.render("userliked_ban_content",a.join(""),false,true,true,2,false)},show_award_tip:function(d,e,a,c){var b=new Array();b.push("<div style='width:210px;'>");b.push("<div style='float:left;text-align:left;padding-left:12px;padding-top:9px;line-height:18px;'><span style='color:#555555;'>"+d+"</span></br>");b.push("<div style='float:left;text-align:left;line-height:18px;padding-bottom:6px;'><a href='"+a+"' style='display:inline;'>"+c+"</a></br>");b.push("</div></div>");Tinytip.render("userlike_info_tip",b.join(""),true,false,true,8,true,Balv.close_award_tip);Stats.sendRequest("fr=tb0_foruStatm&st_mod=frs&st_type=balvlvup")},close_award_tip:function(){Balv._close_tip("award")},show_trans_tip:function(b){var a=new Array();a.push("<div style='width:170px;padding: 8px 0px 8px 8px;text-align:left;'>");a.push("<div style='width:170px;line-height:18px;color:#555555;'><span>"+b+"</span></div>");a.push("<div style='width:170px;line-height:22px;'><img style='vertical-align: middle;margin-bottom: 5px;width:16px;height:16px;' src='"+PageData.staticDomain+"/tb/img/icon_tip1.png?v=1.0' /><a href='' onclick='BalvInfo.render();return false;' target='_blank'>\u5982\u4f55\u83b7\u5f97\u7ecf\u9a8c\uff0c\u63d0\u5347\u5934\u8854\uff1f</a></div>");a.push("</div>");Tinytip.render("userlike_info_tip",a.join(""),true,false,false,1,true,Balv.close_trans_tip)},show_expire_tip:function(e){$("#my_entrance_tcbox").css("position","relative").css("z-index","10");var b=new Array();b.push("<div style='width:240px;padding: 8px 0px 8px 8px;text-align:left;'>");b.push("<div style='width:240px;line-height:18px;color:#555555;'><span>"+e+"</span></div>");b.push("<div style='width:240px;line-height:22px;'><a href='/imall/mall?kw="+PageData.forum.name_url+"#!/tc/my/' style='padding-left:0px;' target='_blank'>\u7acb\u5373\u7eed\u8d39</a></div>");b.push("</div>");var c=b.join("");var d={content:c,arrow_dir:"up",bubble_css:{top:15,right:-5,width:252,"z-index":9999},arrow_pos:{left:209},attr:"lvup_tip_table",wrap:$("#my_entrance_tcbox"),closeBtn:true};var a=new UiBubbleTipBase(d);a.j_bubble.find(".j_content").css("padding","2px");a.showBubble();setTimeout(function(){a.closeBubble();$("#my_entrance_tcbox").css("position","static")},1000)},show_furank_tip:function(){if($.cookie("close_furank_tip")=="1"){return}$.cookie("close_furank_tip","0",{expires:14});var a=new Array();if(PageData.user.balv.has_liked){a.push("<div style='width:160px;padding:4px 0px 0px 0px;text-align:left;'>")}else{a.push("<div style='width:160px;padding:4px 0px 0px 8px;text-align:left;'>")}a.push("\u5427\u5185\u5f71\u54cd\u529b\u6392\u884c\u699c\u706b\u70ed\u5f00\u699c\uff01<br/>\u770b\u770b\u4f60\u5728\u5427\u91cc\u4ec0\u4e48\u6c34\u5e73~");a.push("</div>");Tinytip.render("entrance_rank",a.join(""),true,false,false,1,true,Balv.close_furank_tip,PageData.user.balv.has_liked)},close_furank_tip:function(){$.cookie("close_furank_tip","1",{expires:14})},close_trans_tip:function(){Balv._close_tip("trans")},show_lvup_tip:function(h,g){var b=new Array();b.push("<div class='lvup_tip_container'>");b.push("<div class='lvlup_con_msg'>\u5347\u7ea7\u5566!\u4f60\u5df2\u62e5\u6709\u672c\u5427"+h+"\u7ea7\u5934\u8854!</div>");b.push('<div class="lvlup_pop_rights">'+g+"</div>");if(g=="\u52a0\u6cb9~\u7ee7\u7eed\u6512\u7ecf\u9a8c\uff01"){b.push("<a style='float:left;' href='/f/like/level?kw="+PageData.forum.name_url+"' target='_blank'>\u67e5\u770b\u5347\u7ea7\u79d8\u7b08</a>")}else{var e='Stats.sendRequest("fr=tb0_forum&st_mod=frs&st_type=balvupguide&lv='+h+'")';b.push("<a href='#sub' style='float:left;' onclick='rich_postor.jumpToTry("+h+");"+e+"'>\u73b0\u5728\u53bb\u8bd5\u8bd5~~</a>")}var d='Stats.sendRequest("fr=tb0_forum&st_mod=frs&st_type=lvup_imallentrance")';b.push("<a target='_blank' onclick='"+d+"' style='float:left;margin-left:15px' href='/imall/mall?kw="+PageData.forum.name_url+"'>\u53bb\u767e\u5b9d\u7bb1\u770b\u770b</a>");b.push("</div>");var c=b.join("");var f={content:c,arrow_dir:"up",bubble_css:{top:4,right:-5,width:232,"z-index":9999},arrow_pos:{left:209},attr:"lvup_tip_table",wrap:$("#userlike_info_tip"),closeBtn:true};var a=new UiBubbleTipBase(f);a.j_bubble.find(".j_content").css("padding","2px").addClass("lvup_tip_table");a.showBubble();a.bind("onclose",function(){Balv.close_lvup_tip()},true);if(!PageData.user.is_block){setTimeout(function(){a.closeBubble();Balv.close_lvup_tip()},8000)}},show_liked_forum_tip:function(){},close_lvup_tip:function(){var a={fid:PageData.forum.id,fname:PageData.forum.name_url,uid:PageData.user.name_url,ie:"utf-8",tbs:PageData.tbs,type:2};$.tb.post(Balv.config.url.closetip,a,function(e){var b=false;try{var c=e}catch(d){b=true}if(b){return}if(c&&c.no==0){}else{}})},show_orange_tip:function(){if($.cookie("close_sign_tip_o")=="false"){return}$.cookie("close_sign_tip_o",true,{expires:14});$(".userlike_info").css("position","relative");var b={content:"\u8fde\u7eed\u7b7e\u523030\u5929ID\u5373\u53ef\u9ad8\u4eae\u5c55\u793a\uff0c\u4e00\u8d77\u95ea\u8000\u5427\uff01",arrow_dir:"down",bubble_css:{top:10,right:65,width:145,"z-index":9999},arrow_pos:{left:88},attr:" ",wrap:$(".userlike_info"),closeBtn:true};var a=new UiBubbleTipBase(b);a.j_bubble.find(".j_body").css("padding-right","3px");a.showBubble();a.bind("onclose",function(){$.cookie("close_sign_tip_o",false,{expires:14})},true);setTimeout(function(){$(".j_wrap .j_close").click()},8000)},_close_tip:function(a){var c={first:1,award:4,lvup:2,trans:3};var b={fid:PageData.forum.id,fname:PageData.forum.name_url,uid:PageData.user.name_url,ie:"utf-8",tbs:PageData.tbs,type:c[a]};$.tb.post(Balv.config.url.closetip,b,function(g){var d=false;try{var e=g}catch(f){d=true}if(d){return}if(e&&e.no==0){}else{}})},render_balv_tip_configs:function(a){return{content:a,arrow_dir:"up",bubble_css:{top:98,left:4,width:170,"z-index":100},arrow_pos:{left:88},attr:" ",wrap:$("#userlike_info"),closeBtn:true}},show_pic_tip:function(){if(!PageData.is_login){return}var a=(new Date()-new Date("2012/10/16"))/86400000;if(a>=21||a<=0){return}if($.cookie("pic_guide")=="1"){return}var c=PageData.forum.name_url||"test";var d={content:'<a href="/f/like/level?kw='+c+'&lv_t=lv_nav_who" onclick="$.stats.sendRequest(\'fr=tb0_forum&st_type=pic_guide&st_value=intip\')" target="_blank">\u53d1\u56fe\u7247\u8d34\u53ef\u83b7\u989d\u5916\u7ecf\u9a8c\u54e6\uff01</a>',arrow_dir:"up",bubble_css:{top:98,left:4,width:170,"z-index":100},arrow_pos:{left:88},attr:" ",wrap:$("#userlike_info"),closeBtn:true};var b=new UiBubbleTipBase(d);b.showBubble();b.bind("onclose",function(){$.cookie("pic_guide","1",{expires:14,path:"/"});$.stats.sendRequest("fr=tb0_forum&st_type=pic_guide&st_value=closetip")},true)}};var BalvInfo={render:function(a,b){window.open("/f/like/level?kw="+PageData.forum.name_url)}};;function UserTitle(){this.init()}UserTitle.prototype={constructor:UserTitle,init:function(){if(PageData.is_login){this.bindEvents()}},bindEvents:function(){$(".userlike_blacked").bind("mouseover",function(){Balv.show_black_tip()});$(".userlike_info_badge div:first").bind("click",function(a){window.open("/f/like/level?kw="+PageData.forum.name_url+"&lv_t=lv_nav_intro");return false});$(".userlike_info_expbar").bind("click",function(a){Stats.sendRequest("fr=tb0_forum&st_mod=frs&st_type=balvexpbar");window.open("/f/like/level?kw="+PageData.forum.name_url+"&lv_t=lv_nav_who");return false});$(".unlike_texture_badge").bind("click",function(a){window.open("/f/like/level?kw="+PageData.forum.name_url+"&lv_t=lv_nav_intro")});$(".j_meizhi_auth_link").bind("click",function(){_.Module.use("postor/widget/MeizhiPostor",[],function(){})});if(PageData.user.balv.has_liked){if($("ul.tl").css("display")=="none"){if(PageData.is_ipad){$("div.userlike_info_manager").show()}else{$(".balv_mod").hover(function(){$("div.userlike_info_manager").show()},function(){$("div.userlike_info_manager").hide()})}}else{if(PageData.is_ipad){$("a.p_balv_btnmanager").show()}else{$(".balv_mod").hover(function(){$("a.p_balv_btnmanager").show()},function(){$("a.p_balv_btnmanager").hide()})}}}},addBubble:function(){var c=$.cookie("meizhiBubble")=="1";var b=PageData.forum.theme=="bright"?28:16;if(!c){var a=new UiBubbleTipBase({content:"\u59b9\u7eb8\u8ba4\u8bc1\u706b\u70ed\u5f00\u653e\uff01",arrow_dir:"down",bubble_css:{top:b,left:-80,width:120,"z-index":200},arrow_pos:{left:100},wrap:$(".meizhi_auth_link_wrap"),closeBtn:true});a.bind("onclose",function(){$.cookie("meizhiBubble","1",{expires:365,path:"/"});a.hideBubble()});a.showBubble()}}};;_.Module.define({path:"ucenter/widget/tbSpam",requires:[],sub:{initial:function(){$("body").append($("#tb_spam_notice_html").html())}}});_.Module.define({path:"fanclub/widget/fan_aside",sub:{_forum_id:"",_is_login:"",initial:function(a){a=a||{};this._is_login=a.user||0;this._forum_id=a.forum_id||0;this._BindEvent()},_BindEvent:function(){var a=this;this._scroll();$(".j_join_btn").click(function(){if(a._is_login==0){TbCom.process("User","buildLoginFrame")}else{$.stats.sendRequest("fr=tb0_forum&st_type=fanclub&st_value=right_join_btn");$.tb.location.setHref("/frsstar/browse/fanclub?page=fanjoin&forum_id="+a._forum_id+"#pay")}});$(".fancharge_btn").click(function(){$.stats.sendRequest("fr=tb0_forum&st_type=fanclub&st_value=charge_btn")})},_scroll:function(){var d=$(".fan_join_list");var b=d.find("li");var g=b.clone();var a=parseInt(b.first().css("height"))+5;var e=parseInt(d.css("height"))+a;d.append(g);var f=0;var c=setInterval(function(){if(f+e<=0){var h=b;b=g;g=h;g.remove();d.append(g);f=0;d.css({top:f})}d.animate({top:f});f=f-a},3000)}}});_.Module.define({path:"frs/widget/PlatformAsideSwitch",sub:{_positions:null,_tpl:["<div>","</div>"].join(""),initial:function(a){this._positions=a;$("#aside").on("click",".j_aside_switch_op",$.proxy(this.showDialog,this))},showDialog:function(f){var c=this;f&&f.preventDefault();var d=baidu.template("platform_aside_switch_tpl",{list:c._positions}),a=$(d);var b=new $.dialog({html:a,title:"\u6a21\u5757\u987a\u5e8f\u8c03\u6574",draggable:true,width:418});a.on("click",".j_paside_switch_down",c.turnDown).on("click",".j_paside_switch_up",c.turnUp).on("click",".j_paside_switch_submit",c.submit)},turnDown:function(){var c=$(this).closest("tr"),a=c.find(".j_paside_switch_mod"),b=a.html(),d=c.next().find(".j_paside_switch_mod");a.html(d.html());d.html(b)},turnUp:function(){var c=$(this).closest("tr"),a=c.find(".j_paside_switch_mod"),b=a.html(),d=c.prev().find(".j_paside_switch_mod");a.html(d.html());d.html(b)},submit:function(b){b&&b.preventDefault();var a=$(this).closest("tbody").find(".j_paside_switch_mod"),f={forum_id:PageData.forum.id,tbs:PageData.tbs},c=[];a.each(function(){c.push($(this).find("span").tbattr("mod_id"))});f.msort=c.join(",");$.tb.post("/gcf/msort?ie=utf-8",f,function(d){if(d.no==0){$.dialog.close();$.tb.location.reload()}else{$tip.html("\u8c03\u6574\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")}},"json")}}});/*!
 * This file is used for define the Observiable library.
 * @author <a href="mailto:mingyi.lzjtu@gmail.com">Mingyi</a>
 * @version 0.0.1
 */
var baidu=typeof baidu!="undefined"?baidu:{};(function(b,a,d){var c=typeof define==="function",e=typeof module!=="undefined"&&module.exports;if(c){define(a)}else{if(e){module.exports=a()}else{d[b]=a()}}})("observe",function(){var d=[];var b=[];var a=function(l){var j=[];var k={generic:[],create:[],update:[],"delete":[]};function n(){h();j=l}function h(){e(k.generic,function(p){p(l,j)})}function g(q,p){e(k.create,function(r){r(q,p)})}function o(r,q,p){e(k.update,function(s){s(r,old_item,p)})}function m(q,p){e(k["delete"],function(r){r(q,p)})}function i(){var q=j.length;var t=l.length;if(q!==t||$.json.encode(j)!==$.json.encode(l)){var p=Math.max(t,q);for(var r=p;r>=0;r--){var s=j[r];var u=l[r];if(r>q-1){g(u,r)}else{if(r>t-1){m(s,r)}else{if(u!==s){o(u,s,r)}}}}}n()}l.pop=function(){i();var q=Array.prototype.pop.call(this,arguments);var p=this.length;m(q,p);n();return q};l.push=function(){i();var q=arguments[0];var p=Array.prototype.push.apply(this,arguments);g(q,p-1);n();return p};l.splice=function(r,s){i();var t=Array.prototype.slice.call(arguments,2);var p=Array.prototype.splice.apply(this,arguments);for(var q=p.length-1;q>=0;q--){m(p[q],r+q)}e(t,function(v,u){g(v,r+u)});n();return p};return{bind:function(q,p){if(typeof k[q]=="undefined"){throw"type is not allow"}k[q].push(p)},unbind:function(q,p){}}};var f=function(g,h){return Object.prototype.toString.call(g)==="[object "+h+"]"};var e=function(k,l){var j,g=0,h=k.length;for(;g<h;g++){j=l.call(k[g],k[g],g);if(j===false){break}}};var c=function(h,g){var j=0;if(Array.prototype.indexOf){return h.indexOf(g)}for(;j<h.length;j++){if(h[j]===g){return j}}return -1};return function(h,i,j){if(arguments.length<2){throw"arguments length is not right"}if(!f(h,"Array")){throw"first argument must be an array"}if(f(i,"Function")){j=i;i="generic"}var g=c(d,h);if(g===-1){g=d.length;d.push(h);var k=new a(h);b.push(k)}b[g].bind(i,j);return h}},baidu);;_.Module.define({path:"comforum/widget/LecaiLotteryA/LotteryDialog",requires:["comforum/component/LotteryHelper"],sub:{_container:null,_lotteryData:{},_lotteryInfo:{},_singleCache:[],_betsCache:[],_gateCache:[],_danCache:[],_singleTpl:['<tr class="j_single_#{match_num}">','<td class="lottery_table_game"><div>#{race}</div></td>','<td class="lottery_table_time">#{race_start_time_short}</td>','<td class="lottery_table_team">#{home}</td>','<td class="lottery_table_team">#{away}</td>','<td class="lottery_table_sp lottery_icon_spbg sp_#{match_num}_3 j_sp" data-match="#{match_num}" data-rel="3" data-sp="#{scale_home}" data-type="single" data-log="sp_single_#{index}_3">#{scale_home}</td>','<td class="lottery_table_sp lottery_icon_spbg sp_#{match_num}_1 j_sp" data-match="#{match_num}"  data-rel="1" data-sp="#{scale_equal}" data-type="single" data-log="sp_single_#{index}_1">#{scale_equal}</td>','<td class="lottery_table_sp lottery_icon_spbg sp_#{match_num}_0 j_sp" data-match="#{match_num}" data-rel="0" data-sp="#{scale_away}" data-type="single" data-log="sp_single_#{index}_0">#{scale_away}</td>',"</tr>"].join(""),_betsTpl:['<tr class="j_bets_#{match_num}">','<td class="lottery_table_game"><div>#{race}</div></td>','<td class="lottery_table_time">#{race_start_time_short}</td>','<td class="lottery_table_team">#{home}</td>','<td class="lottery_table_team">#{away}</td>','<td class="lottery_table_sp lottery_icon_spbg sp_#{match_num}_3 j_sp" data-match="#{match_num}" data-rel="3" data-sp="#{scale_home}" data-type="bets" data-log="sp_bets_#{index}_3">#{scale_home}</td>','<td class="lottery_table_sp lottery_icon_spbg sp_#{match_num}_1 j_sp" data-rel="1" data-match="#{match_num}" data-sp="#{scale_equal}" data-type="bets" data-log="sp_bets_#{index}_1">#{scale_equal}</td>','<td class="lottery_table_sp lottery_icon_spbg sp_#{match_num}_0 j_sp" data-rel="0" data-match="#{match_num}" data-sp="#{scale_away}" data-type="bets" data-log="sp_bets_#{index}_0">#{scale_away}</td>',"</tr>"].join(""),_singleBubble:null,_betsBubble:null,_forumId:0,_page:null,initial:function(a){var b;this._lotteryData=a.lotteryData;this._formatLotteryInfo(a.lotteryData);this._render(a.defaultTab,b,a.selectedData||[]);this._forumId=a.forumId;this._page=a.page;this._stats(a.PageData)},_formatLotteryInfo:function(){var b=this,d=function(h){return h<10?"0"+h:h},e,g={0:"\u5468\u65e5",1:"\u5468\u4e00",2:"\u5468\u4e8c",3:"\u5468\u4e09",4:"\u5468\u56db",5:"\u5468\u4e94",6:"\u5468\u516d"};for(var f in b._lotteryData){b._lotteryInfo[f]={};for(var c=0,a=b._lotteryData[f].length;c<a;c++){b._lotteryInfo[f][b._lotteryData[f][c]["match_num"]]={3:b._lotteryData[f][c]["scale_home"],1:b._lotteryData[f][c]["scale_equal"],0:b._lotteryData[f][c]["scale_away"]};e=new Date(parseInt(b._lotteryData[f][c].race_start_time)*1000);b._lotteryData[f][c].race_start_time_short=g[e.getDay()]+" "+d(e.getHours())+":"+d(e.getMinutes())}}},_render:function(c,d,e){var a=this,f=['<div id="lottery_dialog" class="lottery_dialog">','<div class="lottery_dialog_head">',"<span>\u8db3\u5f69\u63a8\u8350</span>","<ul>",'<li><a class="lottery_tab_bets j_tab_bets" href="javascript:;" data-log="tab_ggtz">\u8fc7\u5173\u6295\u6ce8</a></li>','<li><a class="lottery_tab_single j_tab_single lottery_icon_dialog_tab" href="javascript:;" data-log="tab_dgtz">\u5355\u5173\u6295\u6ce8</a></li>',"</ul>",'<a class="lottery_icon_dialog_close j_dialog_close" href="javascript:;" title="\u5173\u95ed"></a>',"</div>",'<div class="lottery_dialog_body clearfix j_dialog_body">',"</div>",'<p class="lottery_dialog_footer_tip">\u8d34\u5427\u5f69\u7968\u7531\u4e50\u5f69\u7f51\u63d0\u4f9b\u6280\u672f\u652f\u6301\uff0c\u56fd\u5bb6\u6b63\u89c4\u53d1\u884c\uff0c\u8bf7\u653e\u5fc3\u8d2d\u4e70\u3002\u5f69\u7968\u6709\u98ce\u9669\uff0c\u6295\u6ce8\u9700\u8c28\u614e\uff0c\u4e0d\u5411\u672a\u6ee118\u5468\u5c81\u8005\u51fa\u552e\u5f69\u7968\uff01</p>',"</div>"].join(""),b=new $.dialog({html:f,holderClassName:"lottery_dialog_holder",showTitle:false,draggable:false,closeable:false,width:750,height:390});a._container=$("#lottery_dialog");a._bindDialogEvents(b);a._container.find(".j_tab_"+c).trigger("click");a._renderSelected(c,e)},_renderSigle:function(e,g){var b=this,c="",f="";for(var d=0,a=e.length;d<a;d++){e[d].index=d;c+=$.tb.format(b._singleTpl,e[d])}f=['<div class="lottery_single">','<div class="lottery_table_wrap">','<table class="lottery_table" border="0" cellspacing="0">',"<thead>","<tr>",'<th class="lottery_table_game">\u8d5b\u4e8b</th>',"<th>\u5f00\u8d5b\u65f6\u95f4</th>","<th>\u4e3b\u961f</th>","<th>\u5ba2\u961f</th>",'<th class="lottery_table_sp">\u4e3b\u961f\u80dc</th>','<th class="lottery_table_sp">\u5e73\u5c40</th>','<th class="lottery_table_sp">\u5ba2\u961f\u80dc</th>',"</tr>","</thead>",'<tbody class="j_single_tbody">',c,"</tbody>","</table>","</div>",'<div class="lottery_bottom_left">','<div class="lottery_gates_wrap"><span class="lottery_gates_title">\u8fc7\u5173\u65b9\u5f0f\uff1a</span>','<input type="radio" id="lottery_gate_0" checked /><label for="lottery_gate_0">\u5355\u5173</label>',"</div>",'<div class="lottery_bets_wrap"><span class="lottery_bets_title">\u8fc7\u5173\u500d\u6570\uff1a</span>','<input type="text" class="lottery_bets_ipt ui_textfield j_single_mutiple" data-type="single" value="1" maxlength="5" />\u500d','<div class="lottery_awards">\u7406\u8bba\u5956\u91d1<span class="lottery_awards_num j_single_award">0</span>\u5143</div>',"</div>","</div>",'<div class="lottery_bottom_right">','<div class="clearfix"><a class="lottery_icon_change j_refresh" data-type="single" href="javascript:;" data-log="refresh_single"><i class="lottery_icon_refresh"></i>\u6362\u4e00\u6362</a></div>','<div class="lottery_money clearfix">','<div class="lottery_bubble_pay j_bubble_single_pay"></div>','<a class="lottery_icon_bet disable j_single_pay" data-type="single" href="javascript:;" data-log="pay_single"></a>','<div class="fr">\u6295\u6ce8\u91d1\u989d\uff1a<span class="j_single_money">0</span>\u5143</div>',"</div>","</div>","</div>"].join("");b._container.find(".j_dialog_body").append(f);b._singleBubble=b._showBubble({wrap:$(".j_bubble_single_pay"),content:"\u81f3\u5c11\u9009\u62e9\u4e00\u573a\u6bd4\u8d5b\u8fdb\u884c\u6295\u6ce8",width:144});b._singleBubble.j_bubble.show()},_renderBets:function(d,g){var c=this,b="",f="";for(var e=0,a=d.length;e<a;e++){d[e].index=e;b+=$.tb.format(c._betsTpl,d[e])}f=['<div class="lottery_bets">','<div class="lottery_table_wrap">','<table class="lottery_table" border="0" cellspacing="0">',"<thead>","<tr>",'<th class="lottery_table_game">\u8d5b\u4e8b</th>',"<th>\u5f00\u8d5b\u65f6\u95f4</th>","<th>\u4e3b\u961f</th>","<th>\u5ba2\u961f</th>",'<th class="lottery_table_sp">\u4e3b\u961f\u80dc</th>','<th class="lottery_table_sp">\u5e73\u5c40</th>','<th class="lottery_table_sp">\u5ba2\u961f\u80dc</th>',"</tr>","</thead>",'<tbody class="j_bets_tbody">',b,"</tbody>","</table>","</div>",'<div class="lottery_bottom_left">','<div class="lottery_gates_wrap"><span class="lottery_gates_title">\u8fc7\u5173\u65b9\u5f0f\uff1a</span>','<div class="lottery_gate j_gate_wrap j_gate_2 hidden"><input type="checkbox" id="lottery_gate_2" class="j_gate" data-val="2" data-log="gate_2" /><label for="lottery_gate_2">2\u4e321</label></div>','<div class="lottery_gate j_gate_wrap j_gate_3 hidden"><input type="checkbox" id="lottery_gate_3" class="j_gate" data-val="3" data-log="gate_3" /><label for="lottery_gate_3">3\u4e321</label></div>','<div class="lottery_gate j_gate_wrap j_gate_4 hidden"><input type="checkbox" id="lottery_gate_4" class="j_gate" data-val="4" data-log="gate_4" /><label for="lottery_gate_4">4\u4e321</label></div>','<div class="lottery_gate j_gate_wrap j_gate_5 hidden"><input type="checkbox" id="lottery_gate_5" class="j_gate" data-val="5" data-log="gate_5" /><label for="lottery_gate_5">5\u4e321</label></div>','<span class="lottery_gate_tip">\u81f3\u5c11\u9009\u62e9\u4e24\u573a\u6bd4\u8d5b\u8fdb\u884c\u6295\u6ce8</span>',"</div>",'<div class="lottery_bets_wrap"><span class="lottery_bets_title">\u8fc7\u5173\u500d\u6570\uff1a</span>','<input type="text" class="lottery_bets_ipt ui_textfield j_bets_mutiple" data-type="mutiple" value="1" maxlength="5"/>\u500d','<div class="lottery_awards">\u7406\u8bba\u5956\u91d1<span class="lottery_awards_num j_bets_award">0</span>\u5143</div>',"</div>","</div>",'<div class="lottery_bottom_right">','<div class="clearfix"><a class="lottery_icon_change j_refresh" data-type="bets" href="javascript:;" data-log="refresh_bets"><i class="lottery_icon_refresh"></i>\u6362\u4e00\u6362</a></div>','<div class="lottery_money clearfix">','<div class="lottery_bubble_pay j_bubble_bets_pay"></div>','<a class="lottery_icon_bet disable j_bets_pay" data-type="bets" href="javascript:;" data-log="pay_bets"></a>','<div class="fr">\u6295\u6ce8\u91d1\u989d\uff1a<span class="j_bets_money">0</span>\u5143</div>',"</div>","</div>","</div>"].join("");c._container.find(".j_dialog_body").append(f);c._betsBubble=c._showBubble({wrap:$(".j_bubble_bets_pay"),content:"\u81f3\u5c11\u9009\u62e9\u4e24\u573a\u6bd4\u8d5b\u8fdb\u884c\u6295\u6ce8",width:144});c._betsBubble.j_bubble.show()},_renderSelected:function(b,c){var a=this;$.each(c,function(d,f){var e=f.split("_");a._container.find(".sp_"+e[0]+"_"+e[1]).trigger("click")});if(b=="bets"&&c.length>1){a._container.find("#lottery_gate_2").trigger("click").trigger("change")}},_renderDan:function(){var a=this,b=0;for(var c in a._betsCache){b++}if(b!=1&&a._danCache.length+1==b){return}a._container.find(".j_dan").addClass("disable");for(var c in a._betsCache){a._container.find(".j_dan_"+c).removeClass("disable")}if(b==1){a._container.find(".j_dan.selected").trigger("click");return}},_renderGate:function(){var a=this,f=a._danCache.length,b=0,e=f>0?f+1:2,c=[];for(var d in a._betsCache){b++}if(b>=2){a._container.find(".lottery_gate_tip").hide()}else{a._container.find(".lottery_gate_tip").show()}a._container.find(".j_gate_wrap").addClass("hidden").find("input").tbattr("checked",false);for(;e<=b;e++){if($.inArray(e,a._gateCache)!=-1){c.push(e);a._container.find(".j_gate_"+e).find(".j_gate").tbattr("checked",true)}a._container.find(".j_gate_"+e).removeClass("hidden")}a._gateCache=c},_bindDialogEvents:function(b){var a=this;a._container.find(".j_dialog_close").on("click",function(){b.close()});a._container.find(".j_tab_bets").on("click",function(){a._container.find(".j_tab_single").removeClass("lottery_icon_dialog_tab");$(this).addClass("lottery_icon_dialog_tab");if(!$(this).data("load")){var c=a._lotteryData.bets.slice(0,5);a._renderBets(c);$(this).data("load",true)}else{$(".lottery_bets").show()}$(".lottery_single").hide();if(a._lotteryData.bets.length<=5){a._container.find(".j_refresh").addClass("lottery_icon_change_disable")}else{a._container.find(".j_refresh").removeClass("lottery_icon_change_disable")}});a._container.find(".j_tab_single").on("click",function(){a._container.find(".lottery_icon_dialog_tab").removeClass("lottery_icon_dialog_tab");$(this).addClass("lottery_icon_dialog_tab");if(!$(this).data("load")){var c=a._lotteryData.single.slice(0,5);a._renderSigle(c);$(this).data("load",true)}else{$(".lottery_single").show()}$(".lottery_bets").hide();if(a._lotteryData.single.length<=5){a._container.find(".j_refresh").addClass("lottery_icon_change_disable")}else{a._container.find(".j_refresh").removeClass("lottery_icon_change_disable")}});a._container.find(".j_dialog_body").on("click",".j_sp",function(){var f=$(this).data("match"),c=$(this).data("sp"),h=$(this).data("type"),n=$(this).data("rel"),k=h=="single"?a._singleCache:a._betsCache,l=0;$(this).toggleClass("selected");if($(this).hasClass("selected")){if(k[f]){k[f].push(n)}else{k[f]=[n]}if(h=="single"){a._singleBubble&&a._singleBubble.j_bubble.hide()}k[f].sort(function(o,i){return i-o})}else{if(k[f]){var d=[];for(var e=0,g=k[f].length;e<g;e++){if(k[f][e]!=n){d.push(parseInt(k[f][e]))}}if(d.length==0){delete k[f];a._danCache=[];$(".j_dan").removeClass("selected")}else{k[f]=d}}}if(h=="bets"){a._renderDan();a._renderGate()}for(var m in k){l++}if(l==5){a._container.find(".j_refresh").addClass("lottery_icon_change_disable")}else{if(a._lotteryData[h].length>5){a._container.find(".j_refresh").removeClass("lottery_icon_change_disable")}}if(h=="single"&&l==0){a._singleBubble&&a._singleBubble.j_bubble.show()}if(h=="bets"&&l<2&&a._betsBubble){a._betsBubble.j_bubble.find(".lottery_bubble_content").html("\u81f3\u5c11\u9009\u62e9\u4e24\u573a\u6bd4\u8d5b\u8fdb\u884c\u6295\u6ce8");a._betsBubble.j_bubble.show()}else{if(h=="bets"&&a._gateCache.length>0&&a._betsBubble){a._betsBubble.j_bubble.hide()}else{if(h=="bets"&&a._gateCache.length==0&&a._betsBubble){a._betsBubble.j_bubble.find(".lottery_bubble_content").html("\u81f3\u5c11\u9009\u62e9\u4e00\u79cd\u8fc7\u5173\u65b9\u5f0f");a._betsBubble.j_bubble.show()}}}a._updateMoney(h)});a._container.find(".j_dialog_body").on("change",".j_gate",function(){var c=$(this).data("val"),d;if($(this).tbattr("checked")){a._gateCache.push(c);a._betsBubble&&a._betsBubble.j_bubble.hide()}else{d=$.inArray(c,a._gateCache);a._gateCache.splice(d,1);if(a._gateCache.length==0&&a._betsBubble){a._betsBubble.j_bubble.find(".lottery_bubble_content").html("\u81f3\u5c11\u9009\u62e9\u4e00\u79cd\u8fc7\u5173\u65b9\u5f0f");a._betsBubble.j_bubble.show()}}$.unique(a._gateCache);a._updateMoney("bets")});a._container.find(".j_dialog_body").on("click",".j_dan",function(){var d,c=0;d=$(this).data("match");if($(this).hasClass("disable")){return}for(var e in a._betsCache){c++}$(this).toggleClass("selected");if($(this).hasClass("selected")){a._danCache.push(d)}else{a._danCache.splice($.inArray(d,a._danCache),1);for(var e in a._betsCache){$(".j_dan_"+e).removeClass("disable")}}if(a._danCache.length+1==c){a._container.find(".j_dan").each(function(f,g){if(!$(g).hasClass("selected")){$(g).addClass("disable");return}})}a._renderGate();a._updateMoney("bets")});a._container.find(".j_dialog_body").on("keydown",".j_single_mutiple, .j_bets_mutiple",function(c){return a._numberKeyOnly(c)}).on("change",".j_single_mutiple, .j_bets_mutiple",function(){var d=$(this).data("type"),c=$(this).val();if(!c){$(this).val(1)}a._updateMoney(d)}).on("keyup",".j_single_mutiple, .j_bets_mutiple",function(){var d=$(this).data("type"),c=$(this).val();if(c){c=c.replace(/\D/g,"")}$(this).val(c);a._updateMoney(d)});a._container.find(".j_dialog_body").on("click",".j_single_pay, .j_bets_pay",function(){var c;if($(this).hasClass("disable")){return}c=$(this).data("type");switch(c){case"single":window.open(a._buildSingleUrl());break;case"bets":window.open(a._buildBetsUrl());break}setTimeout(function(){a._container.find(".j_dialog_close").trigger("click")},500)});a._container.find(".j_dialog_body").on("click",".j_refresh",function(){var k,e="",g=0,c,f=[],l=[];if($(this).hasClass("lottery_icon_change_disable")){return}k=$(this).data("type");for(var d=0,h=a._lotteryData[k].length;d<h;d++){if(typeof a["_"+k+"Cache"][a._lotteryData[k][d]["match_num"]]=="undefined"){l.push(a._lotteryData[k][d])}}for(var m in a["_"+k+"Cache"]){f.push(m);e+=$("<div>").append($(".j_"+k+"_"+m).clone()).html();g++}for(;g<5;g++){c=Math.round(Math.random()*(l.length-1)+1);if(typeof l[c]!="undefined"&&$.inArray(l[c]["match_num"],f)<0){f.push(l[c]["match_num"]);e+=$.tb.format(a["_"+k+"Tpl"],l[c])}else{g=g-1}}a._container.find(".j_"+k+"_tbody").html(e)})},_buildSingleUrl:function(){var b=this,d="http://tieba.lecai.com/user/cooperator/baidu/bet_confirm.php?lottery_type=85",a=parseInt(b._container.find(".j_single_mutiple").val(),10),e="8501:8502%";for(var c in b._singleCache){e+=c+"(";e+=b._singleCache[c].join(";");e+="),"}e=e.slice(0,-1);return d+"&content="+encodeURIComponent(e)+"&multiple="+a},_buildBetsUrl:function(){var c=this,e="http://tieba.lecai.com/user/cooperator/baidu/bet_confirm.php?lottery_type=85",b=parseInt(c._container.find(".j_bets_mutiple").val(),10),g="8500:";for(var f=0,a=c._gateCache.length;f<a;f++){switch(c._gateCache[f]){case 2:g+="8503,";break;case 3:g+="8504,";break;case 4:g+="8505,";break;case 5:g+="8506,";break}}g=g.slice(0,-1);g+="%";if(c._danCache.length>0){for(var f=0,a=c._danCache.length;f<a;f++){g+=c._danCache[f]+"(";g+=c._betsCache[c._danCache[f]].join(";");g+="),"}g=g.slice(0,-1);g+="#"}for(var d in c._betsCache){if($.inArray(parseInt(d),c._danCache)==-1){g+=d+"(";g+=c._betsCache[d].join(";");g+="),"}}g=g.slice(0,-1);return e+"&content="+encodeURIComponent(g)+"&multiple="+b},_updateMoney:function(g){var s=this,J,q,H,L=0,e=0,d=this.use("comforum/component/LotteryHelper");if(g=="single"){J=s._container.find(".j_single_award");q=s._container.find(".j_single_money");H=s._container.find(".j_single_mutiple");for(var G in s._singleCache){var A=0;L+=s._singleCache[G].length;$.each(s._singleCache[G],function(k,m){var i=s._lotteryInfo.single[G][m];A=A>i?A:i});e+=A}if(L>0&&parseInt(H.val()||0,10)){s._container.find(".j_single_pay").removeClass("disable")}else{s._container.find(".j_single_pay").addClass("disable")}q.text(L*2*parseInt(H.val()||0,10));J.text((e*parseInt(H.val()||0,10)).toFixed(2))}else{J=s._container.find(".j_bets_award");q=s._container.find(".j_bets_money");H=s._container.find(".j_bets_mutiple");e=1;var o=[],D=s._danCache;for(var v in s._betsCache){o.push(v)}if(s._danCache.length>0){for(var B=0,w=s._danCache.length;B<w;B++){o=$.grep(o,function(i,k){return i!=s._danCache[B]})}}if(s._gateCache.length!=0){for(var B=0,C=s._gateCache.length;B<C;B++){var p=s._gateCache[B];var h=d.fullCombinationDantuo(p,s._danCache,o);L+=s._countCombinedArr(h)}if(L>0&&parseInt(H.val()||0,10)){s._container.find(".j_bets_pay").removeClass("disable")}else{s._container.find(".j_bets_pay").addClass("disable")}q.text(L*2*parseInt(H.val()||0,10))}else{J.text(0);q.text(0);s._container.find(".j_bets_pay").addClass("disable");return}var f=[],E=[],I=0;if(D.length>0){for(var y=0,F=D.length;y<F;y++){var v=D[y],z={max:0};for(var B=0,w=s._betsCache[v].length;B<w;B++){var r=0;r=s._lotteryInfo.bets[v][s._betsCache[v][B]];z.max=(z.max==0)?r:(z.max<r?r:z.max)}f.push(z.max)}f.sort(function(k,i){return i-k})}if(o.length>0){for(var y=0,F=o.length;y<F;y++){var v=o[y],z={max:0};for(var B=0,w=s._betsCache[v].length;B<w;B++){var r=0;r=s._lotteryInfo.bets[v][s._betsCache[v][B]];z.max=(z.max==0)?r:(z.max<r?r:z.max)}E.push(z.max)}E.sort(function(k,i){return i-k})}for(var B=D.length+o.length,t=s._gateCache[s._gateCache.length-1];B>=t;B--){var b=0;for(var x=0,K=s._gateCache.length;x<K;x++){var e=d.combine(B-D.length,s._gateCache[x]-D.length),A=0;if(e>0){var a=d.fullCombinationDantuo(s._gateCache[x],f,E.slice(0,B-D.length));for(var v=0;v<a.length;v++){var c=a[v],l=1;for(var u=0;u<c.length;u++){l*=c[u]}l=(Math.round(l*2*100)/100)*parseInt(H.val()||0,10);A+=l}b+=A}}I=I<b?b:I}J.text(I.toFixed(2))}},_countN_1:function(b){var c=this,f=1;for(var e=0,a=b.length;e<a;e++){var d=0;for(j=0,jlen=c._betsCache[b[e]].length;j<jlen;j++){if(typeof c._betsCache[b[e]][j]!="undefined"){d++}}f*=d}return f},_countCombinedArr:function(b){var c=this;var e=0;for(var d=0,a=b.length;d<a;d++){e+=c._countN_1(b[d])}return e},_numberKeyOnly:function(a){var b=a.which,c=false;if(a.shiftKey){if(b==9){c=true}c=false}if((b<=57&&b>=48)||b==37||b==39||b==8||b==9||b==46||(b<=105&&b>=96)||b==229){c=true}return c},_showBubble:function(b){var c={content:'<div class="lottery_bubble_content">'+b.content+"</div>",arrow_dir:"down",bubble_css:{top:-20,right:10,width:b.width||150},arrow_pos:{right:0},attr:" id='tb_message_tip_n' ",wrap:b.wrap,closeBtn:false,level:1,arrowReq:true};var a=new UiBubbleTipBase(c);return a},_stats:function(b){var a=this;this._container.on("click",function(f){var d=f.target||f.srcElement,c=$(d).data("log");if(c){$.stats.sendRequest("fr=tb0_forum&st_page="+a._page+"&st_mod=lottery_dialog&st_fid="+a._forumId+"&first_class="+encodeURIComponent(b.forum.first_class)+"&second_class="+encodeURIComponent(b.forum.second_class)+"&st_type="+c);$.stats.track(c,"lecai_lottery","frs","click")}})}}});;_.Module.define({path:"comforum/widget/LecaiLotteryA",requires:["comforum/widget/LecaiLotteryA/LotteryDialog"],sub:{_status:null,_singleLottery:null,_betsLottery:null,_selectedData:[],_container:$("#lecai_lottery"),_forumId:0,_page:null,initial:function(a,e,b,f,c,d){this._status=a;this._forumId=c.forum.id;this._page=d;this._singleLottery=$.parseJSON(e);this._betsLottery=$.parseJSON(b);this._bindEvents(c);if(this._status==1){this._countTime();if(f){this._container.find(".lottery_icon_btn_3").trigger("click")}else{this._container.find(".lottery_icon_btn_0").trigger("click")}}if(PageUnit.load("lecai_lottery_show_guide")){this._renderGuide()}this._stats(c)},_bindEvents:function(b){var a=this;a._container.find(".j_lottery_order").on("click",function(){if($(this).hasClass("disable")){return}var d=$(this).data("type");var e={lotteryData:{single:a._singleLottery,bets:a._betsLottery},defaultTab:d,selectedData:a._selectedData,forumId:a._forumId,PageData:b,page:a._page},c=a.use("comforum/widget/LecaiLotteryA/LotteryDialog",e)});a._container.find(".j_lottery_select").on("click",function(){var e=$(this).data("rel"),d=$(this).data("match"),c;$(this).toggleClass("select");if($(this).hasClass("select")){a._selectedData.push(d+"_"+e)}else{c=$.inArray(d+"_"+e,a._selectedData);a._selectedData.splice(c,1)}})},_countTime:function(){var a=this,e=a._container.find(".j_lottery_deadline"),d=parseInt(e.data("diff")),c=function(f){return f<10?"0"+f:f},b=setInterval(function(){var f,g;if(d<=0){a._container.find(".j_lottery_order").addClass("disable");a._container.find(".j_lottery_deadline").parent("p").text("\u672c\u573a\u6bd4\u8d5b\u6295\u6ce8\u5df2\u622a\u6b62");clearInterval(b);return}d-=1;f=new Date(d*1000);g=c(Math.floor(d/3600))+":"+c(f.getUTCMinutes())+":"+c(f.getUTCSeconds());e.text(g)},1000)},_renderGuide:function(){var a=this;if(!$.cookie("lottery_guide")&&a._status!=5){var b=['<div class="lottery_guide_wrap">','<div class="lottery_guide">','<span class="lottery_guide_close j_guide_close"></span>',PageUnit.load("lecai_lottery_guide_link"),"</div>","</div>"].join("");a._container.append(b);a._container.find(".j_guide_close").on("click",function(){a._container.find(".lottery_guide").remove()});$.cookie("lottery_guide",1,{expires:30})}},_stats:function(b){var a=this;this._container.on("click",function(f){var d=f.target||f.srcElement,c=$(d).data("log");if(c){$.stats.sendRequest("fr=tb0_forum&st_page="+a._page+"&st_mod=lecai_aside&st_fid="+b.forum.id+"&first_class="+encodeURIComponent(b.forum.first_class)+"&second_class="+encodeURIComponent(b.forum.second_class)+"&st_type="+c);$.stats.track(c,"lecai_lottery","frs","click")}})}}});;_.Module.define({path:"comforum/widget/LecaiLotteryB",requires:["comforum/component/LotteryHelper"],sub:{_container:null,_lotteryHelper:null,_singleLottery:null,_index:0,_selected:[],_t:null,_bubble:null,_page:"",initial:function(a,d,e,b,c){this._container=$("#lecai_lottery");this._page=c;this._lotteryHelper=this.use("comforum/component/LotteryHelper");this._singleLottery=this._formatData(d);this._bindEvents();if(e||a!==1){this._selected.push(3)}else{this._selected.push(0)}this._t=this._countTime();this._stats(b)},_formatData:function(d){var c=$.parseJSON(d);for(var b=0,a=c.length;b<a;b++){if(c[b].scale_home.toString().length>5){c[b].scale_home=c[b].scale_home.toPrecision(4)}if(c[b].scale_away.toString().length>5){c[b].scale_away=c[b].scale_away.toPrecision(4)}if(c[b].scale_equal.toString().length>5){c[b].scale_equal=c[b].scale_equal.toPrecision(4)}}return c},_formatTime:function(c){if(c<0){return"00:00:00"}var a=new Date(c*1000);var b=function(e){return e<10?"0"+e:e};var d=b(Math.floor(c/3600))+":"+b(a.getUTCMinutes())+":"+b(a.getUTCSeconds());return d},_bindEvents:function(){var a=this;a._container.on("keydown",".j_quick_ipt",function(b){return a._lotteryHelper.numberKeyOnly(b)}).on("change",".j_quick_ipt",function(){var b=$(this).val();if(!b){$(this).val(1)}}).on("keyup",".j_quick_ipt",function(){var b=$(this).val();if(b){b=b.replace(/\D/g,"")}if(parseInt(b,10)===0){b=1}$(this).val(b)});baidu.observe(a._selected,"create",function(e,b){var c=a._container.find(".lottery_icon_btn_"+e);var d=a._container.find(".j_quick_tz");c.addClass("select");a._bubble&&a._bubble.hideBubble();a._setBtnTips();d.toggleClass("disable",a._selected.length===0)});baidu.observe(a._selected,"delete",function(b,e){var c=a._container.find(".lottery_icon_btn_"+b);var d=a._container.find(".j_quick_tz");c.removeClass("select");a._setBtnTips();d.toggleClass("disable",a._selected.length===0)});a._container.on("click",".j_lottery_select",function(){var b=$(this).data("rel");if($(this).hasClass("select")){a._selected.splice($.inArray(b,a._selected),1)}else{a._selected.push(b)}});a._container.on("click",".j_quick_tz",function(){if($(this).hasClass("disable")){if(!a._bubble){a._bubble=a._showBubble({content:"\u81f3\u5c11\u9009\u62e9\u4e00\u79cd\u6bd4\u8d5b\u7ed3\u679c",wrap:a._container.find(".j_lottery_bubble")})}a._bubble.showBubble();return}window.open(a._buildUrl())});a._container.on("click",".j_quick_refresh",function(){a._index++;a._selected.length=0;if(a._index===a._singleLottery.length){a._index=0}var c=a._singleLottery[a._index];c.format_lotttery_end=a._formatTime(c.lottery_end_time-Math.floor(new Date().getTime()/1000));var d=$.tb.format(a._tpl1,c);var b=$.tb.format(a._tpl2,c);a._container.find(".j_quick_rpl1").replaceWith(d);a._container.find(".j_quick_rpl2").replaceWith(b);a._container.find(".lottery_icon_btn_3 ").trigger("click");var e=a._container.find(".j_bottom_tip");if(e.length){e.remove()}clearInterval(a._t);a._t=a._countTime()})},_setBtnTips:function(){var b=this._singleLottery[this._index];var c=this._container.find(".j_quick_tz");var a=c.children("span");if(this._selected.length===1){this._selected[0]==3&&a.text("\u652f\u6301"+b.home+" \u7acb\u5373\u6295\u6ce8");this._selected[0]==1&&a.text("\u773c\u5149\u4e0d\u9519 \u7acb\u5373\u6295\u6ce8");this._selected[0]==0&&a.text("\u652f\u6301"+b.away+" \u7acb\u5373\u6295\u6ce8")}else{a.text("\u773c\u5149\u4e0d\u9519 \u7acb\u5373\u6295\u6ce8")}},_tpl1:['<div class="lottery_logo clearfix j_quick_rpl1">','<div class="lottery_logo_home">','<img src="http://tb1.bdstatic.com/tb/cms/com/lottery/team/#{home_imgsrc}">',"<p>#{home}</p>",'<div class="lottery_logo_cover lottery_icon_logo_frs"></div>',"</div>",'<div class="lottery_middle">','<div class="lottery_middle_info">','<p class="lottey_middle_time j_lottery_deadline" data-end="#{lottery_end_time}">#{format_lotttery_end}</p>',"<p>#{race}</p>","</div>",'<i class="lottery_icon_vs_small"></i>',"</div>",'<div class="lottery_logo_away">','<img src="http://tb1.bdstatic.com/tb/cms/com/lottery/team/#{away_imgsrc}">',"<p>#{away}</p>",'<div class="lottery_logo_cover lottery_icon_logo_frs"></div>',"</div>","</div>"].join(""),_tpl2:['<div class="lottery_btn j_quick_rpl2">','<div class="lottery_icon_btn_3 j_lottery_select" data-match="#{match_num}" data-rel="3" title="\u6570\u5b57\u8d8a\u5c0f\u4e2d\u5956\u53ef\u80fd\u8d8a\u5927" data-log="lottery_sp_3">\u4e3b\u80dc<span>#{scale_home}</span></div>','<div class="lottery_icon_btn_1 j_lottery_select" data-match="#{match_num}" data-rel="1" title="\u6570\u5b57\u8d8a\u5c0f\u4e2d\u5956\u53ef\u80fd\u8d8a\u5927" data-log="lottery_sp_1">\u5e73\u5c40<span>#{scale_equal}</span></div>','<div class="lottery_icon_btn_0 j_lottery_select" data-match="#{match_num}" data-rel="0" title="\u6570\u5b57\u8d8a\u5c0f\u4e2d\u5956\u53ef\u80fd\u8d8a\u5927" data-log="lottery_sp_0">\u5ba2\u80dc<span>#{scale_away}</span></div>',"</div>"].join(""),_buildUrl:function(){var b=this;var c="http://tieba.lecai.com/user/cooperator/baidu/bet_confirm.php?lottery_type=85";var d="8501:8502%";var a=parseInt($(".j_quick_ipt").val(),10);d+=b._singleLottery[b._index].match_num+"("+b._selected.join(";")+")";return c+"&content="+encodeURIComponent(d)+"&multiple="+a},_countTime:function(){var a=this,e=a._container.find(".j_lottery_deadline"),d=parseInt(e.data("end"))-Math.floor(new Date().getTime()/1000),c=function(f){return f<10?"0"+f:f},b=setInterval(function(){var f,g;if(d<=0){a._container.find(".j_quick_tz").addClass("disable");$(a._bottomTip("\u672c\u573a\u6bd4\u8d5b\u6295\u6ce8\u5df2\u622a\u6b62")).insertAfter(a._container.find(".j_quick_options"));a._singleLottery[a._index].isEnd=true;clearInterval(b);return}d-=1;f=new Date(d*1000);g=c(Math.floor(d/3600))+":"+c(f.getUTCMinutes())+":"+c(f.getUTCSeconds());e.text(g)},1000);return b},_bottomTip:function(b){var a='<div class="lottery_nomatch_tip j_bottom_tip">'+b+"</div>";return a},_showBubble:function(b){var c={content:'<div class="lottery_bubble_content">'+b.content+"</div>",arrow_dir:"down",bubble_css:{top:-20,right:10,width:b.width||150},arrow_pos:{right:0},attr:" id='tb_message_tip_n' ",wrap:b.wrap,closeBtn:false,level:1,arrowReq:true};var a=new UiBubbleTipBase(c);return a},_stats:function(b){var a=this;a._container.on("click",function(f){var d=f.target||f.srcElement,c=$(d).data("log");if(c){$.stats.sendRequest("fr=tb0_forum&st_page="+a._page+"&st_mod=lottery_footer_new&st_fid="+b.forum.id+"&first_class="+encodeURIComponent(b.forum.first_class)+"&second_class="+encodeURIComponent(b.forum.second_class)+"&enfirst_class="+b.forum.first_class+"&ensecond_class="+b.forum.second_class+"&st_type="+c);$.stats.track(c,"\u65b0\u7248\u8db3\u5f69\u6837\u5f0f",a._page,"click")}})}}});;_.Module.define({path:"comforum/component/LotteryHelper",sub:{initial:function(){},permute:function(d,a){var b=1;for(var c=0;c<a;c++){b*=(d-c)}return parseInt(b,10)},combine:function(d,a){var b=this;var c=b.permute(d,a);c/=b.permute(a,a);return parseInt(c,10)},fullCombination:function(j,b){var d=[];var g=j.length;var e=[];for(var c=0;c<=b;c++){e.push(c-1)}var h=b;var f=true;while(e[0]==-1){if(f){var a=[];for(var c=1;c<=b;c++){a.push(j[e[c]])}d.push(a);f=false}e[h]++;if(e[h]==g){e[h]=0;h--;continue}if(h<b){h++;e[h]=e[h-1];continue}if(h==b){f=true}}return d},fullCombinationDantuo:function(f,a,j){var k=this;var d=0;if(a){d=a.length}var c=j.length;if(d+c<f){return false}var b=f-d;var h=k.fullCombination(j,b);for(var e=0,g=h.length;e<g;e++){h[e]=h[e].concat(a)}return h},countCombinationDantuo:function(d,b,c){var a=this;b=(typeof(b)=="undefined")?0:b;var e=d-b;return a.combine(c,e)},arrayFullCombination:function(b){var a=this;var e=function(h,f){var n=h;var m=[];while(f.length>0){for(var l=0;l<n.length;l++){var g=[f[0]];for(var j=0;j<n[l].length;j++){g.push(n[l][j])}m.push(g)}f=f.slice(1,f.length)}return m};var d=a.fullCombination(b[0],1);for(var c=1;c<b.length;c++){d=e(d,b[c])}return d},arrayIsNoRepeat:function(a){var b=0,c={};for(;b<a.length;b++){if(c[a[b]]!==undefined){return false}c[a[b]]=true}return true},arrayIsHasNoRepeat:function(e){var h=this;var j=e.length;var b=[];var f=[];var g=[];var k=[];var a=1;for(var d=0;d<j;d++){b[d]=e[d].length;a=a*b[d];f[d]=0}for(var d=0;d<a;d++){g[d]=[]}var c=0;while(true){for(var d=0;d<j;d++){g[c][d]=(f[d]+1);k[d]=e[d][g[c][d]-1]}if(h.arrayIsNoRepeat(k)){return true}c++;for(var d=j-1;d>=0;d--){if(f[d]==b[d]-1){f[d]=0}else{break}}if(d<0){break}f[d]++}return false},generateRandom:function(f,a,d){if(d>a-f){return[]}var e=[];var b=0;while(b<d){var c=Math.round(Math.random()*(a-1)+f);if($.inArray(c,e)===-1){e.push(c);b++}}return e},numberKeyOnly:function(a){var b=a.which,c=false;if(a.shiftKey){if(b==9){c=true}c=false}if((b<=57&&b>=48)||b==37||b==39||b==8||b==9||b==46||(b<=105&&b>=96)||b==229){c=true}return c}}});_.Module.define({path:"comforum/widget/LuckyLottery/LuckyLotteryTab",sub:{_tabCount:0,_$tabs:null,initial:function(b,a){this._tabCount=b.length;this._$tabs=b;typeof a!="undefined"&&this._tabSelect(a);this._bindEvents()},_tabSelect:function(b){for(var c=0,a=this._$tabs.length;c<a;c++){if(c===b){if(this._$tabs[b].hasClass("lucky_open")){this._$tabs[b].children("dd").slideUp();this._$tabs[b].removeClass("lucky_open").addClass("lucky_close")}else{this._$tabs[b].children("dd").slideDown();this._$tabs[b].removeClass("lucky_close").addClass("lucky_open")}}else{this._$tabs[c].children("dd").slideUp();this._$tabs[c].removeClass("lucky_open").addClass("lucky_close")}}},_bindEvents:function(){var b=this;for(var c=0,a=b._tabCount;c<a;c++){b._$tabs[c].children("dt").on("click",(function(d){return function(){b._tabSelect(d)}})(c))}}}});;_.Module.define({path:"comforum/widget/LuckyLottery",requires:["comforum/widget/LuckyLottery/LuckyLotteryTab","comforum/component/LotteryHelper"],sub:{_container:null,_page:null,_11ydj:[],_xk3_1:[],_xk3_2:[],_xssc:{hundred:[],ten:[],digit:[]},_bubbles:{shiyiydj:null,xk3_1:null,xk3_2:null,xssc:null},_lotteryHelper:null,initial:function(c,b,a){this._container=$("#lucky_lottery");this.use("comforum/widget/LuckyLottery/LuckyLotteryTab",[this._container.find(".j_lucky_tab1"),this._container.find(".j_lucky_tab2"),this._container.find(".j_lucky_tab3")]);this._page=b;this._lotteryHelper=this.use("comforum/component/LotteryHelper");this._countTime(c);this._bubbles();this._bindEvents();this._stats(a);this._container.find(".j_11ydj_jx").trigger("click");this._container.find(".j_xks2_jx").trigger("click");this._container.find(".j_xssc_jx").trigger("click")},_countTime:function(e){var a=this;var c=[a._container.find(".j_11ydj_time"),a._container.find(".j_xks_time"),a._container.find(".j_xssc_time")];var d=function(g){return g<10?"0"+g:g};var f=function(h){if(h<0){return"00\u520600\u79d2"}var g=new Date(h);var i=d(g.getUTCMinutes())+"\u5206"+d(g.getUTCSeconds())+"\u79d2";return i};var b=setInterval(function(){var j=[];for(var h=0,g=c.length;h<g;h++){var k=e[h]*1000-new Date().getTime();k<0&&j.push(h);c[h].text(f(k))}j.length===g&&clearInterval(b)},1000)},_bindEvents:function(){var a=this;a._container.on("click",".j_11ydj_num",function(){var c=parseInt($(this).data("num"),10);if($(this).hasClass("select")){$(this).removeClass("select");var b=$.inArray(c,a._11ydj);a._11ydj.splice(b,1)}else{$(this).addClass("select");a._11ydj.push(c)}a._update11ydjMoney()});a._container.on("click",".j_11ydj_jx",function(){var c=a._lotteryHelper.generateRandom(1,11,5);a._container.find(".j_11ydj_num.select").removeClass("select");a._11ydj.length=0;for(var d=0,b=c.length;d<b;d++){a._container.find(".j_11ydj_num"+c[d]).trigger("click")}});a._container.on("click",".j_11ydj_tz",function(){if($(this).hasClass("disable")){a._bubbles.shiyiydj.showBubble();return}window.open(a._build11ydjUrl())});a._container.on("keydown",".j_mutiple_11ydj, .j_mutiple_xks1, .j_mutiple_xks2, .j_mutiple_xssc",a._lotteryHelper.numberKeyOnly).on("change",".j_mutiple_11ydj, .j_mutiple_xks2, .j_mutiple_xssc",function(){var b=$(this).val();if(!b){$(this).val(1);$(this).trigger("keyup")}}).on("keyup",".j_mutiple_11ydj, .j_mutiple_xks1, .j_mutiple_xks2, .j_mutiple_xssc",function(){var b=$(this).val();if(b){b=b.replace(/\D/g,"")}$(this).val(b)});a._container.on("keyup",".j_mutiple_11ydj",function(){a._update11ydjMoney()});a._container.on("keyup",".j_mutiple_xks1",function(){a._updateXks1Money()});a._container.on("keyup",".j_mutiple_xks2",function(){a._updateXks2Money()});a._container.on("keyup",".j_mutiple_xssc",function(){a._updateXsscMoney()});a._container.on("click",".j_lucky_count",function(){var d=this;var c=a._lotteryHelper.generateRandom(1,6,1);var e=a._container.find(".j_xks1_rst");var b=setInterval(function(){var f=a._lotteryHelper.generateRandom(1,18,1);e.text(f)},80);$(d).addClass("lucky_icon_dice");setTimeout(function(){var g=$(d).data("count");$(d).data("count",c).removeClass("lucky_icon_dice").removeClass("lucky_icon_count"+g).addClass("lucky_icon_count"+c);clearInterval(b);var f=0;a._container.find(".j_lucky_count").each(function(){f+=parseInt($(this).data("count"),10)});e.text(f)},1000)});a._container.on("click",".j_xks1_jx",function(){a._container.find(".j_lucky_count").trigger("click")});a._container.on("click",".j_xks1_tz",function(){if($(this).hasClass("disable")){a._bubbles.xk3_1.showBubble();return}window.open(a._buildXks1Url())});a._container.on("click",".j_xks_num",function(){var b=$(this).data("num");if($(this).hasClass("rect_select")){a._xk3_2.splice($.inArray(b,a._xk3_2),1);$(this).removeClass("rect_select")}else{a._xk3_2.push(b);$(this).addClass("rect_select")}a._updateXks2Money()});a._container.on("click",".j_xks2_jx",function(){var c=a._lotteryHelper.generateRandom(1,6,3);a._container.find(".j_xks_num.rect_select").removeClass("rect_select");a._xk3_2.length=0;for(var d=0,b=c.length;d<b;d++){a._container.find(".j_xks_num"+c[d]).trigger("click")}});a._container.on("click",".j_xks2_tz",function(){if($(this).hasClass("disable")){a._bubbles.xk3_2.showBubble();return}window.open(a._buildXks2Url())});a._container.on("click",".j_xssc_hundred,.j_xssc_ten,.j_xssc_digit",function(){var c=$(this).data("pos");var b=$(this).data("num");if($(this).hasClass("select")){a._xssc[c].splice($.inArray(b,a._xssc[c]),1);$(this).removeClass("select")}else{a._xssc[c].push(b);$(this).addClass("select")}a._updateXsscMoney()});a._container.on("click",".j_xssc_jx",function(){var e=["hundred","ten","digit"];for(var c=0,b=e.length;c<b;c++){a._container.find(".j_xssc_"+e[c]+".select").removeClass("select");a._xssc[e[c]].length=0;var d=a._lotteryHelper.generateRandom(0,9,1);a._container.find(".j_xssc_"+e[c]+d).trigger("click")}});a._container.on("click",".j_xssc_tz",function(){if($(this).hasClass("disable")){a._bubbles.xssc.showBubble();return}window.open(a._buildXsscUrl())})},_update11ydjMoney:function(){var b=this,e=b._11ydj.length,d,f,a;if(e<5){d=0}else{f=parseInt(b._container.find(".j_mutiple_11ydj").val(),10)||0;a=b._lotteryHelper.combine(e,5);d=f*a*2}var c=b._container.find(".j_11ydj_tz");if(d>0){b._bubbles.shiyiydj.hideBubble();c.removeClass("disable")}else{c.addClass("disable")}b._container.find(".j_money_11ydj").text(d)},_updateXsscMoney:function(){var a=this;var c,e,d;if(a._xssc.hundred.length&&a._xssc.ten.length&&a._xssc.digit.length){a._bubbles.xssc.hideBubble();a._container.find(".j_xssc_tz").removeClass("disable");d=a._lotteryHelper.combine(a._xssc.hundred.length,1)*a._lotteryHelper.combine(a._xssc.ten.length,1)*a._lotteryHelper.combine(a._xssc.digit.length,1);e=parseInt(a._container.find(".j_mutiple_xssc").val(),10)||0;c=d*e*2}else{c=0}var b=a._container.find(".j_xssc_tz");if(c>0){a._bubbles.xssc.hideBubble();b.removeClass("disable")}else{b.addClass("disable")}a._container.find(".j_money_xssc").text(c)},_updateXks2Money:function(){var b=this,e=b._xk3_2.length,f,d,a;if(e<3){d=0}else{a=b._lotteryHelper.combine(e,3);f=parseInt(b._container.find(".j_mutiple_xks2").val(),10)||0;d=a*f*2}var c=b._container.find(".j_xks2_tz");if(d>0){b._bubbles.xk3_2.hideBubble();c.removeClass("disable")}else{c.addClass("disable")}b._container.find(".j_money_xks2").text(d)},_updateXks1Money:function(){var a=this,d=parseInt(a._container.find(".j_mutiple_xks1").val(),10)||0,c=d*2;var b=a._container.find(".j_xks1_tz");if(c>0){a._bubbles.xk3_1.hideBubble();b.removeClass("disable")}else{b.addClass("disable")}a._container.find(".j_money_xks1").text(c)},_build11ydjUrl:function(){var b=this;var f=b._container.find(".j_mutiple_11ydj").val();var c="http://tieba.lecai.com/user/cooperator/baidu/bet_confirm.php?lottery_type=20";var e=b._11ydj.length===5?"2009%":"2010%";for(var d=0,a=b._11ydj.length;d<a;d++){e+=b._11ydj[d]+","}e=e.slice(0,-1);return c+"&content="+encodeURIComponent(e)+"&multiple="+f},_buildXks1Url:function(){var a=this;var e=a._container.find(".j_mutiple_xks1").val();var b="http://tieba.lecai.com/user/cooperator/baidu/bet_confirm.php?lottery_type=560";var c="56001%";var d=a._container.find(".j_xks1_rst").text();c+=d+"_1";return b+"&content="+encodeURIComponent(c)+"&multiple="+e},_buildXks2Url:function(){var b=this;var f=b._container.find(".j_mutiple_xks2").val();var c="http://tieba.lecai.com/user/cooperator/baidu/bet_confirm.php?lottery_type=560";var e=b._xk3_2.length===3?"56010%":"56011%";for(var d=0,a=b._xk3_2.length;d<a;d++){e+=b._xk3_2[d]+","}e=e.slice(0,-1);return c+"&content="+encodeURIComponent(e)+"&multiple="+f},_buildXsscUrl:function(){var k=this;var h=k._container.find(".j_mutiple_xssc").val();var a="http://tieba.lecai.com/user/cooperator/baidu/bet_confirm.php?lottery_type=202";var f=(k._xssc.hundred.length===1&&k._xssc.ten.length===1&&k._xssc.digit.length===1)?"20205%":"20206%";var b=["hundred","ten","digit"];for(var d=0,e=b.length;d<e;d++){for(var c=0,g=k._xssc[b[d]].length;c<g;c++){f+=k._xssc[b[d]][c]+","}f=f.slice(0,-1);f+="|"}f=f.slice(0,-1);return a+"&content="+encodeURIComponent(f)+"&multiple="+h},_bubbles:function(){var a=this;a._bubbles.shiyiydj=a._showBubble({wrap:a._container.find(".j_11ydj_bubble"),dir:"down",content:"\u8bf7\u81f3\u5c11\u9009\u62e95\u4e2a\u6570\u5b57"});a._bubbles.xk3_2=a._showBubble({wrap:a._container.find(".j_xks2_bubble"),dir:"down",content:"\u81f3\u5c11\u9009\u62e9\u4e00\u6ce8"});a._bubbles.xk3_1=a._showBubble({wrap:a._container.find(".j_xks1_bubble"),dir:"down",content:"\u81f3\u5c11\u9009\u62e9\u4e00\u6ce8"});a._bubbles.xssc=a._showBubble({wrap:a._container.find(".j_xssc_bubble"),dir:"down",content:"\u81f3\u5c11\u9009\u62e9\u4e00\u6ce8"})},_showBubble:function(b){var c={content:'<div class="lottery_bubble_content">'+b.content+"</div>",arrow_dir:b.dir||"down",bubble_css:{top:-20,right:10,width:b.width||150},arrow_pos:{right:0},wrap:b.wrap,closeBtn:true,level:1,arrowReq:true};var a=new UiBubbleTipBase(c);return a},_stats:function(b){var a=this;a._container.on("click",function(f){var d=f.target||f.srcElement,c=$(d).data("log");if(c){$.stats.sendRequest("fr=tb0_forum&st_page="+a._page+"&st_mod=lucky_lottery&st_fid="+b.forum.forum_id+"&first_class="+encodeURIComponent(b.forum.first_class)+"&second_class="+encodeURIComponent(b.forum.second_class)+"&st_type="+c);$.stats.track(c,"lucky_lottery","frs","click")}})}}});;_.Module.define({path:"comforum/widget/Wallet",sub:{initial:function(a,b){this.dataObj=a;this.is_login=b;this.priceMap={};this._initSelect();this._bindEvents();this._marquee()},_bindEvents:function(){var a=this;$("#wallet_game_title").on("change",function(){a._fillOptions();a._setPriceAndLink()});$("#wallet_game_value").on("change",function(){a._setPriceAndLink()});if(!a.is_login){$("#btn_recharge").on("click",function(){TbCom.process("User","buildLoginFrame",null,null,null,"wallet");return false})}$("#btn_recharge").on("mousedown",function(){$.stats.sendRequest("fr=tb0_forum&st_type=wallet&st_value=recharge")});$(".wallet_tips_list li a").on("click",function(){$.stats.sendRequest("fr=tb0_forum&st_type=wallet&st_value=tips")})},_initSelect:function(){var a=$("#wallet_game_title").val();this._fillOptions();this._setPriceAndLink()},_fillOptions:function(){var a=new Array();var b=$("#wallet_game_title").val();var d=this.dataObj[b].data;for(var c=0;c<d.length;c++){a.push('<option value="'+d[c].parid+'">'+d[c].parvalue+"</option>");this.priceMap[d[c].parid]=d[c].price}$("#wallet_game_value").html(a.join(""))},_setPriceAndLink:function(){var a=$("#wallet_game_value").val();var c=this.priceMap[a];var b="http://baifubao.baidu.com/jump?uri=/wy?game="+$("#wallet_game_title").val()+"&price="+a+"&c=710&domain=http://life.baifubao.com";$("#btn_recharge").tbattr("href",b);$("#wallet_game_price").html(c)},_marquee:function(){var a=$(".wallet_tips_wrap").width(),b=$(".wallet_tips_list").width(),d=0,c=$(".wallet_tips");scrollFunc=function(){c.css("right",d);d++;if(d==b){d=-a}},t=setInterval(scrollFunc,50);$(".wallet_tips_list").on("mouseover",function(){clearInterval(t)}).on("mouseout",function(){t=setInterval(scrollFunc,50)})}}});_.Module.define({path:"comforum/widget/HistoryGame",sub:{initial:function(b,c,a){this.page=b;this.fname=c;this._bindEvents(a)},_bindEvents:function(b){var a=this;$(".hgame_link").on("click",function(){var d=[],c=$(this).data("stvalue"),e=$(this).data("stratype"),f=$(this).data("tab"),g=$(this).data("pos");d.push("fr=tb0_forum");d.push("st_mod="+a.page);d.push("fname="+encodeURIComponent(a.fname));d.push("tab_type="+f);d.push("pos="+g);d.push("stra_type="+e);d.push("show_type=icon");d.push("st_type=gamelist");d.push("st_value="+encodeURIComponent(c));d.push("enfirst_class="+b.forum.first_class);d.push("ensecond_class="+b.forum.second_class);d.push("first_class="+encodeURIComponent(b.forum.first_class));d.push("second_class="+encodeURIComponent(b.forum.second_class));$.stats.sendRequest(d.join("&"))});$(".hgame_tab_item").on("click",function(){a._selectTab($(this).index());var c=[];c.push("fr=tb0_forum");c.push("st_mod="+a.page);c.push("st_type=gametab");c.push("st_value=tab"+($(this).index()+1));c.push("first_class="+b.forum.first_class);c.push("second_class="+b.forum.second_class);c.push("enfirst_class="+encodeURIComponent(b.forum.first_class));c.push("ensecond_class="+encodeURIComponent(b.forum.second_class));$.stats.sendRequest(c.join("&"))});$("#game_login_btn").on("click",function(){TbCom.process("User","buildLoginFrame",null,null,null,"pbgame")})}}});_.Module.define({path:"common/widget/asidead",sub:{initial:function(a){if(a.length>0){var b=a.find("a").attr("location");$.stats.hive(b+"_show")}}}});var initCpro=function(){if(PageData.second_class!="\u5546\u4e1a\u4eba\u7269"&&PageData.forum_name!="\u767e\u5ea6"&&PageData.show_cpro){$.JsLoadManager.use("http://cpro.baidu.com/cpro/ui/post.js",function(){window.arrBaiduCproConfig=[];arrBaiduCproConfig.n="baidupost_cpr";arrBaiduCproConfig.tm=24;arrBaiduCproConfig.cm=60;arrBaiduCproConfig.um=24;arrBaiduCproConfig.rad=1;arrBaiduCproConfig.cad=1;arrBaiduCproConfig.wn=1;arrBaiduCproConfig.bg="#ffffff";arrBaiduCproConfig.tt="#000000";arrBaiduCproConfig.ct="#000000";arrBaiduCproConfig.url="#000000";arrBaiduCproConfig.ta="right";arrBaiduCproConfig.tl="top";arrBaiduCproConfig.tn="baiduCPROiknow";arrBaiduCproConfig.hn=3;arrBaiduCproConfig.at="text";var a={keys:["title","desc","showUrl","ckUrl","redWord","picUrl"],template:function(d){var c="onmouseout=\"return f_s(' ');\" ";var e="onmouseover=\"return f_s('\u94fe\u63a5\u81f3: "+d.showUrl+"');\"";var b="";b+="<div>";b+='<a style="display:block;width:100%;"'+c+e+' href="'+d.ckUrl+'" target="_blank">';b+='<u style="display:block;">'+Page.subByteFix(d.title,25,"..")+"</u>";if((typeof(d.picUrl)=="string")&&(d.picUrl!=="")){b+='<img src="'+d.picUrl+'" width="65" height="65"/>'}b+=Page.subByteFix(d.desc,60,"..");b+='<br/><span style="white-space:nowrap">'+Page.subByteFix(d.showUrl,31,"..")+"</span>";b+="</a>";b+="</div><br/>";return b},showCpro:function(b){return this.template(b)}};if(typeof baiduCproTableBuild=="undefined"){window.baiduCproTableBuild=function(m){var b=[],i=[],n=[],o="",e=0,g={},l="",d=0;b=m.split("\n");d=b.length;for(var h=0,f=d;h<f;h++){i=b[h].split("\t");e=i.length;n=a.keys;o+=function(p,j){for(var k=0;k<j;k++){g[n[k]]=p[k]}return a.showCpro(g)}(i,n.length)}var c=document.getElementById("cproshow");c.innerHTML+=o;if(o&&o.length>0){$("#cprodata").addClass("mg_bt26")}}}scr=document.createElement("script");scr.src=f_u("");document.body.appendChild(scr)})}};_.Module.define({path:"common/component/Follower",sub:{initial:function(a){var b={timeout:0};this.options=$.extend(b,a);this.ctn=this.options.ctn;this.timer=null;if(!$.isFunction(this.options.getLimitTop)){this.minTop=this.options.getLimitTop.minTop;this.maxTop=this.options.getLimitTop.maxTop}if(this.ctn){this.bindScrollEvent();this.bindResizeEvent()}},bindScrollEvent:function(){var a=this;$(window).scroll(function(){if(a.options.timeout==0){a.scroller()}else{if(a.timer){clearTimeout(a.timer)}a.timer=setTimeout(function(){a.scroller()},a.options.timeout)}})},bindResizeEvent:function(){var a=this;$(window).on("resize",function(){a.resizer()})},resizer:function(){},scroller:function(){var c,b;var a=$(window).scrollTop()+10;c=this.minTop?this.minTop:this.options.getLimitTop().minTop;b=this.maxTop?this.maxTop:this.options.getLimitTop().maxTop;if(a<c){if(this.ctn.data("isFixed")){this.ctn.removeClass("tbui_follow_fixed");this.ctn.data("isFixed",false);this.trigger("normal")}this.ctn.show()}else{if(a>=c&&a<=b){if(!this.ctn.data("isFixed")){this.ctn.addClass("tbui_follow_fixed");this.ctn.data("isFixed",true);this.trigger("fixed")}this.ctn.show()}else{this.trigger("hide");this.ctn.hide()}}}}});_.Module.define({path:"pb/widget/NewsRecommend",requires:["common/component/Follower"],sub:{initial:function(){var a=$(".left_section");if($(".left_section").height()>$(".right_section").height()){$("#news_rcm").wrap('<div id="news_rcm_wrapper"></div>');_.Module.use("common/component/Follower",{ctn:$("#news_rcm"),getLimitTop:function(){return{minTop:$("#news_rcm_wrapper").offset().top,maxTop:a.offset().top+a.height()-$("#news_rcm").height()}}})}}}});_.Module.define({path:"comforum/widget/Rank",sub:{_container:null,initial:function(b,d,c,a){this.page=b;this.fname=d;this.straType=c;this._container=$("#j_game_rank");this._bindEvents(a)},_bindEvents:function(b){var a=this;a._container.find(".game_rank_item").on("click",".game_rank_link",function(){var d=[],c=$(this).data("stvalue"),e=$(this).data("pos");d.push("fr=tb0_forum");d.push("st_mod="+a.page);d.push("fname="+a.fname);d.push("pos="+e);d.push("stra_type="+a.straType);d.push("show_type=ranklist");d.push("st_type=gamelist");d.push("st_value="+encodeURIComponent(c));d.push("enfirst_class="+b.forum.first_class);d.push("ensecond_class="+b.forum.second_class);d.push("first_class="+encodeURIComponent(b.forum.first_class));d.push("second_class="+encodeURIComponent(b.forum.second_class));$.stats.sendRequest(d.join("&"))});$("#j_navtab_game").on("click",function(){var c=[];c.push("fr=tb0_forum");c.push("st_mod="+a.page);c.push("fname="+a.fname);c.push("show_type=gamenavtab");c.push("enfirst_class="+b.forum.first_class);c.push("ensecond_class="+b.forum.second_class);c.push("first_class="+encodeURIComponent(b.forum.first_class));c.push("second_class="+encodeURIComponent(b.forum.second_class));$.stats.sendRequest(c.join("&"))})}}});_.Module.define({path:"pb/widget/top10",sub:{initial:function(){this._addStats()},_addStats:function(){var a=PageData.forum.name;var b="fr=tb0_forum&fname="+a;if($.inArray(PageData.forum.name,["\u7b11\u50b2\u6c5f\u6e56\u7535\u89c6\u5267","\u70ed\u5e26\u9c7c","ac\u7c73\u5170","lol","\u5723\u5802","\u67ef\u5357"])>=0){$.stats.sendRequest(b+"&st_type=pb_top10_show");$("#follow_wrapper").find(".j_tieba_top10_content").delegate("a","click",function(){$.stats.sendRequest(b+"&st_type=pb_top10_click")})}}}});(function(a){var b={POST_AUTHORIZED:"authorized",POST_LOGIN_NEEDED:"\u672c\u5427\u53d1\u8d34\uff0c\u8bf7\u5148 <a href=\"#\" onclick=\"_.Module.use('common/component/LoginDialog', ['', 'editor']);return false;\">\u767b\u5f55</a> | <a href=\"#\" onclick=\"TbCom.process('User','buildRegisterFrame',null,null,null,'editor');return false;\">\u6ce8\u518c</a>&nbsp;",POST_USERNAME_NEEDED:"\u60a8\u8fd8\u6ca1\u6709\u7528\u6237\u540d\uff0c\u4e0d\u80fd\u5728\u672c\u5427\u53d1\u8d34\u3002\u8bf7\u5148<a href=\"#\" onclick=\"TbCom.process('User','buildUnameFrame','\u586b\u5199\u7528\u6237\u540d',' ');return false;\">\u586b\u5199\u7528\u6237\u540d</a>",POST_BLOCKED:'\u62b1\u6b49\uff0c\u4f60\u53ef\u80fd\u5b58\u5728\u8fdd\u89c4\u64cd\u4f5c\uff0c\u5df2\u88ab\u5c01\u7981\u3002\u8bf7<a href="http://tieba.baidu.com/pmc/main?fid=<%=forum.id%>" target="_blank">\u70b9\u51fb\u6b64\u5904</a>\u67e5\u770b\u8be6\u7ec6\u4fe1\u606f\u3002',POST_LEVEL_LIMITED:'\u62b1\u6b49\uff0c\u6839\u636e\u76f8\u5173\u6cd5\u5f8b\u6cd5\u89c4\u548c\u653f\u7b56\uff0c\u672c\u5427\u76ee\u524d\u4ec5\u5141\u8bb8<a href="http://tieba.baidu.com/f/like/level?kw=<%=forum.name%>&ie=utf-8" >4\u7ea7\u5934\u8854</a><br />\u4ee5\u4e0a\u4f1a\u5458\u53d1\u8d34',POST_BAWU_LIMITED:"\u62b1\u6b49\uff0c\u672c\u5427\u76ee\u524d\u4ec5\u9650\u5427\u52a1\u56e2\u961f\u53d1\u8d34",POST_LAW_LIMITED:"\u62b1\u6b49\uff0c\u6839\u636e\u76f8\u5173\u6cd5\u5f8b\u6cd5\u89c4\u548c\u653f\u7b56\uff0c\u672c\u5427\u76ee\u524d\u53ea\u80fd\u6d4f\u89c8\uff0c\u4e0d\u80fd\u53d1\u8d34",POST_QUALIFICATIONS_LIMITED:"\u62b1\u6b49\uff0c\u672c\u5427\u76ee\u524d\u4ec5\u9650\u5427\u52a1\u56e2\u961f\u53ca\u6ce8\u518c\u6ee1\u4e00\u5b9a\u65f6\u95f4\u7684\u8001\u7528\u6237\u53d1\u8d34",POST_THREAD_ONLY:"\u62b1\u6b49\uff0c\u6839\u636e\u76f8\u5173\u6cd5\u5f8b\u6cd5\u89c4\u548c\u653f\u7b56\uff0c\u672c\u5427\u76ee\u524d\u53ea\u80fd\u53d1\u4e3b\u9898\u8d34",POST_REPLY_ONLY:"\u62b1\u6b49\uff0c\u6839\u636e\u76f8\u5173\u6cd5\u5f8b\u6cd5\u89c4\u548c\u653f\u7b56\uff0c\u672c\u5427\u76ee\u524d\u53ea\u80fd\u53d1\u56de\u590d\u8d34",POST_THREAD_LEVEL_LIMITED:"\u62b1\u6b49\uff0c\u6839\u636e\u76f8\u5173\u6cd5\u5f8b\u6cd5\u89c4\u548c\u653f\u7b56\uff0c\u672c\u5427\u76ee\u524d\u4ec5\u5141\u8bb8\u4e00\u5b9a\u7ea7\u522b\u4ee5\u4e0a\u4f1a\u5458\u53d1\u4e3b\u9898\u8d34",POST_REPLY_LEVEL_LIMITED:"\u62b1\u6b49\uff0c\u6839\u636e\u76f8\u5173\u6cd5\u5f8b\u6cd5\u89c4\u548c\u653f\u7b56\uff0c\u672c\u5427\u76ee\u524d\u4ec5\u5141\u8bb8\u4e00\u5b9a\u7ea7\u522b\u4ee5\u4e0a\u4f1a\u5458\u53d1\u56de\u590d\u8d34",POST_PAD_LIMITED:"\u5207\u6362\u6210pad\u7248\u8d34\u5427\uff0c\u7545\u4eab\u66f4\u987a\u7545\u7684\u53d1\u8d34\u4f53\u9a8c\uff01",context:null,authorities:null,loadContext:function(c){this.context=c},loadContextFromPageData:function(d){var e=d.product=="frs";var c=d.product=="pb";this.context={forum:{id:d.forum.id,name:d.forum.name,nameEncoded:d.forum.name_url},user:{id:d.user.id,name:d.user.name,level:d.user.balv.level_id,isFavorForum:e?d.user.balv.is_like:PageData.user.has_grade,isLogin:!!d.user.is_login,isBlocked:!!d.user.is_block,isBlack:!!d.user.balv.is_black,noUsername:!!d.user.no_un,canPost:e?d.user.power.post:PageData.can_post,canVote:e?d.user.power.vote_creater:false,forbidFlag:d.forum.forbid_flag,signNumber:!!d.user.is_login?((d.forum.sign_in_info&&d.forum.sign_in_info.user_info)?d.forum.sign_in_info.user_info.c_sign_num:0):0},product:d.product,floor:0,tbs:d.tbs,isPad:d.is_ipad,page:d.page};if(c){this.context.thread={id:d.thread.id};this.context.floor=d.thread.reply_num}},loadAuthorities:function(c){this.authorities=c},getContext:function(){return this.context},getAuthorities:function(){return this.authorities},isPostAllowed:function(){return this._validatePostAuthority()==this.POST_AUTHORIZED},getPostRejectedMessage:function(){var c=this._validatePostAuthority();if(c!=this.POST_AUTHORIZED){return baidu.template(c,this.context)}else{return null}},_validatePostAuthority:function(){var c=this.context.user;if(!c.isLogin){return this.POST_LOGIN_NEEDED}if(c.noUsername){return this.POST_USERNAME_NEEDED}if(c.isBlocked){return this.POST_BLOCKED}if(!c.canPost){return this.FORBID_FLAG_MAP[c.forbidFlag]}if(this.context.isPad){return this.POST_PAD_LIMITED}return this.POST_AUTHORIZED}};b.FORBID_FLAG_MAP={1:b.POST_LOGIN_NEEDED,2:b.POST_QUALIFICATIONS_LIMITED,3:b.POST_LEVEL_LIMITED,4:b.POST_BAWU_LIMITED,5:b.POST_LAW_LIMITED,7:b.POST_REPLY_ONLY,8:b.POST_THREAD_ONLY,9:b.POST_REPLY_LEVEL_LIMITED,10:b.POST_THREAD_LEVEL_LIMITED};a.PosterContext=b})(window);_.Module.define({path:"common/component/PostService",requires:["PostResultHandlerManager","ucenter/component/LikeTip"],sub:{_defaultData:{ie:"utf-8",kw:"",fid:"",tid:"",vcode_md5:"",floor_num:0,rich_text:1,tbs:0,content:""},posting:false,submitUrl:{thread:"/f/commit/thread/add",reply:"/f/commit/post/add",vpostThread:"/vpost/addthread",vpostReply:"/vpost/addpost"},initial:function(b){var a=this;this.resultHandlerManager=this.use("PostResultHandlerManager");this.bind("retry",function(d,c){a._retryHandler(c)})},isPosting:function(){return this.posting},post:function(e,f,d){var b=this;if(this.posting){return this}this.posting=true;var a=$.extend({},this._defaultData);if(d){$.extend(a,this._extractDataFromContext(d))}$.extend(a,f);a.__type__=e;var c=this.submitUrl[e];$.ajax({type:"post",url:c,data:a,success:function(g){var h=b.resultHandlerManager.getHandler(g.err_code||g.no);h.call(b,g,a)},error:function(){$.tb.alert({title:"\u53d1\u8d34\u5931\u8d25",message:"\u7f51\u901f\u6709\u70b9\u4e0d\u7ed9\u529b\u54e6~\u8bf7\u5c1d\u8bd5\u91cd\u65b0\u63d0\u4ea4\u4e00\u4e0b\u5427\uff01",buttons:[{text:"\u786e\u5b9a",callback:function(){b.trigger("complete")}}]})},complete:function(){b.posting=false},dataType:"json"});return this},_extractDataFromContext:function(a){return{kw:a.forum.name,fid:a.forum.id,tid:a.thread?a.thread.id:0,tbs:a.tbs,floor_num:a.floor}},_retryHandler:function(a){this.post(a.__type__,a)},success:function(a){this.bind("success",a);return this},error:function(a){this.bind("error",a);return this},complete:function(a){this.bind("complete",a);return this},retry:function(a){this._retryHandler=a;return this}}});_.Module.define({path:"common/component/WordLimit",requires:[],sub:{checkTimer:null,isShow:false,exceed:false,initial:function(b){var a={container:$("body"),inputObj:null,checkDelay:50,showLimit:10,maxNum:120,isLimitInput:false,autoPos:true,numStyle:{},limitStyle:{}};var c=$.extend(true,a,b);this.container=$(c.container);this.inputObj=$(c.inputObj);this.showLimit=c.showLimit;this.option=c;this.holder=$('<div class="w_limit_wrapper "></div>');this.container.append(this.holder)},init:function(){var c=this.option,b=this;if(c.inputObj==null){return}var a=$(c.inputObj);a.keydown(function(d){b.handlerEvent(d);return true});a.focus(function(d){b.handlerEvent(d);return true});a.bind("input",function(d){b.handlerEvent(d);return true});a.bind("propertychange",function(d){b.handlerEvent(d);return true})},setLimitStyle:function(a){this.holder.css(a)},hideWordLimit:function(){this.trigger("wlhiding");this.holder.hide();this.isShow=false;clearTimeout(this.checkTimer)},autoPosition:function(){var c=this.inputObj.offset(),b=this.inputObj.width(),a=$(document).width();this.holder.css({top:c.top-this.holder.height()-5,right:a-b-c.left-9})},handlerEvent:function(b){clearTimeout(this.checkTimer);var c=this.option;var a=this;a.blur=false;this.checkTimer=setTimeout(function(){a.check()},c.checkDelay)},check:function(b){var g=this.option;var f=this.inputObj;var e=f.val();var c=$.tb.getByteLength(e);var d=g.maxNum-c;if(g.isLimitInput&&d<0){f.val($.tb.subByte(e,g.maxNum+(d<0&&d>-2?d:0)))}d=g.maxNum-$.tb.getByteLength(f.val());if(d<=this.showLimit){if(g.autoPos){this.autoPosition()}else{this.trigger("onSetPosition")}this.holder.show();this.isShow=true;var a=Math.ceil(d/2);if(d<0){a=Math.floor(d/2);if(!this.exceed){this.trigger("overflow");this.exceed=true}this.trigger("wlshowing");this.holder.html('\u5df2\u7ecf\u8d85\u51fa<span class="w_limit_num" style="color:#f00;">'+-a+"</span>\u4e2a\u5b57")}else{if(this.exceed){this.trigger("unoverflow");this.exceed=false}this.trigger("wlshowing");if(d==0){this.holder.html('\u8fd8\u53ef\u8f93\u5165<span class="w_limit_num" style="color:#ff0000;">'+a+"</span>\u4e2a\u5b57")}else{this.holder.html('\u8fd8\u53ef\u8f93\u5165<span class="w_limit_num" style="color:#929292;">'+a+"</span>\u4e2a\u5b57")}}}else{if(this.isShow){this.trigger("wlhiding");this.holder.hide();this.isShow=false;if(this.exceed){this.trigger("unoverflow");this.exceed=false}}}}}});_.Module.define({path:"ucenter/component/LikeTip",sub:{initial:function(g,b,d){var c=this;if(d&&d.like_no&&(d.like_no>=1)){var a=$.dialog.alert('<img src="'+PageData.staticDomain+'tb/static-frs/img/like_back.png">',{width:320,height:131,acceptValue:"\u77e5\u9053\u4e86"});$(a.element[0]).find(".dialogJcontent").css("padding-bottom","0px");$(a.element[0]).find(".dialogJanswers").css("padding-top","0px");a.bind("onaccept",function(h){c.reloadAndGotop()}).bind("onclose",function(h){c.reloadAndGotop()})}else{var f=this.getTipContent(g,b,d);var e={title:"\u6210\u529f\u63d0\u793a",width:418,modal:!g};var a=$.dialog.open(f,e);if(g){$(a.element[0]).css("padding","2px")}$(a.element[0]).find(".dialogJcontent").tbattr("id","balv_first_like_dialog");$(a.element[0]).find(".userlike_tip_span a").click(function(){Stats.sendRequest("fr=tb0_forum&st_mod=frs&st_type=entryimallinpop")});$(a.element[0]).find(".lvlup_pop_btn").eq(0).bind("click",function(h){c.reloadAndGotop()});a.bind("onclose",function(h){c.reloadAndGotop()})}},getTipContent:function(e,a,b){var d="<span>";if(e){d+=e+"\uff0c"}d+="\u606d\u559c\u4f60\u6210\u4e3a\u672c\u5427\u7b2c</span>";d+="<span class='tip_font_orange'>"+b.index+"</span>";d+="<span>\u4f4d\u4f1a\u5458</span>";var c="";c+='<div class="userlike_tip_join" id="userlike_tip_join">';c+='<div class="userlike_tip_info" id="userlike_tip_info">'+d+"</div>";if(e){c+='<div class="user_rights_msg"><span class="user_rights_msg_gray">\u83b7\u5f97\u5934\u8854&nbsp;</span><img class="user_rights_msg_img" src="/tb/static-frs/img/balv/lv_join.png">&nbsp;'+PageData.user.balv.level_name+'<span class="user_rights_msg_gray">&nbsp;\u5347\u7ea7\u4eab\u7279\u6743\uff0c<span><a class="user_rights_msg_link" target="_blank" href="/f/like/level?kw='+PageData.forum.name_url+'">\u67e5\u770b\u4f1a\u5458\u6743\u5229</a></div>'}else{if(PageData.user.balv.level_id==1){c+='<div class="user_rights_msg">\u83b7\u5f97\u5934\u8854&nbsp;<img class="user_rights_msg_img" src="/tb/static-frs/img/balv/lv_join.png">&nbsp;'+PageData.user.balv.level_name+'\uff0c\u5347\u7ea7\u4eab\u7279\u6743\uff0c<a target="_blank" href="/f/like/level?kw='+PageData.forum.name_url+'">\u67e5\u770b\u5347\u7ea7\u79d8\u7c4d</a></div>'}else{c+='<div class="user_rights_msg">\u6839\u636e\u4f60\u5728\u672c\u5427\u7684\u6d3b\u8dc3\u8868\u73b0\uff0c\u76f4\u63a5\u6388\u4e88<img src="'+PageData.staticDomain+"tb/static-member/img/badges/"+PageData.user.balv.level_id+'.png">&nbsp;'+PageData.user.balv.level_name+"\uff0c\u7ed9\u529b\uff01</div>";c+='<div class="userlike_tip_span">\u672c\u5427\u767e\u5b9d\u7bb1\u5bf9\u4f60\u5f00\u653e\u4e86\uff0c<a target="_blank" href="/imall/mall?kw='+PageData.forum.name_url+'">\u53bb\u767e\u5b9d\u7bb1\u770b\u770b\u6709\u54ea\u4e9b\u7279\u6743\u548c\u5b9d\u8d1d</a></div>'}}c+='<div class="lvlup_tip_btnzone"><input class="lvlup_pop_btn" type="button" value="\u77e5\u9053\u4e86"/>';if(e){c+='<a class="userlike_tip_cancel" target="_blank" href="/home/forum?id='+PageData.user.portrait+"&fr="+PageData.product+'">\u5982\u4f55\u53d6\u6d88\u4f1a\u5458</a>'}c+="</div></div>";return c},reloadAndGotop:function(){$.tb.location.setHref($.tb.location.getHref().split("#")[0])}}});_.Module.define({path:"common/component/MousePwd",requires:[],sub:{initial:function(){this.UTSTART=new Date().getTime();this.MOUSEPWD_CLICK=0;var n={ea:[],ma:[]};var h={};var c=false;var i=(new Date()).getTime();var o={};var j=[];var q=[];function k(u){if(!u){var u=window.event}var t=0;var v=0;if(u.pageX||u.pageY){t=u.pageX;v=u.pageY}else{if(u.clientX||u.clientY){t=u.clientX+document.body.scrollLeft;v=u.clientY+document.body.scrollTop}}return[t,v]}function b(t){return t.offsetParent?(t.offsetLeft+b(t.offsetParent)):t.offsetLeft}function a(t){return t.offsetParent?(t.offsetTop+a(t.offsetParent)):t.offsetTop}function p(t){if(t.preventDefault){t.preventDefault()}else{window.event.returnValue=false}}function s(A){A.stopPropagation();var v=k(A);var x=n[this.id];if(x){if(!x.hover){x.hover=true;x.count++}}else{var w=b(this);var y=a(this);var z=w+this.offsetWidth;var u=y+this.offsetHeight;x=n[this.id]={hover:true,count:1,left:w,top:y,right:z,buttom:u}}if(!x["mouse"+x.count]){x["mouse"+x.count]=[];x["time"+x.count]={start:(new Date()).getTime()};n.ma.push(x["mouse"+x.count])}x["mouse"+x.count].push(v);q.push("1")}function r(v){v.stopPropagation();var t=k(v);var u=n[this.className];if(u&&u.hover){if(t[0]&&t[0]>u.left&&t[0]<u.right&&t[1]&&t[1]>u.top&&t[1]<u.buttom){return}u["time"+u.count].end=(new Date()).getTime();u.hover=false}q.push("0")}function e(){var t=n.ma.length;if(t>0){var u=n.ma[t-1];return u[u.length-1]}}function f(){var u="";var t=q.length;if(t>10){q=q.slice(t-10)}u=q.join(",");return u}function l(){if(c){return h}var t=[e(),f(),(new Date()).getTime()-this.UTSTART,[screen.width,screen.height].join(",")].join("\t");h.c=d(t)+","+i+""+this.MOUSEPWD_CLICK;c=true;return h}function d(y){var t=[];var w={};var x=i%100;for(var v=0,u=y.length;v<u;v++){var z=y.charCodeAt(v)^x;t.push(z);if(!w[z]){w[z]=[]}w[z].push(v)}return t}function g(){return this.className}function m(t){this.elements=t;$.each(t,function(u,v){$("."+v.toString()).bind("mouseover",s);$("."+v.toString()).bind("mouseout",r);o[v.toString()]=u});$("body").bind("click",function(){this.MOUSEPWD_CLICK=1})}this.start=m;this.report=l;this.time=i}}});_.Module.define({path:"common/component/PostSignature",requires:[],sub:{_template:['<option value="#{id}" #{isSelected}>#{name}</option>'].join(""),url:"/f/user/sign_list?t="+(+new Date()),hasRequested:false,isUsed:0,data:null,initial:function(b){var a=this;this.$root=b.$container},init:function(){var a=this;if(!this.hasRequested){this.hasRequested=true;if(this.data==null){this.requestSignature()}}this.$root.on("click",".j_use_signature",function(){a.isUsed=this.checked?1:0;a.toggleList();$.post("/f/user/cm/sign_setneed",{need:a.isUsed,tbs:PosterContext.getContext().tbs})})},requestSignature:function(){var a=this;$.get(this.url,function(b){b=$.json.decode(b);if(b&&b.no==0){a.data=b.data;a.isUsed=a.data.need;a.$root.find(".j_use_signature").tbattr("checked",a.isUsed==1);a.buildList(b.data);a.toggleList()}})},toggleList:function(){var a=this.$root.find(".j_signature_wrapper");if(this.isUsed==1){a.show()}else{a.hide()}},buildList:function(f){var c=this.$root.find(".j_signature_wrapper");var b=c.find("select");var e="";if(f&&f.signs.length>0){for(var d=0,a=f.signs.length;d<a;d++){e+=$.tb.format(this._template,{id:f.signs[d].id,isSelected:f.signs[d].id==f.used_id?"selected=selecte":"",name:f.signs[d].name})}b.html(e)}else{c.empty();c.html('\uff08\u60a8\u76ee\u524d\u6ca1\u6709\u53ef\u4f7f\u7528\u7684\u7b7e\u540d\u6863\uff0c&nbsp;<a style="color:#0449BE" target="_blank" href="/i/sys/jump?type=signsetting">\u67e5\u770b\u5168\u90e8</a>\uff09')}}}});_.Module.define({path:"common/component/PostPrefix",requires:[],sub:{initial:function(a){this.$target=a.$target;this.prefix=a.prefix;this.$target.val(this.prefix.value);this.$target.data("prefix",this.prefix.value);if(this.prefix.need_sug){this.pickPrefix(this.$target,this.prefix.sug_html)}},pickPrefix:function(b,c){var g=$('<a class="pprefix-list"></a>'),h,i=-1;function d(){g.css({width:b.outerWidth()+"px",left:b.offset().left+"px",top:(b.offset().top+b.outerHeight()-1)+"px"}).show()}function a(){i=-1;h.removeClass("pprefix-item-shine");g.hide()}function f(k){var l=b.val(),j,m=b.data("prefix");if(m&&l.indexOf(m)>-1){j=l.replace(m,k)}else{j=k}b.val(j).data("prefix",k);setTimeout(function(){b.trigger("focus")},100)}function e(j,k){if(j=="up"){i-1<0?i=h.length-1:i--}else{if(j=="down"){i+1==h.length?i=0:i++}else{if(j=="mouse"){i=k}}}if(!g.is(":visible")){d();i=0}h.removeClass("pprefix-item-shine").eq(i).addClass("pprefix-item-shine")}g.css({display:"none","box-sizing":"border-box"}).html(c).appendTo("body");h=g.children();b.on("click.showPPrefix",d).on("blur.hidePPrefix",a).on("keydown",function(j){switch(j.keyCode){case 8:d();break;case 40:j.preventDefault();e("down");break;case 38:j.preventDefault();e("up");break;case 13:j.preventDefault();if(i!=-1){f($(".pprefix-item-shine").html());a()}break;case 27:if(g.is(":visible")){j.preventDefault();a()}default:i=-1;a()}});g.on("mousedown.pick",".pprefix-item",function(j){f($(this).html())}).on("mouseover",".pprefix-item",function(j){e("mouse",$(this).index())})}}});_.Module.define({path:"common/widget/RichPoster",requires:["common/component/PostService","common/component/WordLimit","common/component/PostPrefix","common/component/PostSignature","common/component/MousePwd"],sub:{initial:function(b){var c=$("#tb_rich_poster_container").hide();this.$root=$($("#rich_ueditor_tpl").html());this.$editorContainer=this.$root.find(".ueditor_container");this.prefix=b.prefix;c.append(this.$root);this.isFrs=PosterContext.getContext().product==="frs";this.isPb=PosterContext.getContext().product==="pb";this.initPostService();if(this.isFrs){this.$title=this.$root.find(".j_title");this.initTitle()}var a=PosterContext.getContext().page;if(a==="star"||(this.isPb&&a!=="pb_bright")){this.$root.addClass("compat_rich_poster")}this.initDraft();this.initEditor();this.initAntiSpamming();this.initEvent();this.initPlaceholder();this.initMousePwd();this.initSignature();this.is1111=PageUnit.load("rich_poster_is_1111");if(this.is1111==1){if(PosterContext.isPostAllowed()){this.$placeholder.addClass("tb_poster_placeholder_double11").html('<p>\u5199\u4e0b\u4f60\u53cc\u5341\u4e00\u60f3\u8981\u7684\u5546\u54c1\u540d\u79f0\u3001\u56fe\u7247\u3001\u94fe\u63a5\uff0c<br/>\u914d\u4e0a\u6709\u8da3\u7684\u7f51\u8d2d\u7ecf\u5386\uff0c\u5c31\u6709\u53ef\u80fd\u83b7\u5f97\u4e07\u5143\u5927\u5956\uff01<br/><a href="http://1111.baidu.com/#joy" style="color:#2D64B3; text-decoration:underline;" target="_blank">\u67e5\u770b\u6d3b\u52a8\u8be6\u60c5</a></p>')}if(this.isPb){$('img[gcf_mall_link="1"]').next("a").click(function(d){$.stats.sendRequest("fr=tb0_forum&st_mod=pb&st_type=double11_link&st_value="+encodeURIComponent($(this).text()))})}}c.show();if(!PosterContext.isPostAllowed()){if(!($.browser.msie&&$.browser.version==6)){this.editor.ready(function(){this.disable()})}this.showWarning(PosterContext.getPostRejectedMessage(true));this.toggleSubmitButton(true);if(this.$title){this.$title.tbprop("disabled",true)}}else{if(this.isFrs){_.Module.use("common/component/Placeholder",[this.$title,"\u8bf7\u586b\u5199\u6807\u9898",{color:"#bfbfbf"}])}this.editor.ready(function(){this.restoreDraft()})}PageUnit.load("rich_poster_show_music_recommend")},initPostService:function(){var a=this;this.postService=this.use("common/component/PostService");this.postService.success(function(){a.editor.setContent("");a.editor.clearDraft();a.showPostSuccess();setTimeout(function(){a.refresh()},500)}).complete(function(){a.togglePostState(false)})},initEvent:function(){var a=this;this.$submit=this.$root.find(".j_submit").click(function(b){b.preventDefault();if(!a.$submit.is(".ui_btn_disable")){a.post()}});this.$root.on("keyup",function(b){if(b.ctrlKey&&b.keyCode==13){a.post()}});this.$root.find(".add_vote_btn").click(function(){if(!PosterContext.getContext().user.canVote){var b=PosterContext.getContext().forum.nameEncoded;$.tb.alert({title:"\u53d1\u8d77\u6295\u7968",message:'\u83b7\u5f97<a target="_blank" href="/f/like/level?kw='+b+'">3\u7ea7\u5934\u8854</a>\u624d\u53ef\u53d1\u8d77\u6295\u7968\u54e6~~<br />\u7533\u8bf7\u52a0\u5165\u4f1a\u5458\uff0c\u9a6c\u4e0a\u53d1\u8d77\u6295\u7968\uff01\uff08\u66f4\u591a\u4f1a\u5458\u7279\u6743<a target="_blank" href="/f/like/level?kw= '+b+'">\u70b9\u6b64\u67e5\u770b</a>',buttons:{text:"\u786e\u5b9a"}});return false}});this.observe("insertimage",function(b,c){a.editor.execCommand("insertimage",[c])});this.observe("file_added.attachment",function(){a.togglePostState(true)});this.observe("upload_complete.attachment",function(){a.togglePostState(false)});this.observe("wanner_post",function(){a.focus()})},initTitle:function(){this.initTitleWordLimit();this.initTitlePrefix()},initTitleWordLimit:function(){var c=$("#tb_rich_poster");var a={inputObj:this.$title,checkDelay:200,showLimit:10,maxNum:60,isLimitInput:true};var b=this.use("common/component/WordLimit",a);b.init();b.bind("wlshowing",function(){c.find(".j_surveillance").hide()});b.bind("wlhiding",function(){c.find(".j_surveillance").show()})},initTitlePrefix:function(){var a={$target:this.$title,prefix:this.prefix};this.use("common/component/PostPrefix",a)},initEditor:function(){if(PosterContext.isPostAllowed()){this.editor=UE.getEditor("ueditor_replace",{topOffset:this.isFrs?40:0})}else{this.editor=UE.getEditor("ueditor_replace",{toolbar:""})}window.test_editor=this.editor;window.test_poster=this},initDraft:function(){var a=this;var d=this.$root.find(".j_draft");var b=d.children(".j_content");var c=d.children(".j_clear");this.$root.on("saved.draft",function(){b.text("\u4f60\u6b63\u5728\u8f93\u5165\u7684\u5185\u5bb9\u5df2\u81ea\u52a8\u4fdd\u5b58, "+$.dateFormat(new Date(),"HH:mm:ss"));d.show()});this.$root.on("restored.draft",function(){b.text("\u4f60\u4e0a\u6b21\u672a\u53d1\u8868\u7684\u5185\u5bb9\u5df2\u81ea\u52a8\u6062\u590d");d.show()});c.on("click",function(){a.editor.clearDraft();a.editor.setContent("");d.hide()})},initPlaceholder:function(){var a=this;this.$placeholder=$('<div class="tb_poster_placeholder"></div>');this.$placeholder.click(function(b){if(!$(b.target).is("a")){a.$placeholder.hide();a.editor.focus()}});this.editor.ready(function(){a.$placeholder.prependTo(a.$root.find(".edui-container"));a.editor.addListener("focus",function(){a.$placeholder.hide()});a.editor.addListener("blur",function(){a._showPlaceHolder()});a._showPlaceHolder()});this.$root.on("restored.draft",function(){a.$placeholder.hide()});this.$placeholder.html('\u5ba2\u6237\u7aef\u53d1\u8d34\u7ecf\u9a8c<span style="color:#CF2525; font-size:30px;font-weight:bold">3\u500d</span>\u5927\u56de\u9988\uff0c<a href="http://c.tieba.baidu.com/c/s/download/pc?src=webfatie" style="color:#2D64B3; text-decoration:underline;" target="_blank">\u72c2\u62fd\u70ab\u9177\u5c4c\u70b8\u5929\u6709\u6728\u6709</a>')},_showPlaceHolder:function(){var a=this.editor.getContent();if(a.length==0){this.$placeholder.show()}},initMousePwd:function(){this.MousePwd=this.use("common/component/MousePwd");this.MousePwd.start(["editor_content_wrapper"])},initSignature:function(){var a=this;var b=this.$root.find(".j_poster_signature");b.hide();if(PosterContext.getContext().user.isLogin){this.$root.find("#ueditor_replace").one("click",function(){var c=a.use("common/component/PostSignature",{$container:b});c.init();b.show()})}},initAntiSpamming:function(){var b=$.cookie("GET_TOPIC");if(PosterContext.getContext().user.isLogin){if(!(b&&b==PosterContext.getContext().user.id)){$("body").append('<div id="anttongji" style="display:none"></div>');var a=$(document.createElement("script"));var c="http://tongji.tieba.baidu.com/common/js/gettopic.js";a.tbattr({src:c,type:"text/javascript"});$("body").append(a);$.cookie("GET_TOPIC",PosterContext.getContext().user.id,{expires:0.5,path:"/"})}}},showPostSuccess:function(){$('<div class="tb_poster_info poster_success"><strong>\u53d1\u8868\u6210\u529f\uff01</strong><br/>\u4eb2~\u4e0b\u6b21\u8bb0\u5f97\u7528\u5ba2\u6237\u7aef\u53d1\u8d34\uff0c\u6709<span style="color:#CF2525; font-size:16px; font-weight: bold;">3\u500d</span>\u7ecf\u9a8c\u5462\uff01</div>').appendTo(this.$editorContainer)},showWarning:function(a){if(this.$warning==undefined){this.$warning=$('<div class="tb_poster_info poster_warning"></div>').appendTo(this.$editorContainer)}this.$warning.html(a)},getTitle:function(){return this.$title?this.$title.val():""},getContent:function(){return this.editor.getContent()},getPostType:function(){var a=this.isFrs?"thread":"reply";if(this.editor.getExtendContent().hasLocalVideo){a=(a=="thread")?"vpostThread":"vpostReply"}return a},getPostData:function(){var b=this.editor.getExtendContent();var a={content:this.getContent()};if(this.isFrs){var f=this.getTitle();var e=this.$title.data("prefix");if(f.indexOf(e)==-1){e=""}f=f.replace(/\u2006/g,"");f=f.replace(e,"");a.title=f;a.prefix=e}if(b.videoNumber>0){a.video_url=b.videoUrl;if(b.hasLocalVideo){a.file_id=b.fileId}}if(b.attachments){a.files=b.attachments}var d=this.$root.find(".j_sign_id");var c=this.$root.find(".j_use_signature");if(c.tbattr("checked")&&d.size()>0&&d.val()){a.sign_id=d.val()}a.mouse_pwd=this.MousePwd.report()["c"];a.mouse_pwd_t=this.MousePwd.time;a.mouse_pwd_isclick=this.MousePwd.MOUSEPWD_CLICK;return a},togglePostState:function(b){var a=this.$root.find(".j_posting_status");a.toggleClass("poster_posting_status_loading",b);this.toggleSubmitButton(b)},toggleSubmitButton:function(a){this.$submit.toggleClass("ui_btn ui_btn_m",!a);this.$submit.toggleClass("ui_btn_disable ui_btn_m_disable",a)},validateContent:function(){var d=this.isFrs?30000:10000;var c=this.editor.getContentByteLength();var b=this.editor.getExtendContent();var g=this.$root.find(".ueditor_container .j_error");if(this.isFrs){var f=$.trim(this.getTitle());var e=this.$title.data("prefix");if(f.length===0){this.$root.find(".title_container .j_error").text("\u6807\u9898\u4e0d\u80fd\u4e3a\u7a7a").show();this.$title.focus();$(window).scrollTop(this.$title.offset().top-60);return false}else{if(f.replace(e,"").length===0){this.$root.find(".title_container .j_error").text("\u53ea\u6709\u524d\u7f00\u662f\u4e0d\u884c\u7684\u54df~\u8bf7\u5728\u524d\u7f00\u540e\u586b\u5199\u6b63\u5f0f\u6807\u9898\uff01").show();this.$title.focus();$(window).scrollTop(this.$title.offset().top-60);return false}}}if(c===0&&!this.isFrs){g.text("\u56de\u590d\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a").show();return false}if(c>d){var a="\u62b1\u6b49\uff0c\u60a8\u7684\u8d34\u5b50\u8d85\u8fc7"+d/2+"\u5b57\uff0c\u5efa\u8bae\u60a8\u7cbe\u7b80\u6216\u5206\u6bb5\u540e\u518d\u63d0\u4ea4";g.text(a).show();return false}if(b.videoNumber>1){var a="\u62b1\u6b49\uff0c\u6bcf\u5c42\u697c\u63d2\u5165\u7684\u89c6\u9891\u4e2a\u6570\u4e0d\u80fd\u8d85\u8fc71\u4e2a\uff0c\u8bf7\u4fee\u6539\u540e\u91cd\u65b0\u63d0\u4ea4";g.text(a).show();return false}if(b.musicNumber>10){var a="\u62b1\u6b49\uff0c\u6bcf\u5c42\u697c\u63d2\u5165\u7684\u97f3\u4e50\u4e2a\u6570\u4e0d\u80fd\u8d85\u8fc710\u4e2a\uff0c\u8bf7\u4fee\u6539\u540e\u91cd\u65b0\u63d0\u4ea4";g.text(a).show();return false}this.$root.find(".j_error").hide();return true},post:function(){var a=this.validateContent();if(!this.postService.isPosting()&&a){$.cookie("GET_TOPIC","-",{expires:-1,path:"/"});this.postService.post(this.getPostType(),this.getPostData(),PosterContext.getContext());this.togglePostState(true)}},refresh:function(){var a=$.tb.location.getHref();a=a.replace(/#\w*$/,"");$.tb.location.setHref(a)},focus:function(){if(this.isFrs){this.$title.focus()}else{if(!($.browser.msie&&$.browser.version<=7)){this.editor.focus()}}}}});(function(){window.TED=window.TED||{};window.TED["extend"]=h;window.TED["EventDispatcher"]=f;function h(n,o,j){function l(){}l.prototype=o.prototype;var m=new l();m.constructor=n;n.superclass=o;for(var k in j){m[k]=j[k]}n.prototype=m}function f(){this._events={}}f.prototype={on:function(k,l,j,i){j=j||this;this._events[k]=this._events[k]||[];this._events[k].push({listener:l,scope:j,args:i})},fireEvent:function(p,o,l){var q,n,k,m=this._events[p];if(!m){return false}else{for(n=0,k=m.length;n<k;n++){q=m[n];o=q.scope;l=l||q.args||[];q.listener.apply(o,l)}}},remove:function(n,o){if(!this._events[n]){return false}var m=this._events[n],l,k;for(l=0,k=m.length;l<k;l++){if(m[l].listener===o){m.splice(l,1);break}}if(m.length===0){delete this._events[n]}}};var b={addEvent:function(j,i,k){var l;if(j.addEventListener){l=function(n,m,o){n.addEventListener(m,o,false)}}else{l=function(n,m,o){n.attachEvent("on"+m,o)}}l(j,i,k);this.addEvent=l},removeEvent:function(k,j,l){var i;if(k.addEventListener){i=function(n,m,o){n.removeEventListener(m,linstener,false)}}else{i=function(n,m,o){n.detachEvent("on"+m,o)}}i(k,j,l);this.addEvent=i}};window.TED["Event"]=b;window.TED["HoverOverlay"]=d;function d(i){d.superclass.call(this);this.timer=null;this.container=i;this.holder=document.createElement("div");this.holder.className="tb-editor-overlay";this.holder.style.display="none";var j=this;b.addEvent(this.holder,"mouseover",function(){j.mouseover()});b.addEvent(this.holder,"mouseout",function(){j.mouseout()});this.content=document.createElement("div");this.content.className="overlay-content";this.arrow=document.createElement("span");this.arrow.className="arrow";this.holder.appendChild(this.arrow);this.holder.appendChild(this.content);this.container.appendChild(this.holder)}h(d,f,{container:null,holder:null,content:null,currentOpen:null,isOpen:false,closefunction:null,open:function(o,n,m,i,p,j,l){this.isOpen=true;this.currentOpen=l;this.arrow.style.left=p;var k=this.holder.style;k.left=o;k.top=n;k.width=m;k.height=i;k.display="block";this.content.innerHTML='<iframe width="100%" height="100%" frameborder="0" scrolling="no" src="'+j+'"></iframe>'},close:function(){this.isOpen=false;this.content.innerHTML="";this.holder.style.display="none";if(this.currentOpen){this.currentOpen.className=this.currentOpen.className.replace(" open","");this.currentOpen=null}this.fireEvent("close")},mouseover:function(){this.closefunction=this.close;this.close=function(){};if(this.timer!=null){clearTimeout(this.timer)}},mouseout:function(){var i=this;i.close=i.closefunction;i.timer=setTimeout(function(){i.close()},500)}});window.TED["Overlay"]=a;function a(i){a.superclass.call(this);this.container=i;this.holder=document.createElement("div");this.holder.className="tb-editor-overlay";this.holder.style.display="none";this.closeBtn=document.createElement("span");this.closeBtn.className="close";var j=this;b.addEvent(this.closeBtn,"click",function(){j.close()});this.content=document.createElement("div");this.content.className="overlay-content";this.arrow=document.createElement("span");this.arrow.className="arrow";this.holder.appendChild(this.closeBtn);this.holder.appendChild(this.arrow);this.holder.appendChild(this.content);this.container.appendChild(this.holder)}h(a,f,{closeButton:null,container:null,holder:null,content:null,currentOpen:null,isOpen:false,open:function(l,p,k,q,m,j){if(this.isOpen==true&&TED.Editor&&TED.Editor.Status.isPicassoOpen===true){var n=this;var o=$.dialog.confirm('<div id="maincontent" style="position:absolute;"><img style="margin:10px 10px 10px 10px;width:68px;height:68px;" src="http://static.tieba.baidu.com/tb/editor/v2/picasso/alarm.gif" /><div id="tipscontent" style="position:absolute;left:100px;top:15px;width:270px;font-size:14px;font-family:\u5b8b\u4f53" ><b>\u60a8\u6b63\u5728\u7f16\u8f91\u6d82\u9e26\uff0c\u73b0\u5728\u9000\u51fa\u5c06\u4e0d\u4f1a\u4fdd\u5b58\uff0c\u60a8\u786e\u5b9a\u8981\u9000\u51fa\uff1f</b></div></div>',{title:"\u6d82\u9e26\u7f16\u8f91\u5668",acceptValue:"\u786e\u5b9a",cancelValue:"\u53d6\u6d88"});o.width(420);o.height(90);o.bind("onaccept",function(){TED.Editor.Status.isPicassoOpen=false;if(n.picassoPanel){n.picassoPanel.destroy();n.picassoPanel=null}n.isOpen=true;n.arrow.style.left=m;var r=n.holder.style;r.left=l;r.top=p;r.width=k;r.height=q;r.display="block";n.content.innerHTML='<iframe width="100%" height="100%" frameborder="0" scrolling="no" src="'+j+'"></iframe>'})}else{this.isOpen=true;this.arrow.style.left=m;var i=this.holder.style;i.left=l;i.top=p;i.width=k;i.height=q;i.display="block";this.content.innerHTML='<iframe width="100%" height="100%" frameborder="0" scrolling="no" src="'+j+'"></iframe>'}this.fireEvent("open")},close:function(j){if(TED.Editor&&TED.Editor.Status.isPicassoOpen===true&&j!==true){var k=this;var i=$.dialog.confirm('<div id="maincontent" style="position:absolute;"><img style="margin:10px 10px 10px 10px;width:68px;height:68px;" src="http://static.tieba.baidu.com/tb/editor/v2/picasso/alarm.gif" /><div id="tipscontent" style="position:absolute;left:100px;top:15px;width:270px;font-size:14px;font-family:\u5b8b\u4f53"><b>\u60a8\u6b63\u5728\u7f16\u8f91\u6d82\u9e26\uff0c\u73b0\u5728\u9000\u51fa\u5c06\u4e0d\u4f1a\u4fdd\u5b58\uff0c\u60a8\u786e\u5b9a\u8981\u9000\u51fa\uff1f</b></div></div>',{title:"\u6d82\u9e26\u7f16\u8f91\u5668",acceptValue:"\u786e\u5b9a",cancelValue:"\u53d6\u6d88"});i.width(420);i.height(90);i.bind("onaccept",function(){TED.Editor.Status.isPicassoOpen=false;if(k.picassoPanel){k.picassoPanel.destroy();k.picassoPanel=null}k.isOpen=false;k.content.innerHTML="";k.holder.style.display="none";if(k.currentOpen){k.currentOpen.className=k.currentOpen.className.replace(" open","");k.currentOpen=null}k.fireEvent("close")})}else{if(j==true){TED.Editor&&(TED.Editor.Status.isPicassoOpen=false)}this.isOpen=false;this.content.innerHTML="";this.holder.style.display="none";if(this.currentOpen){this.currentOpen.className=this.currentOpen.className.replace(" open","");this.currentOpen=null}this.fireEvent("close")}},toggle:function(n,m,l,i,o,j,k){if(this.currentOpen&&this.currentOpen===k){this.close()}else{k.className=k.className+" open";this.currentOpen=k;this.open(n,m,l,i,o,j)}}});window.TED["augmentObject"]=c;function c(k,j){for(var i in j){if(j.hasOwnProperty(i)){k[i]=k[i]!==undefined?k[i]:j[i]}}}var e={get:function(j,l,i){var k=this.getXHR();k.open("GET",j,true);k.setRequestHeader("cache",false);k.onreadystatechange=function(){if(k.readyState!==4){return}if(k.status==200){if(typeof l==="function"){l(k.responseText)}}else{if(typeof i==="function"){i(k.statusText)}}k=null};k.send(null)},getXHR:(function(){if(window.XMLHttpRequest){return function(){return new window.XMLHttpRequest()}}else{if(window.ActiveXObject){return function(){return new window.ActiveXObject("Microsoft.XMLHTTP")}}else{throw"\u60a8\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301AJAX!"}}})()};window.TED["SimpleAjax"]=e;var g=(function(){var k="tieba";function o(p){return p.replace(/[_\s]/g,function(q){return q=="_"?"__":"_s"})}function l(){return document.getElementById(k+"-storage")}function n(p){return{}.toString.call(p)==="[object Date]"&&p.toString()!=="Invalid Date"&&!isNaN(p)}function j(){var p;if(window.localStorage){p=m()}else{if(window.ActiveXObject){p=i()}}return p}function i(){var p=document.createElement("div");p.style.display="none";p.id=k+"-storage";document.body.appendChild(p);l().addBehavior("#default#userData");return{set:function(r,t,q){var s=l(),w=o(r),v=q&&q.expires?q.expires:new Date().getTime()+365*24*60*60*1000;n(v)&&(v=v.getTime());s.expires=new Date(v).toUTCString();try{s.setAttribute(w,t);s.save(w)}catch(u){throw"baidu.data.storage.set error! Maybe space overflow."}s=null},get:function(q){var r=l(),u=o(q),t=null;try{r.load(u);t=r.getAttribute(u);return t}catch(s){throw s.message}},del:function(q){var r=l(),u=o(q),t;try{r.load(u);t=r.getAttribute(u);if(t){r.removeAttribute(u);r.expires=new Date(315532799000).toUTCString();r.save(u);return true}else{return false}}catch(s){return false}}}}function m(){return{set:function(q,r,p){var v=window.localStorage,u=o(q),t=p&&p.expires?p.expires:0;n(t)&&(t=t.getTime());try{v.setItem(u,t+"|"+r)}catch(s){throw"baidu.data.storage.set error! Maybe space overflow."}},get:function(q){var v=window.localStorage,u=o(q),t=null,p,s;try{t=v.getItem(u)}catch(r){return null}if(t){p=t.indexOf("|");s=parseInt(t.substring(0,p),10);if(new Date(s).getTime()>new Date().getTime()||s==0){t=t.substring(p+1,t.length);return t}else{t=null;this.del(q);return null}}else{return null}},del:function(p){var t=window.localStorage,s=o(p),r=null;try{r=t.getItem(s)}catch(q){return false}if(r){r=r.substring(r.indexOf("|")+1,r.length);r&&t.removeItem(s);return true}else{return false}}}}return{set:function(q,s,t,p){var r=this;!r._storage&&(r._storage=j());r._storage.set.apply(r._storage,arguments)},get:function(p){var q=this;!q._storage&&(q._storage=j());return q._storage.get.apply(q._storage,arguments)},remove:function(p,r){var q=this;!q._storage&&(q._storage=j());return q._storage.del.apply(q._storage,arguments)},isSupport:function(){return !!(window.localStorage||window.ActiveXObject)}}})();window.TED["Storage"]=g})();;(function(){var extend=TED.extend,EventDispatcher=TED.EventDispatcher,Event=TED.Event,Overlay=TED.Overlay,augmentObject=TED.augmentObject,Ajax=TED.SimpleAjax,Storage=TED.Storage;window.TED["EditorPlugins"]=window.TED["EditorPlugins"]||{};window.TED["EditorPlugins"]["Refer"]=Refer;function Refer(attrs){attrs=attrs||{};augmentObject(attrs,this.constructor.defaultConfig);this.config=attrs}Refer.defaultConfig={checkDelay:100,offsetLeft:1,offsetTop:18,dataUrl:"/at-sug",uid:null};Refer.prototype={constructor:Refer,disabled:false,boxWrapper:null,init:function(editor){editor.on("keydown",this.onEditorKeydown,this);editor.on("keyup",this.onEditorKeyup,this);editor.on("click",this.onEditorClick,this);editor.on("blur",function(){this.hide()},this);this.box=new Box(editor.editAreaWrapper);this.box.on("select",this.onSelect,this);this.data=new Data(this.config.dataUrl,this.config.uid);this.data.on("datachange",this.box.update,this.box);this.editor=editor},destroy:function(){},enable:function(){this.disabled=false},disable:function(){this.disabled=true},query:function(key){this.data.getData(key)},onSelect:function(value){var el=this.editor.getSelectedElement();if(value!==null){el.innerHTML="@"+value}this.breakMode(32)},onEditorKeydown:function(e){if(this.disabled){return}if(this.box.isShow){switch(e.keyCode){case 38:this.box.pre();break;case 40:this.box.next();break;case 13:this.onSelect(this.box.getValue());this.box.hide();break;default:return}if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}e.exitFunction=true}},onEditorKeyup:function(e){if(this.disabled){return}var code=e.keyCode;if((code===50&&e.shiftKey)||(code===50&&this.lastUpCode===16)){this.checkEnterMode()}var that=this;clearTimeout(this.timer);this.timer=setTimeout(function(){that.checkShowBox()},this.config.checkDelay);this.lastUpCode=e.keyCode},onEditorClick:function(){var that=this;clearTimeout(this.timer);this.timer=setTimeout(function(){that.checkShowBox()},this.config.checkDelay)},checkEnterMode:function(){var that=this.editor;var s=that.getSelection(),r,c;if(that.ua.ie?s.type.toLowerCase()!=="none":!s.isCollapsed){return}r=that.getRange();if(that.ua.ie){if(this.editor.isEmpty()){return}r.moveStart("character",-1);r.select();c=r.text}else{var con=r.startContainer,offset=r.startOffset;if(con.nodeType===1&&offset>0){con=con.childNodes[offset-1];offset=con.length}if(con.nodeType===3&&offset>0){r.setStart(con,offset-1);s.removeAllRanges();s.addRange(r);c=s.toString()}}var el=that.getSelectedElement();if(c==="@"&&(el.className!=="at"||el.innerHTML!=="@")){that.execCommand("inserthtml",'<span class="at">@</span>')}else{if(that.ua.ie){r.collapse(false);r.select()}else{s.collapseToEnd()}}},checkShowBox:function(){var el=this.editor.getSelectedElement(),value=el.innerHTML,key;if(el.className==="at"&&value.charAt(0)==="@"){key=value.substring(1).replace(/<br.*>$/i,"");if(key.search(/[^\w\u4E00-\u9FA5]/)===-1){this.show(el.offsetLeft+this.config.offsetLeft-this.editor.editArea.scrollLeft,el.offsetTop+this.config.offsetTop-this.editor.editArea.scrollTop);this.query(key)}else{this.hide()}}else{this.hide()}},hide:function(){this.box.hide();this.data.getting=null},show:function(x,y){this.box.show(x,y)},breakMode:function(charcode){var that=this.editor,el=that.getSelectedElement(),node,r;if(charcode===32){node=document.createElement("span");node.innerHTML="&nbsp;";node=node.firstChild}else{node=document.createTextNode(String.fromCharCode(charcode))}if(el.nextSibling){el.parentNode.insertBefore(node,el.nextSibling)}else{el.parentNode.appendChild(node)}if(that.ua.ie){r=document.selection.createRange();r.moveEnd("character",1);r.collapse(false);r.select()}else{s=window.getSelection();r=document.createRange();r.selectNode(node);s.removeAllRanges();s.addRange(r);s.collapseToEnd()}}};function Box(container){Box.superclass.call(this);this.container=container;this.holder=document.createElement("div");this.holder.innerHTML='<span class="box-title">\u60f3\u7528@\u63d0\u5230\u8c01\uff1f<span>';this.holder.className="box-holder";this.holder.style.display="none";this.ul=document.createElement("ul");this.ul.className="box-ul-empty";this.holder.appendChild(this.ul);container.appendChild(this.holder);this.initEvents()}extend(Box,EventDispatcher,{isShow:false,index:null,length:0,initEvents:function(){var that=this;this.bindClick=function(){that.onClick.apply(that,arguments)};this.bindMousedown=function(){that.onMousedown.apply(that,arguments)};Event.addEvent(this.ul,"click",this.bindClick);Event.addEvent(this.ul,"mousedown",this.bindMousedown)},onMousedown:function(e){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}},onClick:function(e){var target=e.target||e.srcElement;if(target.tagName.toLowerCase()==="li"){this.fireEvent("select",null,[target.innerHTML]);this.hide()}},update:function(data){if(!this.isShow){return}if(data.length===0){this.ul.innerHTML="";this.ul.className="box-ul-empty"}else{this.ul.className="";this.ul.innerHTML='<li unselectable="on">'+data.join('</li><li unselectable="on">')+"</li>"}this.length=data.length},pre:function(){if(this.length===0){return}if(this.index===null){this.select(this.length-1)}else{this.select(this.index===0?this.length-1:this.index-1)}},next:function(){if(this.length===0){return}if(this.index===null){this.select(0)}else{this.select(this.index===this.length-1?0:this.index+1)}},select:function(index){if(this.index!==null){this.ul.childNodes[this.index].className=""}this.ul.childNodes[index].className="focus";this.index=index},getValue:function(){return this.index!==null?this.ul.childNodes[this.index].innerHTML:null},show:function(x,y){if(this.isShow){if(x===this.x&&y===this.y){return}else{this.reset()}}else{this.holder.style.display="block";this.isShow=true}this.holder.style.left=x+"px";this.holder.style.top=y+"px";this.x=x;this.y=y},hide:function(){if(!this.isShow){return}this.reset();this.holder.style.display="none";this.isShow=false},reset:function(){this.ul.innerHTML="";this.length=0;this.ul.className="box-ul-empty"}});function Data(url,uid){Data.superclass.call(this);this.url=url;this.uid=uid}extend(Data,EventDispatcher,{dataCache:{},queryCache:{},data:null,getData:function(key){if(this.getting===key){return}this.getting=key;if(key===""){this.setData([],true);return}if(this.dataCache[key]){this.setData(this.dataCache[key],true);return}if(this.queryCache[key]){return}this.queryCache[key]=true;var that=this;Ajax.get(this.url+"?query="+encodeURIComponent(key)+"&uid="+this.uid+"&ie=utf-8",function(data){delete that.queryCache[key];data=that.parseData(data);that.dataCache[key]=data;that.setData(data,key===that.getting)},function(error){delete that.queryCache[key];that.fireEvent("error",[error])})},setData:function(value,need){this.data=value;if(need){this.fireEvent("datachange",null,[value])}},parseData:function(data){try{data=eval("("+data+")");if(data.error===0){return data.msg}else{throw new Error("\u670d\u52a1\u5668\u8fd4\u56de\u9519\u8bef\uff1a"+data.error)}}catch(e){throw new Error("\u670d\u52a1\u5668\u8fd4\u56de\u6570\u636e\u683c\u5f0f\u6709\u8bef\uff01")}}})})();;(function(){var f=TED.extend,c=TED.EventDispatcher,b=TED.EditorPlugins.Refer;function e(g){e.superclass.call(this);this.init(g||{})}e.defaultConfig={height:"200px",width:"400px",maxHeight:null,autoFocus:true,autoEnable:true,autoHeight:false,editAreaClassName:"tb-editor-editarea",editAreaWrapperClassName:"tb-editor-editarea-wrapper",wrapperClassName:"tb-editor-wrapper",disabledEditAreaClassName:"tb-editor-editarea disabled",disabledWrapperClassName:"tb-editor-wrapper disabled",imageClassName:"BDE_Image",smileyClassName:"BDE_Smiley",emptyClassName:"BDE_Empty",musicClassName:"BDE_Music",didaDelay:300,imageWidthLimit:560};e.ResizeImage=function(h){h.removeAttribute("onload");h.removeAttribute("onerror");if(h.width>e.defaultConfig.imageWidthLimit){var i=h.width;var g=h.height;h.setAttribute("width",e.defaultConfig.imageWidthLimit);h.setAttribute("height",e.defaultConfig.imageWidthLimit*g/i);h.setAttribute("changedsize",true)}};f(e,c,{config:null,enabled:false,focused:false,autoHeighted:false,wrapper:null,editArea:null,container:null,id:null,editValidHTML:["br","embed"],submitValidHTML:["br","embed"],execCommand:function(l,k){if(!this.enabled){return false}if(!this.focused){this.focus()}var h=true,l=l.toLowerCase(),n;if(typeof this["cmd_"+l]==="function"){var g=[];for(var j=1;j<arguments.length;j++){g.push(arguments[j])}n=this["cmd_"+l].apply(this,g);h=n[0];if(n[1]){l=n[1]}if(n[2]){k=n[2]}}if(h){try{document.execCommand(l,false,k)}catch(m){throw new Error("\u6267\u884caction\u65f6\uff0c\u53d1\u751f\u5f02\u5e38\uff1a"+m.message)}}if(!this.ua.ie){this.saveRange()}},getImageNum:function(){return this.getTagNum("img",this.config.imageClassName)},getSmileyNum:function(){return this.getTagNum("img",this.config.smileyClassName)},getHtml:function(){this.fireEvent("gethtml");return this.filteSubmitHTML()},setHtml:function(g){this.editArea.innerHTML=g},enable:function(){if(!this.enabled){this.attachEvents();this.editArea.style.display="none";this.editArea.contentEditable=true;this.editArea.style.display="block";if(this.ua.gecko&&this.editArea.innerHTML===""){this.editArea.innerHTML="<br>"}this.editArea.className=this.config.editAreaClassName;this.wrapper.className=this.config.wrapperClassName;if(this.config.autoFocus){this.focus()}this.enabled=true}else{if(this.config.autoFocus&&!this.focused){this.focus()}}},disable:function(){if(!this.enabled){return}if(this.focused){this.blur()}this.detachEvents();this.editArea.contentEditable=false;this.wrapper.className=this.config.disabledWrapperClassName;this.editArea.className=this.config.disabledEditAreaClassName;this.enabled=false},focus:function(){this.editArea.focus();if(this.ua.webkit){this.resumeRange()}},blur:function(){if(!this.ua.ie){this.saveRange()}this.editArea.blur()},isEmpty:function(){return this.isEmptyContent(this.editArea.innerHTML)},enableAutoHeight:function(h){if(h&&h<=parseInt(this.config.height)){if(this.autoHeighted){this.disableAutoHeight()}return}h=h||this.config.maxHeight;if(this.ua.ie>0&&this.ua.ie<=6){var g=parseInt(this.config.height),i;if(h){i="this.scrollHeight <= "+g+' ? "'+g+'px" : (this.scrollHeight >= '+h+' ? "'+h+'px" : "auto")'}else{i="this.scrollHeight <= "+g+' ? "'+g+'px" : "auto"'}this.editArea.style.setExpression("height",i)}else{this.editArea.style.minHeight=this.config.height;this.editArea.style.height="auto";if(h){this.editArea.style.maxHeight=h+"px"}}this.autoHeighted=true},disableAutoHeight:function(){if(this.ua.ie>0&&this.ua.ie<=6){this.editArea.style.removeExpression("height")}this.editArea.style.height=this.config.height;this.autoHeighted=false},empty:function(){this.editArea.innerHTML=""},ua:function(){var j=function(m){var o=0;return parseFloat(m.replace(/\./g,function(){return(o++==1)?"":"."}))},n=navigator,l={ie:0,opera:0,gecko:0,webkit:0,mobile:null,air:0,caja:n.cajaVersion,secure:false,os:null},i=navigator&&navigator.userAgent,k=window&&window.location,h=k&&k.href,g;l.secure=h&&(h.toLowerCase().indexOf("https")===0);if(i){if((/windows|win32/i).test(i)){l.os="windows"}else{if((/macintosh/i).test(i)){l.os="macintosh"}}if((/KHTML/).test(i)){l.webkit=1}g=i.match(/AppleWebKit\/([^\s]*)/);if(g&&g[1]){l.webkit=j(g[1]);if(/ Mobile\//.test(i)){l.mobile="Apple"}else{g=i.match(/NokiaN[^\/]*/);if(g){l.mobile=g[0]}}g=i.match(/AdobeAIR\/([^\s]*)/);if(g){l.air=g[0]}}if(!l.webkit){g=i.match(/Opera[\s\/]([^\s]*)/);if(g&&g[1]){l.opera=j(g[1]);g=i.match(/Opera Mini[^;]*/);if(g){l.mobile=g[0]}}else{g=i.match(/MSIE\s([^;]*)/);if(g&&g[1]){l.ie=j(g[1])}else{g=i.match(/Gecko\/([^\s]*)/);if(g){l.gecko=1;g=i.match(/rv:([^\s\)]*)/);if(g&&g[1]){l.gecko=j(g[1])}}}}}}return l}(),isUCWeb:function(){var g=navigator.userAgent.toString();if(g.indexOf("X11;")>-1&&g.indexOf("Linux i686;")>-1&&g.indexOf("Gecko")>-1&&g.indexOf("Firefox")<0&&g.indexOf("Opera")<0){return true}return false},isAndroidOS:function(){var g=navigator.userAgent.toString();if(g.match(/android/i)!=null){return true}return false},isEmptyContent:function(g){if(!g){return true}return(""===g.replace(/<br[^>]*>/gi,"").replace(/<\/?(?:span|a)[^>]*>/gi,"").replace(/[\u3000\s]+/g,"").replace(/&nbsp;/g,""))},init:function(g){this.augmentObject(g,this.constructor.defaultConfig||{});this.config=g;if(this.constructor.registerInstance){this.id=this.constructor.registerInstance(this,g.id)}this.initComponents(g);this.appendToDom();this.initEvents();this.initConfig(g)},initComponents:function(g){if(g.container){if(typeof g.container==="string"){this.container=document.getElementById(g.container)}else{if(typeof g.container==="object"&&g.container.nodeType===1){this.container=g.container}}}this.container=this.container||document.body;this.editArea=document.createElement("div");this.editArea.className=g.disabledEditAreaClassName;this.wrapper=document.createElement("div");this.wrapper.className=g.disabledWrapperClassName;this.editAreaWrapper=document.createElement("div");this.editAreaWrapper.className=g.editAreaWrapperClassName;this.editArea.style.height=g.height;this.wrapper.style.width=g.width},appendToDom:function(){this.editAreaWrapper.appendChild(this.editArea);this.wrapper.appendChild(this.editAreaWrapper);this.container.appendChild(this.wrapper)},initConfig:function(g){if(g.autoHeight){this.enableAutoHeight()}if(g.enableRefer){this.addPlugin("refer",new b({uid:this.config.uid}))}if(g.autoEnable){var h=this;setTimeout(function(){h.enable();h.fireEvent("initcomplete")},10)}else{this.fireEvent("initcomplete")}},initEvents:function(){var g=this;this.bindMousedown=function(){g.onMousedown.apply(g,arguments)};this.bindMouseup=function(){g.onMouseup.apply(g,arguments)};this.bindClick=function(){g.onClick.apply(g,arguments)};this.bindDoubleclick=function(){g.onDoubleclick.apply(g,arguments)};this.bindKeydown=function(){g.onKeydown.apply(g,arguments)};this.bindKeyup=function(){g.onKeyup.apply(g,arguments)};this.bindKeypress=function(){g.onKeypress.apply(g,arguments)};this.bindPaste=function(){g.onPaste.apply(g,arguments)};this.bindBlur=function(){g.onBlur.apply(g,arguments)};this.bindFocus=function(){g.onFocus.apply(g,arguments)}},attachEvents:function(){var g=this.editArea;if(!this.ua.ie){g.addEventListener("mousedown",this.bindMousedown,false);g.addEventListener("mouseup",this.bindMouseup,false);g.addEventListener("click",this.bindClick,false);g.addEventListener("dblclick",this.bindDoubleclick,false);g.addEventListener("keypress",this.bindKeypress,false);g.addEventListener("keyup",this.bindKeyup,false);g.addEventListener("keydown",this.bindKeydown,false);g.addEventListener("paste",this.bindPaste,false);g.addEventListener("blur",this.bindBlur,false);g.addEventListener("focus",this.bindFocus,false)}else{g.attachEvent("onmousedown",this.bindMousedown);g.attachEvent("onmouseup",this.bindMouseup);g.attachEvent("onclick",this.bindClick);g.attachEvent("ondblclick",this.bindDoubleclick);g.attachEvent("onkeypress",this.bindKeypress);g.attachEvent("onkeyup",this.bindKeyup);g.attachEvent("onkeydown",this.bindKeydown);g.attachEvent("onpaste",this.bindPaste);g.attachEvent("onbeforedeactivate",this.bindBlur);g.attachEvent("onbeforeactivate",this.bindFocus)}this.on("dida",this.onDida,this)},detachEvents:function(){var g=this.editArea;if(!this.ua.ie){g.removeEventListener("mousedown",this.bindMousedown,false);g.removeEventListener("mouseup",this.bindMouseup,false);g.removeEventListener("click",this.bindClick,false);g.removeEventListener("dblclick",this.bindDoubleclick,false);g.removeEventListener("keypress",this.bindKeypress,false);g.removeEventListener("keyup",this.bindKeyup,false);g.removeEventListener("keydown",this.bindKeydown,false);g.removeEventListener("paste",this.bindPaste,false);g.removeEventListener("blur",this.bindBlur,false);g.removeEventListener("focus",this.bindFocus,false)}else{g.detachEvent("onmousedown",this.bindMousedown);g.detachEvent("onmouseup",this.bindMouseup);g.detachEvent("onclick",this.bindClick);g.detachEvent("ondblclick",this.bindDoubleclick);g.detachEvent("onkeypress",this.bindKeypress);g.detachEvent("onkeyup",this.bindKeyup);g.detachEvent("onkeydown",this.bindKeydown);g.detachEvent("onpaste",this.bindPaste);g.detachEvent("onbeforedeactivate",this.bindBlur);g.detachEvent("onbeforeactivate",this.bindFocus)}this.remove("dida",this.onDida)},onMousedown:function(g){if(g.target&&g.target.tagName==="IMG"){if(g.preventDefault){g.preventDefault()}}this.fireEvent("mousedown",null,[g]);if(g.exitFunction){return}},onMouseup:function(g){this.fireEvent("mouseup",null,[g]);if(g.exitFunction){return}if(!this.ua.ie){this.saveRange()}},onClick:function(g){this.fireEvent("click",null,[g]);if(g.exitFunction){return}},onDoubleclick:function(g){this.fireEvent("doubleclick",null,[g]);if(g.exitFunction){return}},onKeydown:function(h){this.fireEvent("keydown",null,[h]);if(h.exitFunction){return}if(h.keyCode===8){if(this.ua.ie){var g=this.getRange();if(g.item){g.item(0).outerHTML="";h.returnValue=false}}}},onKeypress:function(i){this.fireEvent("keypress",null,[i]);if(i.exitFunction){return}var g=i.keyCode;switch(g){case 13:if(this.ua.ie){var h=this.getRange();if(h){h.pasteHTML("<br>");h.collapse(false);h.select()}i.returnValue=false}else{if(this.ua.webkit){document.execCommand("insertlinebreak");i.preventDefault()}}break}},onKeyup:function(g){this.fireEvent("keyup",null,[g]);if(g.exitFunction){return}if(!this.ua.ie){this.saveRange()}if(g.stopPropagation){g.stopPropagation()}},onPaste:function(h){this.fireEvent("paste",null,[h]);if(h.exitFunction){return}if(this.ua.ie){this.doPasteIE(h);this.fireEvent("afterpaste",null,[h])}else{var g=this;setTimeout(function(){g.doPaste();g.fireEvent("afterpaste",null,[h])},5)}},didaTimer:null,savedHeight:null,startDida:function(){var g=this;this.didaTimer=setInterval(function(){g.fireEvent("dida")},this.config.didaDelay)},stopDida:function(){clearInterval(this.didaTimer)},onDida:function(){if(this.autoHeighted){if(this.savedHeight===null){this.savedHeight=this.wrapper.scrollHeight;return}var g=this.wrapper.scrollHeight;if(this.savedHeight&&g!==this.savedHeight){this.fireEvent("heightChanged",null,[g,g-this.savedHeight]);this.savedHeight=g}}},onBlur:function(g){this.stopDida();this.focused=false;this.fireEvent("blur",null,[g]);if(g.exitFunction){return}if(this.ua.ie){this.saveRange()}},onFocus:function(g){this.startDida();this.focused=true;this.fireEvent("focus",null,[g]);if(g.exitFunction){return}this.resumeRange()},augmentObject:function(i,h){for(var g in h){if(h.hasOwnProperty(g)){i[g]=i[g]!==undefined?i[g]:h[g]}}},getSelection:function(){return window.getSelection?window.getSelection():document.selection},getRange:function(){return this.ua.ie?document.selection.createRange():window.getSelection().getRangeAt(0)},createRange:function(){return this.ua.ie?document.body.createTextRange():document.createRange()},getSelectedElement:function(){var g=this.getRange();if(this.ua.ie){return g.item?g.item(0):g.parentElement()}var h=g.commonAncestorContainer;if(h.nodeType===3){h=h.parentNode}return h},doPasteIE:function(g){var h=clipboardData.getData("Text");if((!h)||h==""){return true}h=h.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r?\n/g,"<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;").replace(/\s/g,"&nbsp;").replace(/\u3000/g,"&nbsp;&nbsp;");this.execCommand("inserthtml",h);g.returnValue=false},doPaste:function(){this.saveCursor();this.editArea.innerHTML=this.filteEditHTML();this.ensureCursor()},filteEditHTML:function(){return html=this.editArea.innerHTML.replace(/_moz_dirty=""/gi,"").replace(/\[/g,"[[-").replace(/\]/g,"-]]").replace(/<\/ ?tr[^>]*>/gi,"[br]").replace(/<\/ ?td[^>]*>/gi,"&nbsp;&nbsp;").replace(/<(ul|dl|ol)[^>]*>/gi,"[br]").replace(/<(li|dd)[^>]*>/gi,"[br]").replace(/<p [^>]*>/gi,"[br]").replace(new RegExp("<(/?(?:"+this.editValidHTML.join("|")+")[^>]*)>","gi"),"[$1]").replace(new RegExp('<span([^>]*class="?at"?[^>]*)>',"gi"),"[span$1]").replace(new RegExp('<img([^>]*class="?(?:'+this.config.imageClassName+"|"+this.config.emptyClassName+"|"+this.config.smileyClassName+"|"+this.config.flashClassName+"|"+this.config.musicClassName+'"?[^>]*)>',"gi"),"[img$1]").replace(/<[^>]*>/g,"").replace(/\[\[\-/g,"[").replace(/\-\]\]/g,"]").replace(new RegExp("\\[(/?(?:"+this.editValidHTML.join("|")+"|img|span)[^\\]]*)\\]","gi"),"<$1>").replace(/\r?\n/gi,"<br>")},filteSubmitHTML:function(){this.reLayout(true);var o=this.editArea.innerHTML.replace(/_moz_dirty=""/gi,"").replace(/\[/g,"[[-").replace(/\]/g,"-]]").replace(new RegExp("<(/?(?:"+this.submitValidHTML.join("|")+")[^>]*)>","gi"),"[$1]").replace(/<strong[^>]*>/gi,"[strong]").replace(/<\/strong[^>]*>/gi,"[/strong]").replace(/<b[^>]*>/gi,"[strong]").replace(/<\/b[^>]*>/gi,"[/strong]").replace(new RegExp('<span([^>]*class="?edit_font_normal"?[^>]*)>@</span>',"gi"),"@").replace(/<span([^>]*)>/gi,"[span$1]").replace(/<\/span[^>]*>/gi,"[/span]").replace(/<font[^>]*color=(\")?#E10602(\")?[^>]*>/gi,'[span class="edit_font_color"]').replace(/<font[^>]*color=(\")?#333333(\")?[^>]*>/gi,'[span class="edit_font_normal"]').replace(/<font[^>]*>/gi,'[span class="edit_font_normal"]').replace(/<\/font[^>]*>/gi,"[/span]").replace(new RegExp('<img([^>]*class="?(?:'+this.config.imageClassName+"|"+this.config.smileyClassName+"|"+this.config.flashClassName+"|"+this.config.musicClassName+')"?[^>]*)>',"gi"),"[img$1]").replace(/<[^>]*>/g,"").replace(/\[\[\-/g,"[").replace(/\-\]\]/g,"]").replace(new RegExp("\\[(/?(?:"+this.submitValidHTML.join("|")+"|img|span|strong)[^\\]]*)\\]","gi"),"<$1>").replace(new RegExp("<span[^>]*>@</span>","gi"),"@").replace(new RegExp("<span[^>]*>@(.*?)</span>","gi"),"@$1 ");var m=document.createElement("div");m.innerHTML=o;var g=m.getElementsByTagName("span"),k=[],q,p,l,h;for(l=0,h=g.length;l<h;l++){if(g[l].className==="edit_font_normal"){k.push(g[l])}}for(l=0,h=k.length;l<h;l++){p=k[l];q=document.createDocumentFragment();while(p.firstChild){q.appendChild(p.firstChild)}p.parentNode.replaceChild(q,p)}this.parseURL(m);return m.innerHTML},filteHTML:function(h,g){return h.replace(/_moz_dirty=""/gi,"").replace(/\[/g,"[[-").replace(/\]/g,"-]]").replace(new RegExp("<(/?(?:"+g.join("|")+")[^>]*)>","gi"),"[$1]").replace(/<[^>]*>/g,"").replace(/\[\[\-/g,"[").replace(/\-\]\]/g,"]").replace(new RegExp("\\[(/?(?:"+g.join("|")+")[^\\]]*)\\]","gi"),"<$1>")},selectNodeContents:function(h,j){if(!h){return}var g,i;if(this.ua.ie){g=document.body.createTextRange();g.moveToElementText(h);if(j){g.collapse(false)}g.select()}else{i=this.getSelection();g=document.createRange();g.selectNodeContents(h);i.removeAllRanges();i.addRange(g);if(j){i.collapseToEnd()}}},hasSelection:function(){var g=this.getSelection();if(this.ua.ie){if(g.type){return g.type.toLowerCase()!=="none"}else{return false}}else{if(this.ua.opera){var h=this.getRange();return !(g.isCollapsed&&h.startContainer&&h.startContainer===h.endContainer&&h.startOffset===h.endOffset)}else{return !g.isCollapsed}}},saveCursor:function(){if(!this.focused){return}var g=document.getElementById("editor-tmp-img");if(g){g.parentNode.removeChild(g)}this.execCommand("inserthtml",'<img class="'+this.config.emptyClassName+'" id="editor-tmp-img" style="width:1px;height:1px">')},ensureCursor:function(){if(!this.focused){this.focus()}var h=document.getElementById("editor-tmp-img");if(h){if(this.ua.ie&&(!document.documentMode||document.documentMode<9)){this.selectNodeContents(h);this.execCommand("delete")}else{var g=document.createRange();g.selectNode(h);var i=window.getSelection();i.removeAllRanges();i.addRange(g);this.execCommand("delete")}}},savedRange:null,saveRange:function(){this.savedRange=this.getRange()},resumeRange:function(g){g=g||this.savedRange;if(!g){return false}if(this.ua.ie){try{g.select()}catch(i){}}else{var h=this.getSelection();h.removeAllRanges();h.addRange(g)}},cmd_inserthtml:function(g){if(this.ua.ie){var h=this.getRange();if(h.item){h.item(0).outerHTML=g}else{h.pasteHTML(g)}return[false]}return[true]},insertImage:function(g,i,p,l,h,q){var m="";if(typeof l!=="undefined"){m=l}var o=' onload="TED.EditorCore.ResizeImage(this);"';if(h>0){if(h>e.defaultConfig.imageWidthLimit){var s=h;var n=q;h=e.defaultConfig.imageWidthLimit;q=e.defaultConfig.imageWidthLimit*n/s}o=' height="'+q+'" width="'+h+'"'}if(this.ua.ie===8){this.execCommand("inserthtml",'<img unselectable="on"  pic_type="'+m+'"  class="'+i+'" id="editor-tmp-img" src="'+g+'" '+o+">");var j=document.getElementById("editor-tmp-img");j.removeAttribute("id");if(j.parentNode.lastChild===j){var r=document.createElement("br");j.parentNode.appendChild(r);var k=document.body.createTextRange();k.moveToElementText(r);if(p){k.collapse(false)}else{k.collapse(true)}k.select()}else{if(p){this.execCommand("insertlinebreak")}}}else{this.execCommand("inserthtml",'<img unselectable="on"   pic_type="'+m+'" class="'+i+'" src="'+g+'" '+o+">");if(p){this.execCommand("insertlinebreak")}}},cmd_insertlinebreak:function(){if(this.ua.webkit){document.execCommand("insertlinebreak",false,null)}else{if(this.ua.gecko){document.execCommand("inserthtml",false,'<br id="editor-tmp-br">');var h=document.getElementById("editor-tmp-br");h.removeAttribute("id");if(h.parentNode.lastChild===h){h.parentNode.removeChild(h);document.execCommand("inserthtml",false,'<br><br id="editor-tmp-br">');h=document.getElementById("editor-tmp-br");h.removeAttribute("id");var i=window.getSelection();var j=document.createRange();j.setStartBefore(h);j.setEndBefore(h);i.removeAllRanges();i.addRange(j)}}else{if(this.ua.ie){var g=this.getRange();if(g){g.pasteHTML("<br>");g.collapse(false);g.select()}}}}return[false]},cmd_insertsmiley:function(g){this.insertImage(g,this.config.smileyClassName);return[false]},cmd_insertimage:function(h,l,m){if(typeof h=="string"){this.insertImage(h,this.config.imageClassName,true,l)}else{if(Object.prototype.toString.apply(h)==="[object Array]"){if(m=="obj"){for(var k=0,g=h.length;k<g;k++){this.insertImage(h[k].url,this.config.imageClassName,true,l,h[k].width,h[k].height)}}else{for(var k=0,g=h.length;k<g;k++){this.insertImage(h[k],this.config.imageClassName,true,l)}}}}return[false]},cmd_focus2end:function(){var g=this.editArea;if(this.ua.ie){g.innerHTML=g.innerHTML}else{if(g.lastChild){var i=document.createRange(),h=window.getSelection();i.setStartAfter(g.lastChild);i.setEndAfter(g.lastChild);h.removeAllRanges();h.addRange(i)}else{g.focus()}}return[false]},editorPlugins:null,addPlugin:function(h,g){g.init(this);this.editorPlugins=this.editorPlugins||{};this.editorPlugins[h]=g},augmentObject:function(i,h){for(var g in h){if(h.hasOwnProperty(g)){i[g]=i[g]!==undefined?i[g]:h[g]}}},setStatsRequest:function(h){var g=new Image();window["bd_pv_"+(new Date).getTime()]=g;g.src="http://static.tieba.baidu.com/tb/img/pv.gif?fr=tb0_forum&st_mod=frspb&st_type=editor&st_value="+h+"&t="+(new Date).getTime();g=null},getTagNum:function(l,m){var h=this.editArea.getElementsByTagName(l),n=h.length;if(m){n=0;for(var k=0,g=h.length;k<g;k++){if(h[k].className===m){n++}}}return n},reLayout:function(n){var m=this.editArea.getElementsByTagName("img"),g=this.config.imageWidthLimit;var l=[];for(var k=0,h=m.length;k<h;k++){img=m[k];if(img.width===0||img.height===0){l.push(img);continue}if(n){img.removeAttribute("unselectable")}if(img.className===this.config.imageClassName){if(img.width>g){img.setAttribute("width",g);img.setAttribute("changedsize",true)}else{img.setAttribute("width",img.width)}img.setAttribute("height",img.height)}else{if(img.className===this.config.smileyClassName){if(img.width>100){img.setAttribute("width",100)}else{img.setAttribute("width",img.width)}img.setAttribute("height",img.height)}else{img.setAttribute("width",img.width);img.setAttribute("height",img.height)}}img.removeAttribute("onload")}for(var k=0,h=l.length;k<h;k++){l[k].parentNode.removeChild(l[k])}},parseURL:function(k){var h="(=*+)",g="(+*=)";var j=4;var i=function(l){if(l.nodeType==3){var m=l.nodeValue;if(m&&m.length>j){m="."+m;m=m.replace(/([^0-9a-zA-Z])((www\.|http:\/\/|mms:\/\/|rtsp:\/\/|ftp:\/\/|https:\/\/)[0-9a-zA-Z\.\!\~\#\?\:\/\&\%\-\+\*\'\=\@\_\$]+)/gi,"$1"+h+'a href="$2" target="_blank"'+g+"$2"+h+"/a"+g);m=m.substring(1);l.nodeValue=m}}else{if(l.nodeType==1){var n=l.firstChild;while(n){if(n.nodeName.toUpperCase()!="A"){i(n)}n=n.nextSibling}}}};i(k);k.innerHTML=k.innerHTML.replace(/\(\=\*\+\)a\ href="www\./gi,'<a href="http://www.').replace(/\(\=\*\+\)/gi,"<").replace(/\(\+\*\=\)/gi,">")}});window.TED["EditorCore"]=e;var a={instanceNum:0,idPrefix:"tb-editor-",registerInstance:function(g,h){this.instances=this.instances||{};h=h||this.generateID();this.instances[h]=g;return h},generateID:function(){return this.idPrefix+ ++this.instanceNum},getInstanceById:function(g){return(g&&this.instances)?this.instances[g]:null}};window.TED["EditorInstanceManager"]=a;function d(g){d.superclass.call(this);this.area=document.createElement("textarea");if(g.is_ipad){this.area.className="textarea_ipad"}this.area.style.width=g.width;this.area.style.height=g.height;if(g.autoEnable===false){this.area.disabled=true}document.getElementById(g.container).appendChild(this.area);this.init()}f(d,c,{isMobile:true,init:function(){var g=this;this.area.onfocus=function(){g.fireEvent("focus")};this.area.onclick=function(){g.fireEvent("click")};if(this.constructor.registerInstance){this.id=this.constructor.registerInstance(this)}},getImageNum:function(){return 0},getSmileyNum:function(){return 0},getFlashNum:function(){return 0},getMusicNum:function(){return 0},getHtml:function(){return this.area.value.replace(/&/gi,"&amp;").replace(/</gi,"&lt;").replace(/>/gi,"&gt;").replace(/\r?\n/gi,"<br>").replace(/[\u3000\s]/gi,"&nbsp;").replace(/\t/gi,"&nbsp;&nbsp;&nbsp;&nbsp;")},focus:function(){this.area.focus()},blur:function(){this.area.blur()},isEmpty:function(){var g=this.area;return !(g&&g.value&&g.value.replace(/[\u3000\s]/gi,"").replace(/\r?\n/gi,"").replace(/\t/gi,"")!="")},quoteContainer:null,quote:function(j,g,k){j=parseInt(j);if(j>1){if(this.quoteContainer===null){this.quoteContainer=document.createElement("div");this.quoteContainer.className="editor-quote";this.area.parentNode.insertBefore(this.quoteContainer,this.area)}var i=document.getElementById("post_content_"+g).innerHTML.replace(/<img[^>]*>/gi,"[\u56fe\u7247]").replace(/<embed[^>]*>/gi,"[\u89c6\u9891]").replace(/<br[^>]*>/gi," ").replace(/<a[^>]*>/gi,"").replace(/<\/a>/gi,"").subByte(270);this.quoteContainer.innerHTML='<blockquote class="quote quote_simple"><a href="javascript:void(0);" onmousedown="return false;" onclick="TED.TextInput.getInstanceById(\''+this.id+'\').unQuote();Stats.sendRequest(\'fr=tb0_forum&st_mod=pb&st_type=quote&st_value=delete\');" class="close" title="\u5220\u9664\u5f15\u7528">\u2573</a><p class="quote_title">\u5f15\u7528&nbsp;'+k+'&nbsp;(<a href="#'+g+'">'+j+'\u697c</a>)</p><p class="quote_content">'+i+"</p></blockquote>";this.quoteContainer.style.display="block";this.fireEvent("quote",null,[g])}else{this.unQuote();Stats.sendRequest("fr=tb0_forum&st_mod=pb&st_type=quote&st_value=replyfirst")}var h=this;setTimeout(function(){h.focus()},100)},unQuote:function(){if(this.quoteContainer){this.quoteContainer.style.display="none"}this.fireEvent("unquote")}});TED.augmentObject(d,a);window.TED["TextInput"]=d})();;(function(){var b=window.TED["Overlay"],a=window.TED["Event"];window.TED["EditorPlugins"]["InsertSmiley"]=c;function c(e,f){this.container=e;this.holder=document.createElement("div");this.holder.style.position="relative";this.holder.className="insertsmiley_holder";this.options=f;this.container.appendChild(this.holder)}c.prototype={init:function(f){this.editor=f;var e=this;this.overlay=new b(this.holder);_.Module.use("common/component/EditorLayer",[{container:$(this.holder)}],function(g){e.editor.overlay=g;window.PAGESMILELAYER=e.editor.overlay;a.addEvent(e.holder,"click",function(i){var h=i.target||i.srcElement;if(h===e.holder){e.clickHandler(i);if(i.stopPropagation){i.stopPropagation()}else{i.cancelBubble=true}}})})},clickHandler:function(){var f={layerPos:{left:-472,top:29},layerSize:{height:315,width:552},arrowPos:{left:472,top:-7},content:{height:313},arrowType:"arrow_up",layerType:""};f=$.extend(f,this.options);var e=this;if(this.smileLayer){e.editor.overlay.toggle(f,this.smileLayer,this.editor,e.holder,"smile")}else{_.Module.use("common/component/EditorSmiley",[],function(g){e.smileLayer=g;e.editor.overlay.toggle(f,e.smileLayer,e.editor,e.holder,"smile")})}},closeOverlay:function(){this.editor.overlay.close()}};window.TED["EditorPlugins"]["WordLimit"]=d;function d(e){this.maxNum=e||130;this.holder=document.createElement("div");this.holder.className="wordlimit-holder";this.holder.style.visibility="hidden"}d.prototype={showLimit:10,checkTimer:null,checkDelay:300,isShow:false,exceed:false,init:function(e){this.editor=e;this.container=e.wrapper;this.container.appendChild(this.holder);e.on("keyup",this.handlerEvent,this);e.on("focus",this.handlerEvent,this);this.check()},handlerEvent:function(g){clearTimeout(this.checkTimer);var f=this;this.checkTimer=setTimeout(function(){f.check()},this.checkDelay)},check:function(e){var f=this.maxNum-this.editor.getContentLength();if(f<=this.showLimit){this.holder.style.visibility="visible";this.isShow=true;if(f<0){if(!this.exceed){this.editor.fireEvent("overflow");this.exceed=true}this.holder.innerHTML='\u5df2\u7ecf\u8d85\u51fa<span style="font-size:18px;font-family:Arial;color:#f00;">'+-f+"</span>\u4e2a\u5b57"}else{if(this.exceed){this.editor.fireEvent("unoverflow");this.exceed=false}this.holder.innerHTML='\u8fd8\u80fd\u8f93\u5165<span style="font-size:18px;font-family:Arial;">'+f+"</span>\u4e2a\u5b57"}}else{if(this.isShow){this.holder.style.visibility="hidden";this.isShow=false;if(this.exceed){this.editor.fireEvent("unoverflow");this.exceed=false}}}}}})();;(function(){var d=TED.EditorCore,e=TED.extend,a=TED.EditorInstanceManager,b=TED.augmentObject;window.TED["SimpleEditor"]=c;function c(f){c.superclass.call(this,f)}c.defaultConfig={height:"100px",width:"400px",maxHeight:null,autoFocus:true,autoEnable:true,autoHeight:false,wrapperClassName:"tb-simpleeditor-wrapper",editAreaClassName:"tb-editor-editarea",editAreaWrapperClassName:"tb-editor-editarea-wrapper",disabledEditAreaClassName:"tb-editor-editarea tb-editor-editarea-disabled",disabledWrapperClassName:"tb-simpleeditor-wrapper tb-simpleeditor-wrapper-disabled",imageClassName:"BDE_Image",smileyClassName:"BDE_Smiley",rootPath:"/tb/static-common/",enableRefer:true,emptyClassName:"BDE_Empty",flashClassName:"BDE_Flash",flashNumLimit:10,didaDelay:300,imageWidthLimit:570};e(c,d,{getContentLength:function(){return Math.ceil(this.filteHTML(this.editArea.innerHTML,["img","br"]).replace(/<img[^>]*>/gi,"mm").replace(/<br[^>]*>/gi,"m").replace(/&nbsp;/gi,"m").replace(/[^\x00-\xff]/g,"mm").length/2)},filteEditHTML:function(){return html=this.editArea.innerHTML.replace(/_moz_dirty=""/gi,"").replace(/\[/g,"[[-").replace(/\]/g,"-]]").replace(new RegExp("<(/?(?:br)[^>]*)>","gi"),"[$1]").replace(new RegExp('<span([^>]*class="?at"?[^>]*)>',"gi"),"[span$1]").replace(new RegExp('<img([^>]*class="?(?:'+this.config.emptyClassName+"|"+this.config.smileyClassName+')"?[^>]*)>',"gi"),"[img$1]").replace(/<[^>]*>/g,"").replace(/\[\[\-/g,"[").replace(/\-\]\]/g,"]").replace(new RegExp("\\[(/?(?:br|img|span)[^\\]]*)\\]","gi"),"<$1>")},getConfig:function(){return this.config},filteSubmitHTML:function(){this.reLayout();var g=this.editArea.innerHTML.replace(/_moz_dirty=""/gi,"").replace(/\[/g,"[[-").replace(/\]/g,"-]]").replace(new RegExp("<(/?(?:"+this.submitValidHTML.join("|")+")[^>]*)>","gi"),"[$1]").replace(new RegExp('<img([^>]*class="?(?:'+this.config.imageClassName+"|"+this.config.smileyClassName+"|"+this.config.flashClassName+"|"+this.config.musicClassName+')"?[^>]*)>',"gi"),"[img$1]").replace(/<[^>]*>/g,"").replace(/\[\[\-/g,"[").replace(/\-\]\]/g,"]").replace(new RegExp("\\[(/?(?:"+this.submitValidHTML.join("|")+"|img)[^\\]]*)\\]","gi"),"<$1>");var f=document.createElement("div");f.innerHTML=g;this.parseURL(f);return f.innerHTML}});b(c,a)})();;var SimplePostor=function(d,c){this.option=d;this._edOp_t=c;var a=PageData.user.has_grade?PageData.user.grade_level:0;this._edOp_t.bavl=a;var b=$("#"+d.tpl_id).html();this.cur_sec=c.container;this.cur_sec.innerHTML=b;var e=$(c.container);this._bc=e.find(".lzl_panel_btn");this._enabled=true;this._eh=e.find(".lzl_panel_error");this._event={};this._statInit(d._login,d._can_post,d._no_un)};SimplePostor.prototype={constructor:SimplePostor,_statInit:function(d,f,e){var a=this.option;if(!d){this._cannotPost();return}if(d&&f==1&&e){this._cannotPost();return}if(d&&f!=1){this._cannotPost();return}if(a._reach_limit){this._cannotPost();return}if(a._is_block){this._cannotPost();return}if(d&&f==1&&!e){var c=this.cur_sec;var b=$(c).find(".editor_for_container")[0];this._buildNormalEditor(b);this._postBtnInit("enble")}},_cannotPost:function(){var a=this.cur_sec;this._buildLimitedEditor(a);this._postBtnInit("disable");return},_postBtnInit:function(d){switch(d){case"disable":this._disableEditor();this._disableSmile();break;case"enble":var a=this._bc,b=this;var c=a.find("span.j_lzl_p_sm");c.css("position","relative");if(!PageData.is_ipad){this._se.addPlugin("insertsmiley",new TED.EditorPlugins.InsertSmiley(c[0]))}else{c.hide()}this._se.addPlugin("WordLimit",new TED.EditorPlugins.WordLimit(140));c=a.find("span.j_lzl_p_sb");c.hover(function(){$(this).addClass("lzl_panel_submit_hover")},function(){$(this).removeClass("lzl_panel_submit_hover lzl_panel_submit_active")});c.bind("click",function(f){$(this).addClass("lzl_panel_submit_active");b.submitClick();f.target.blur()});break}},bind:function(b,a,c){var d={stat:c?true:false,fun:a};if(this._event[b]){this._event[b].push(d)}else{this._event[b]=[];this._event[b].push(d)}},triggerEvent:function(a){if(this._event[a]){var c=this._event[a];for(var b=0;b<c.length;b++){if(c[b].fun){c[b].fun()}if(!c[b].stat){return false}}}return true},_buildLimitedEditor:function(e){var b=this;if(!b._fe){var c=$("<div>");c.addClass("lzl_simple_wrapper");var a=this._edOp_t;var d=$(b.cur_sec).find(".editor_for_container");c.css({width:b._edOp_t.width,height:b._edOp_t.height,position:"static"});c.append(b._buildLimitedInfo());b._fe=c}d.append(b._fe)},_tip:["","\u53c2\u4e0e\u672c\u5427\u8ba8\u8bba\uff0c\u8bf7\u5148 ","\u62b1\u6b49\uff0c\u672c\u5427\u76ee\u524d\u4ec5\u9650\u5427\u52a1\u56e2\u961f\u53ca\u6ce8\u518c\u6ee1\u4e00\u5b9a\u65f6\u95f4\u7684\u8001\u7528\u6237\u53d1\u8d34","\u62b1\u6b49\uff0c\u6839\u636e\u76f8\u5173\u6cd5\u5f8b\u6cd5\u89c4\u548c\u653f\u7b56\uff0c\u672c\u5427\u76ee\u524d\u4ec5\u5141\u8bb8","\u62b1\u6b49\uff0c\u672c\u5427\u76ee\u524d\u4ec5\u9650\u5427\u52a1\u56e2\u961f\u53d1\u8d34","\u62b1\u6b49\uff0c\u6839\u636e\u76f8\u5173\u6cd5\u5f8b\u6cd5\u89c4\u548c\u653f\u7b56\uff0c\u672c\u5427\u76ee\u524d\u53ea\u80fd\u6d4f\u89c8\uff0c\u4e0d\u80fd\u53d1\u8d34","","\u62b1\u6b49\uff0c\u6839\u636e\u76f8\u5173\u6cd5\u5f8b\u6cd5\u89c4\u548c\u653f\u7b56\uff0c\u672c\u5427\u76ee\u524d\u53ea\u80fd\u53d1\u56de\u590d\u8d34","\u62b1\u6b49\uff0c\u6839\u636e\u76f8\u5173\u6cd5\u5f8b\u6cd5\u89c4\u548c\u653f\u7b56\uff0c\u672c\u5427\u76ee\u524d\u53ea\u80fd\u53d1\u4e3b\u9898\u8d34","\u62b1\u6b49\uff0c\u6839\u636e\u76f8\u5173\u6cd5\u5f8b\u6cd5\u89c4\u548c\u653f\u7b56\uff0c\u672c\u5427\u76ee\u524d\u4ec5\u5141\u8bb8","\u62b1\u6b49\uff0c\u6839\u636e\u76f8\u5173\u6cd5\u5f8b\u6cd5\u89c4\u548c\u653f\u7b56\uff0c\u672c\u5427\u76ee\u524d\u4ec5\u5141\u8bb8"],_buildLimitedInfo:function(){var e=$("<p>");var c='<div class="editor_banned_tip_info">',d=this.option,b=this;if(d._reach_limit){c+="<span>\u672c\u697c\u5c42\u56de\u590d\u5df2\u8fbe\u4e0a\u9650\uff0c\u8bf7\u53c2\u4e0e\u5176\u4ed6\u697c\u5c42\u8ba8\u8bba</span>";c+="</div>";e.html(c);e.css({margin:"14px 0 0 14px"})}else{if(d._is_block){var a=["<span>"];a.push(PageUnit.load("simple_postor_blocktippart1"));a.push(PageUnit.load("simple_postor_blocktippart2"));a.push(PageUnit.load("simple_postor_blocktippart3"));a.push("</span></div>");c+=a.join("").replace(/(href=\")(.*?)(\")/,"$1$2"+PageData.forum_id+"$3");e.html(c);e.css({margin:"14px 0 0 14px"})}else{c+="<span>";if(d._can_post==1&&d._no_un){c+="\u60a8\u8fd8\u6ca1\u6709\u7528\u6237\u540d\uff0c\u4e0d\u80fd\u56de\u590d\u3002\u8bf7\u5148<a href=\"javascript:void(0)\"  onclick=\"TbCom.process('User','buildUnameFrame','\u586b\u5199\u7528\u6237\u540d',' ')\">\u586b\u5199\u7528\u6237\u540d</a>";c+="</span>";c+="</div>";e.html(c);e.css({margin:"4px 0 0 14px"})}else{c+=b._tip[d._forum_type];c+="</span>";if(d._forum_type==1){c+='<span class="lzl_login_wrapper">';c+="<a href=\"#\" onclick=\"_.Module.use('common/component/LoginDialog', ['', 'lzl']);return false;\">\u767b\u5f55</a>";c+="&nbsp;|&nbsp";c+="<a href=\"#\" onclick=\"TbCom.process('User', 'buildRegisterFrame', 'lzl');return false;\">\u6ce8\u518c</a>";c+="</span>"}else{if(d._forum_type==3){c+='<a href="http://tieba.baidu.com/f/like/level?kw=d8" >4\u7ea7\u5934\u8854</a>\u4ee5\u4e0a\u4f1a\u5458\u53d1\u8d34\u3002'}else{if(d._forum_type==9){c+="\u4e00\u5b9a\u7ea7\u522b\u4ee5\u4e0a\u4f1a\u5458\u53d1\u56de\u590d\u8d34\u3002"}else{if(d._forum_type==10){c+="\u4e00\u5b9a\u7ea7\u522b\u4ee5\u4e0a\u4f1a\u5458\u53d1\u4e3b\u9898\u8d34\u3002"}}}}c+="</div>";e.html(c);if(d._forum_type==3||d._forum_type>=7){e.css({margin:"5px 0 0 14px"})}else{e.css({margin:"14px 0 0 14px"})}}}}return e},_buildNormalEditor:function(e){var b=this,a=b.option;var c=b._edOp_t;c.container=e;var d=new TED.SimpleEditor(c);d.on("overflow",function(){b._overFlow()});d.on("unoverflow",function(){b._unoverFlow()});d.on("keydown",function(f){b._keyDown(f)});d.on("keyup",function(f){b._keyUp(f)});b._se=d},_overFlow:function(){this._disableEditor()},_unoverFlow:function(){this._enableEditor()},_keyDown:function(a){if(a.keyCode==17){this._ctrl_down=true}else{if(a.keyCode==13&&this._ctrl_down){this.submitClick();if(a.srcElement){a.srcElement.blur()}else{a.target.blur()}}}},_disableEditor:function(){var c=this;c._enabled=false;var a=c._bc.find("span.j_lzl_p_sb");a.removeClass("lzl_panel_submit");a.html("");a.addClass("lzl_panel_submit_disabled")},_disableSmile:function(){var c=this;var a=c._bc.find("span.j_lzl_p_sm");if(PageData.is_ipad){a.hide();return}c._enabled=false;a.removeClass("lzl_panel_smile");a.html("");a.addClass("lzl_panel_smile_disabled")},_enableEditor:function(){var c=this;c._enabled=true;var a=c._bc.find("span.j_lzl_p_sb");a.removeClass("lzl_panel_submit_disabled");a.addClass("lzl_panel_submit");a.html("\u53d1\u8868")},_keyDown:function(b){var a=this;if(b.keyCode==17){a._ctrl_down=true}else{if(b.keyCode==13&&a._ctrl_down){a.submitClick();if(b.srcElement){b.srcElement.blur()}else{b.target.blur()}}}if(b.altKey&&b.keyCode==83){if(b.preventDefault){b.preventDefault()}else{b.returnValue=false}setTimeout(function(){a.submitClick()},0)}},_keyUp:function(a){if(a.keyCode==17){this._ctrl_down=false}},_ie6RelativeHack:function(){var b=this,d=$(b.cur_sec),a=this._bc;d.find("div.insertsmiley_holder").hide();var e=d.find("div.wordlimit-holder");var c=a.find("span.j_lzl_p_sm");c.css("position","static");if(e.css("visibility")!="hidden"){d.find("div.wordlimit-holder").hide();b._hint_shown=true}else{b._hint_shown=false}d.find("div.lzl_simple_wrapper").css("position","static")},_ie6RelativeRecover:function(){var b=this,d=$(b.cur_sec),a=this._bc;d.find("div.insertsmiley_holder").show();var e=d.find("div.wordlimit-holder");if(this._hint_shown){e.show()}var c=a.find("span.j_lzl_p_sm");c.css("position","relative");d.find("div.lzl_simple_wrapper").css("position","relative")},_getHtml:function(){var a=this._se.getHtml();a=a.replace(/<br[^>]*>/gi," ").replace(/[\u3000\s]+/g," ").replace(/&nbsp;/g," ");return a},_data:{},submitClick:function(){if(PageData.thread.is_ad===1){if(document.images){var b=new Image();b.src=PageData.ecomStatDomain+"reply.php?forumid="+(PageData.forum_id||"")+"&tid="+(PageData.thread.id||"")+"&userid="+(PageData.user.id||"")+"&username="+encodeURIComponent(PageData.user_name||"")+"&exp="+encodeURIComponent(PageData.ecomExp||"")+"&t="+new Date().getTime();b=null}}var a=this;var d=$(a.cur_sec),c=d.find("div.insertsmiley_holder");d.find("span.close").click();c.css("position","static");if(!this._isValid()){c.css("position","relative");return}c.css("position","relative");this._submitData()},_isValid:function(){if(!this._enabled){return false}if(this._se.isEmpty()){this._se.focus();this._eh.html("\u53d1\u8d34\u5185\u5bb9\u9700\u5305\u542b\u6587\u5b57").show();return false}if(this._se.getSmileyNum()>10){this._eh.html("\u62b1\u6b49\uff0c\u6bcf\u5c42\u697c\u63d2\u5165\u7684\u8868\u60c5\u4e0d\u80fd\u8d85\u8fc710\u4e2a\uff0c\u8bf7\u4fee\u6539\u540e\u91cd\u65b0\u63d0\u4ea4").show();return false}return true},_submitData:function(){this._eh.hide();this._disableEditor();var a=this;$.tb.post(FORUM_POST_URL.postAdd,a._getData(),function(b){a._setPostData("vcode","");a._setPostData("vcode_md5","");if(b.no==0){var c=a.triggerEvent("onsuccess");a._se.empty();if(a.option.__data__){a.option.data=a.option.__data__;a.option.__data__=null}a._enableEditor();var c=a.triggerEvent("hide")}else{a._showAddResult(b);a._enableEditor()}return false})},_setData:function(a){this.option.__data__=this.option.data;this.option.data=$.extend(this.option.data,a)},_setPostData:function(a,b){this._data[a]=b},_getData:function(){var f=this.option,a=f.data,b=this;b._data.kw=PageData.forum_name;b._data.fid=PageData.forum_id;b._data.tid=PageData.thread.id;b._data.floor_num=a.floor_num;b._data.quote_id=a.pid;b._data.rich_text=1;b._data.tbs=PageData.tbs;b._data.content=b._getHtml();b._data.lp_type=f._thread_topic_type;b._data.lp_sub_type=f._thread_topic_subtype;b._data.new_vcode=1;b._data.tag=11;if(a.spid!=undefined){b._data.repostid=a.spid}else{b._data.repostid=a.pid}if(b._no_un==true){b._data.anonymous=1}else{b._data.anonymous=0}try{var c=window.external.GetVersion("version");if(c.indexOf("baidubrowser")>-1){b._data.browser_version="baidubrowser"}}catch(d){}return b._data},_errorTipShow:function(b){var a=this;a._eh.html(b).show();a._se.focus()},_showAddResult:function(b){var a=this;var c=function(f){switch(f.getActionType()){case f.Action_FocusContent:a._se.focus();break;case f.Action_ClearYZM:break;case f.Action_GoToHead:break;case f.Action_FlushAndGoToHead:a._se.empty();break;default:break}};Thread_add_result.init(b);if(b.no!=0){if(Thread_add_result.isNeedWaitForCheck()){var e='<div style="margin: 0px 30px 0px 30px;font-size:14px;line-height:20px;text-align:left;font-family: &quot;\u5b8b\u4f53&quot;;"><table style="width:90%"><tbody><tr><td width="60"><img style="border:none;" src="http://tb2.bdstatic.com/tb/img/messageFace.gif"></td><td valign="middle" style="font-size:20px;line-height:22px;font-family: &quot;\u9ed1\u4f53&quot;;">\u7b49\u5f85\u5ba1\u6838...</td></tr></tbody></table>'+Thread_add_result.getMessage()+"</div>";var d=$.dialog.alert(e,{width:380,height:105,title:"\u53d1\u8868\u8d34\u5b50"});d.bind("onclose",function(){a._se.empty();a._se.focus();return true})}else{if(b.no==901){var e="\u672c\u697c\u5c42\u56de\u590d\u5df2\u8fbe\u4e0a\u9650\uff0c\u8bf7\u53c2\u4e0e\u5176\u4ed6\u697c\u5c42\u8ba8\u8bba";a._errorTipShow(e)}else{if(b.no==814){var e="\u62b1\u6b49\uff0c\u6bcf\u5c42\u697c\u63d2\u5165\u7684\u8868\u60c5\u4e0d\u80fd\u8d85\u8fc710\u4e2a\uff0c\u8bf7\u4fee\u6539\u540e\u91cd\u65b0\u63d0\u4ea4";a._errorTipShow(e)}else{if(b.no==902){var e="\u62b1\u6b49\uff0c\u6bcf\u5c42\u697c\u8f93\u5165\u7684\u6587\u5b57\u4e0d\u80fd\u8d85\u8fc7140\u4e2a\uff0c\u8bf7\u4fee\u6539\u540e\u91cd\u65b0\u63d0\u4ea4";a._errorTipShow(e)}else{if(b.no==40){if(a.captchaDialog){a.captchaDialog.setTip(b.data.vcode.str_reason);a.captchaDialog.updateCaptchaImg(b.data.vcode.captcha_vcode_str,b.data.vcode.captcha_code_type);a.captchaDialog.show();a.captchaDialog.focus()}else{_.Module.use("common/component/CaptchaDialog",{message:b.data.vcode.str_reason,vCode:b.data.vcode.captcha_vcode_str,vCodeType:b.data.vcode.captcha_code_type,forumName:a._data.kw,forumId:a._data.fid,isAnonymous:a._data.anonymous,postType:"reply",paramsCallback:function(){var f=a._getData();var g={content:f.content};g.tid=PageData.thread.id;return g}},function(f){a.captchaDialog=f;f.bind("onclose",function(){a._enableEditor();f.hide();return false});f.bind("onaccept",function(){a._setPostData("vcode",f.getInputValue());a._setPostData("vcode_md5",f.getVCode());a._submitData()});f.show()})}}else{if(Thread_add_result.isNeedBindPhone()){$.dialog.alert("<div style='margin: 15px;'>"+Thread_add_result.getMessage()+"</div>",{title:"\u53d1\u8d34\u5931\u8d25",acceptValue:"\u7ed1\u5b9a\u624b\u673a",width:410,onaccept:function(){location.href="http://passport.baidu.com/v2/?accountbindphone&tpl=tb&u="+encodeURIComponent(location.href);return false},onclose:function(){c(Thread_add_result);return true}})}else{var e='<div style="margin: 0px 30px 0px 30px;font-size:14px;line-height:20px;text-align:left;font-family: &quot;\u5b8b\u4f53&quot;;"><table style="width:90%"><tbody><tr><td width="60"><img style="border:none;" src="http://tb2.bdstatic.com/tb/img/errorFace.gif"></td><td valign="middle" style="font-size:20px;line-height:22px;font-family: &quot;\u9ed1\u4f53&quot;;">\u53d1\u8d34\u5931\u8d25</td></tr></tbody></table>'+Thread_add_result.getMessage()+"</div>";var d=$.dialog.alert(e,{width:410,height:95,title:"\u53d1\u8868\u8d34\u5b50"});d.bind("onclose",function(){c(Thread_add_result);return true})}}}}}}}}};